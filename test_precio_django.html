<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Campo Precio - Simulaci√≥n Django</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .form-group { margin: 20px 0; }
        .form-label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-control { 
            padding: 12px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            width: 100%; 
            font-size: 16px;
        }
        .input-group { display: flex; }
        .input-group-text { 
            background: #e9ecef; 
            border: 1px solid #ddd; 
            border-right: none; 
            padding: 12px; 
            border-radius: 4px 0 0 4px;
        }
        .input-group .form-control { border-radius: 0 4px 4px 0; }
        .test-result { 
            margin-top: 20px; 
            padding: 15px; 
            background: #f8f9fa; 
            border-radius: 4px; 
            border-left: 4px solid #007bff;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        .btn { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px;
        }
        .btn:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Campo Precio - Simulaci√≥n Django</h1>
        <p>Este test simula exactamente el comportamiento del formulario Django para crear propiedades.</p>
        
        <form id="testForm">
            <div class="form-group">
                <label for="precio" class="form-label">Precio *</label>
                <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="text" 
                           id="precio" 
                           name="precio" 
                           class="form-control"
                           placeholder="100.000,00"
                           pattern="^[0-9]{1,3}(\\.[0-9]{3})*(,[0-9]{2})?$"
                           title="El precio debe ser mayor a 0 y menor a 999,999,999 (formato: 100.000,00)"
                           required>
                </div>
            </div>
            
            <button type="button" class="btn" onclick="testValues()">üß™ Probar Valores</button>
            <button type="button" class="btn" onclick="clearField()">üóëÔ∏è Limpiar</button>
        </form>
        
        <div class="test-result">
            <h3>üìä Resultado del Test:</h3>
            <div id="testResults">
                <p class="info">Escribe valores en el campo de arriba o haz clic en "Probar Valores"</p>
            </div>
        </div>
    </div>

    <script>
        const precioInput = document.getElementById('precio');
        const testResults = document.getElementById('testResults');
        
        // Test values que vamos a probar
        const testValues = [
            { input: '100', expected: '100', description: 'N√∫mero simple' },
            { input: '1000', expected: '1000', description: 'N√∫mero de 4 d√≠gitos' },
            { input: '100000', expected: '100000', description: 'N√∫mero de 6 d√≠gitos' },
            { input: '100000,50', expected: '100000,50', description: 'N√∫mero con decimales' },
            { input: '100.000', expected: '100.000', description: 'N√∫mero con separador de miles' },
            { input: '1.500.000,75', expected: '1.500.000,75', description: 'N√∫mero completo argentino' }
        ];
        
        // Funci√≥n para probar valores autom√°ticamente
        function testValues() {
            let results = '<h4>üß™ Ejecutando tests autom√°ticos:</h4>';
            
            testValues.forEach((test, index) => {
                // Simular escritura del valor
                precioInput.value = test.input;
                
                // Verificar si el valor se mantiene igual
                const actual = precioInput.value;
                const isCorrect = actual === test.expected;
                
                results += `
                    <div style="margin: 10px 0; padding: 10px; border: 1px solid ${isCorrect ? '#d4edda' : '#f8d7da'}; border-radius: 4px; background: ${isCorrect ? '#d4edda' : '#f8d7da'};">
                        <strong>Test ${index + 1}:</strong> ${test.description}<br>
                        <strong>Entrada:</strong> "${test.input}"<br>
                        <strong>Esperado:</strong> "${test.expected}"<br>
                        <strong>Resultado:</strong> "${actual}"<br>
                        <strong>Estado:</strong> <span class="${isCorrect ? 'success' : 'error'}">${isCorrect ? '‚úÖ CORRECTO' : '‚ùå INCORRECTO'}</span>
                    </div>
                `;
            });
            
            testResults.innerHTML = results;
        }
        
        // Funci√≥n para limpiar el campo
        function clearField() {
            precioInput.value = '';
            testResults.innerHTML = '<p class="info">Campo limpiado. Escribe valores o haz clic en "Probar Valores"</p>';
        }
        
        // Monitorear cambios en tiempo real
        precioInput.addEventListener('input', function(e) {
            const valor = e.target.value;
            testResults.innerHTML = `
                <h4>üìù Monitoreo en tiempo real:</h4>
                <p><strong>Valor actual:</strong> "${valor}"</p>
                <p><strong>Longitud:</strong> ${valor.length} caracteres</p>
                <p><strong>¬øContiene .00 autom√°tico?</strong> ${valor.includes('.00') ? '‚ùå S√ç (PROBLEMA)' : '‚úÖ NO (CORRECTO)'}</p>
                <p><strong>¬øEs v√°lido para Argentina?</strong> ${/^[0-9]{1,3}(\.[0-9]{3})*(,[0-9]{2})?$/.test(valor) || valor === '' ? '‚úÖ S√ç' : '‚ùå NO'}</p>
            `;
        });
        
        // Simular validaci√≥n del backend Django
        precioInput.addEventListener('blur', function(e) {
            const valor = e.target.value;
            if (valor) {
                try {
                    // Convertir formato argentino (100.000,00) a formato decimal (100000.00)
                    const precioLimpio = valor.replace(/\./g, '').replace(',', '.');
                    const precio = parseFloat(precioLimpio);
                    
                    if (precio > 0 && precio <= 999999999) {
                        testResults.innerHTML += `<br><p class="success"><strong>‚úÖ Validaci√≥n backend exitosa:</strong> $${precio.toLocaleString('es-AR')}</p>`;
                    } else {
                        testResults.innerHTML += `<br><p class="error"><strong>‚ùå Error backend:</strong> Precio fuera de rango</p>`;
                    }
                } catch (error) {
                    testResults.innerHTML += `<br><p class="error"><strong>‚ùå Error backend:</strong> Formato inv√°lido</p>`;
                }
            }
        });
        
        // Ejecutar test autom√°tico al cargar
        window.addEventListener('load', function() {
            testResults.innerHTML = `
                <h4>üöÄ Test listo para ejecutar</h4>
                <p>Este test verifica que el campo precio:</p>
                <ul>
                    <li>‚úÖ NO agregue .00 autom√°ticamente</li>
                    <li>‚úÖ Acepte formato argentino (100.000,00)</li>
                    <li>‚úÖ Mantenga los valores tal como se escriben</li>
                    <li>‚úÖ Valide correctamente en el backend</li>
                </ul>
                <p><strong>Haz clic en "Probar Valores" para ejecutar los tests autom√°ticos.</strong></p>
            `;
        });
    </script>
</body>
</html>
