(venv) deploy@vps-534a0040:~/Tienda-inmobiliaria$ cat ~/deploy.sh | grep -A 5 -B 5 "tienda_inmobiliaria"
    exit 1
fi
echo ""

echo -e "${YELLOW}üîÑ Paso 6/6: Reiniciando Gunicorn...${NC}"
sudo supervisorctl restart tienda_inmobiliaria
if [ $? -eq 0 ]; then
    echo -e "${GREEN}‚úÖ Gunicorn reiniciado correctamente${NC}"
else
    echo -e "${RED}‚ùå Error al reiniciar Gunicorn${NC}"
    exit 1
--
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo ""
echo -e "üåê Tu sitio est√° actualizado en: ${GREEN}https://gisa-nqn.com${NC}"
echo ""
echo -e "üìä Estado de servicios:"
sudo supervisorctl status tienda_inmobiliaria
echo ""
(venv) deploy@vps-534a0040:~/Tienda-inmobiliaria$ ^C
(venv) deploy@vps-534a0040:~/Tienda-inmobiliaria$ sudo cat /etc/nginx/sites-available/gisa-nqn.com
cat: /etc/nginx/sites-available/gisa-nqn.com: No such file or directory
(venv) deploy@vps-534a0040:~/Tienda-inmobiliaria$ sudo nano /etc/nginx/sites-available/gisa-nqn.com
(venv) deploy@vps-534a0040:~/Tienda-inmobiliaria$ sudo nano /etc/nginx/sites-available/gisa-nqn.com
(venv) deploy@vps-534a0040:~/Tienda-inmobiliaria$ ls -la /etc/nginx/sites-available/
total 28
drwxr-xr-x 2 root root 4096 Oct  9 08:10 .
drwxr-xr-x 8 root root 4096 Oct  4 00:16 ..
-rw-r--r-- 1 root root  507 Oct  8 03:21 default
-rw-r--r-- 1 root root   95 Oct  9 08:10 gisa-nqn.com
-rw------- 1 root root  523 Oct  9 07:41 tienda-inmobiliaria.save
-rw-r--r-- 1 root root 1169 Oct  9 06:42 tienda_inmobiliaria
-rw-r--r-- 1 root root  891 Oct  7 02:34 tienda_inmobiliaria.backup.20251007_023419
(venv) deploy@vps-534a0040:~/Tienda-inmobiliaria$ ls -la /etc/nginx/sites-enabled/
total 8
drwxr-xr-x 2 root root 4096 Oct  8 03:17 .
drwxr-xr-x 8 root root 4096 Oct  4 00:16 ..
lrwxrwxrwx 1 root root   34 Oct  8 03:17 default -> /etc/nginx/sites-available/default
lrwxrwxrwx 1 root root   46 Oct  3 23:57 tienda_inmobiliaria -> /etc/nginx/sites-available/tienda_inmobiliaria
(venv) deploy@vps-534a0040:~/Tienda-inmobiliaria$ sudo cat /etc/nginx/nginx.conf}
cat: /etc/nginx/nginx.conf}: No such file or directory
(venv) deploy@vps-534a0040:~/Tienda-inmobiliaria$
(venv) deploy@vps-534a00{% load static %}
<!DOCTYPE html>
<!-- eslint-disable -->
<!-- @typescript-eslint/disable -->
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#3b82f6">
    <title>Dashboard Administrativo - Tienda Inmobiliaria</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="{% static 'images/logo/logo-gisa.jpeg' %}">
    <link rel="shortcut icon" type="image/jpeg" href="{% static 'images/logo/logo-gisa.jpeg' %}">
    
    <!-- CDN de TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- CDN de Iconos Lucide -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Configuraci√≥n de Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Estilos personalizados -->
    <style>
        /* Variables CSS optimizadas */
        :root {
            --color-bajo: #22C55E;
            --color-medio: #F59E0B;
            --color-alto: #EF4444;
            --color-fondo: #e9ecef;
            --sidebar-width: 280px;
            --sidebar-collapsed: 80px;
            --main-margin: 280px;
            --main-margin-collapsed: 80px;
            --transition-duration: 0.3s;
            --transition-easing: ease;
        }
        
        /* Utility classes */
        .hidden {
            display: none !important;
            visibility: hidden !important;
        }
        
        /* Estilos para las barras del gr√°fico */
        .bar-chart {
            transition: all 0.3s ease;
            border-radius: 0.5rem 0.5rem 0 0;
        }
        
        /* Animaciones suaves */
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Estilos para contadores animados */
        .counter-animation {
            transition: all 0.3s ease;
        }
        
        /* Estilos responsivos mejorados */
        .widget-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        @media (min-width: 1024px) {
            .widget-container {
                flex-direction: row;
            }
        }
        
        /* Estilos para el modal de Nueva Propiedad */
        /* Estilos para el √°rea de upload */
        .upload-area.dragover {
            border-color: #10b981 !important;
            background-color: #d1fae5 !important;
            transform: scale(1.02);
        }

        .upload-content {
            pointer-events: none;
        }

        .upload-content button {
            pointer-events: all;
        }

        /* Estilos para las amenidades */
        .amenidad-checkbox input[type="checkbox"]:checked + label {
            color: #2563eb;
            font-weight: 600;
        }

        .amenidad-checkbox input[type="checkbox"]:checked {
            background-color: #2563eb;
            border-color: #2563eb;
        }

        .amenidad-checkbox input[type="checkbox"]:checked ~ label {
            color: #2563eb;
            font-weight: 600;
        }

        /* Estilos para el preview de fotos adicionales */
        .foto-preview-item {
            position: relative;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
            background: white;
        }

        .foto-preview-item:hover {
            border-color: #2563eb;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
            transform: translateY(-2px);
        }

        .foto-preview-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .foto-preview-info {
            padding: 8px;
            background: rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .foto-preview-info small {
            font-size: 0.75rem;
            line-height: 1.2;
            color: #6b7280;
        }

        .foto-preview-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .foto-preview-remove:hover {
            background: rgba(239, 68, 68, 1);
            transform: scale(1.1);
        }

        /* Animaci√≥n de entrada */
        .foto-preview-item {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Estilos para campos del formulario Django */
        #crearPropiedadForm input[type="text"],
        #crearPropiedadForm input[type="number"],
        #crearPropiedadForm input[type="file"],
        #crearPropiedadForm select,
        #crearPropiedadForm textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            line-height: 1.25rem;
            color: #111827;
            background-color: #ffffff;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        #crearPropiedadForm input[type="text"]:focus,
        #crearPropiedadForm input[type="number"]:focus,
        #crearPropiedadForm input[type="file"]:focus,
        #crearPropiedadForm select:focus,
        #crearPropiedadForm textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        #crearPropiedadForm input[type="text"]:hover,
        #crearPropiedadForm input[type="number"]:hover,
        #crearPropiedadForm select:hover,
        #crearPropiedadForm textarea:hover {
            border-color: #9ca3af;
        }

        /* Estilos para checkboxes de amenidades */
        #crearPropiedadForm input[type="checkbox"] {
            width: 1rem;
            height: 1rem;
            margin-right: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
            background-color: #ffffff;
        }

        #crearPropiedadForm input[type="checkbox"]:checked {
            background-color: #2563eb;
            border-color: #2563eb;
        }

        /* Estilos para el campo de precio con s√≠mbolo $ */
        #crearPropiedadForm input[type="number"][id*="precio"] {
            padding-left: 2rem;
        }

        /* Estilos para el campo de metros cuadrados con m¬≤ */
        #crearPropiedadForm input[type="number"][id*="metros"] {
            padding-right: 2.5rem;
        }

        /* üî• ESTILOS PARA INDICADOR DE PROGRESO */
        .alert {
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid transparent;
            border-radius: 0.5rem;
        }

        .alert-info {
            color: #0c5460;
            background-color: #d1ecf1;
            border-color: #bee5eb;
        }

        .alert-success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }

        .alert-danger {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

        .alert-warning {
            color: #856404;
            background-color: #fff3cd;
            border-color: #ffeaa7;
        }

        /* Animaci√≥n de carga */
        .animate-spin {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        /* Bot√≥n deshabilitado */
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* ===== RESPONSIVE STYLES ===== */
        
        /* Sidebar responsive */
        .sidebar {
            width: var(--sidebar-width);
            transition: width var(--transition-duration) var(--transition-easing), 
                        transform var(--transition-duration) var(--transition-easing);
        }
        
        .sidebar.collapsed {
            width: var(--sidebar-collapsed);
        }
        
        .sidebar.collapsed .sidebar-content {
            padding: 1rem 0.75rem;
        }
        
        .sidebar.collapsed .logo-text,
        .sidebar.collapsed .nav-text,
        .sidebar.collapsed .user-text {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s var(--transition-easing), 
                        visibility 0.2s var(--transition-easing);
        }
        
        .sidebar.collapsed .nav-button {
            justify-content: center;
            padding: 0.75rem;
        }
        
        .sidebar.collapsed .nav-button i {
            margin-right: 0;
        }
        
        .sidebar.collapsed .user-info {
            justify-content: center;
        }
        
        .sidebar.collapsed .user-avatar {
            margin-right: 0;
        }
        
        /* Main content responsive */
        .main-content {
            margin-left: var(--main-margin);
            transition: margin-left var(--transition-duration) var(--transition-easing);
        }
        
        .main-content.sidebar-collapsed {
            margin-left: var(--main-margin-collapsed);
        }
        
        /* Tooltips for collapsed sidebar */
        .nav-button[data-tooltip] {
            position: relative;
        }
        
        .nav-button[data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            background: #1f2937;
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            white-space: nowrap;
            z-index: 1000;
            margin-left: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .nav-button[data-tooltip]:hover::before {
            content: '';
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            border: 5px solid transparent;
            border-right-color: #1f2937;
            z-index: 1000;
        }
        
        /* Overlay */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 40;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-duration) var(--transition-easing), 
                        visibility var(--transition-duration) var(--transition-easing);
        }
        
        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* Responsive breakpoints */
        
        /* Mobile (‚â§640px) */
        @media (max-width: 640px) {
            .sidebar {
                transform: translateX(-100%);
                width: var(--sidebar-width);
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .sidebar.collapsed {
                width: var(--sidebar-width);
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
            }
            
            button, .btn {
                min-height: 44px;
                min-width: 44px;
            }
            
            .text-2xl { font-size: 1.5rem; }
            .text-xl { font-size: 1.25rem; }
            .text-lg { font-size: 1.125rem; }
            .p-6 { padding: 1rem; }
            .mb-8 { margin-bottom: 1.5rem; }
            
            .header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .nav-button {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
            }
            
            .user-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            #sidebar-collapse {
                display: none;
            }
        }
        
        /* Medium screens auto-collapse (641px - 1035px) */
        @media (max-width: 1035px) and (min-width: 641px) {
            .sidebar {
                width: var(--sidebar-collapsed) !important;
            }
            
            .main-content {
                margin-left: var(--main-margin-collapsed) !important;
            }
            
            .sidebar .logo-text,
            .sidebar .nav-text,
            .sidebar .user-text {
                opacity: 0 !important;
                visibility: hidden !important;
            }
            
            .sidebar .nav-button {
                justify-content: center !important;
                padding: 0.75rem !important;
            }
            
            .sidebar .nav-button i {
                margin-right: 0 !important;
            }
            
            .sidebar .user-info {
                justify-content: center !important;
            }
            
            .sidebar .user-avatar {
                margin-right: 0 !important;
            }
            
            #sidebar-collapse {
                display: none !important;
            }
        }
        
        /* Large Desktop (‚â•1036px) */
        @media (min-width: 1036px) {
            .sidebar {
                width: var(--sidebar-width);
            }
            
            .sidebar.collapsed {
                width: var(--sidebar-collapsed);
            }
            
            .main-content {
                margin-left: var(--main-margin);
            }
            
            .main-content.sidebar-collapsed {
                margin-left: var(--main-margin-collapsed);
            }
            
            #sidebar-collapse {
                display: flex;
            }
        }
        
        /* Interactive elements */
        .widget-card,
        .nav-button,
        button {
            transition: all 0.2s var(--transition-easing);
        }
        
        button:focus,
        .nav-button:focus,
        .form-input:focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        
        /* Hover effects */
        @media (hover: hover) {
            .widget-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
            
            #sidebar-collapse:hover {
                background-color: #f3f4f6;
            }
        }
        
        @media (hover: none) {
            .widget-card:active {
                transform: scale(0.98);
            }
        }
        
        /* ===== RESPONSIVE DESIGN PARA CONFIGURACIONES ===== */
        
        /* Meta viewport y configuraci√≥n global */
        @media (max-width: 768px) {
            .configuraciones-container {
                padding: 0.5rem;
            }
            
            /* Header responsivo */
            .config-header {
                margin-bottom: 1rem;
            }
            
            .config-header h1 {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }
            
            .config-header p {
                font-size: 0.875rem;
            }
            
            .config-header button {
                width: 100%;
                padding: 0.75rem;
                font-size: 0.875rem;
            }
        }
        
        /* Formulario de perfil responsivo */
        @media (max-width: 768px) {
            .profile-form {
                padding: 1rem;
            }
            
            .profile-form .form-section {
                margin-bottom: 1.5rem;
            }
            
            /* Foto de perfil m√≥vil */
            .profile-photo-section {
                text-align: center;
                margin-bottom: 1.5rem;
            }
            
            .profile-photo-container {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 1rem;
            }
            
            .profile-photo-preview {
                width: 80px;
                height: 80px;
            }
            
            .profile-photo-info {
                text-align: center;
            }
            
            /* Campos de formulario */
            .form-grid {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }
            
            .form-field {
                width: 100%;
            }
            
            .form-field input,
            .form-field select {
                width: 100%;
                padding: 0.75rem;
                font-size: 16px; /* Previene zoom en iOS */
                border-radius: 8px;
            }
            
            .form-field label {
                font-size: 0.875rem;
                margin-bottom: 0.5rem;
                display: block;
            }
            
            /* Botones de acci√≥n */
            .form-actions {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
                margin-top: 1.5rem;
            }
            
            .form-actions button {
                width: 100%;
                padding: 0.875rem;
                font-size: 0.875rem;
                border-radius: 8px;
                min-height: 44px; /* Tama√±o m√≠nimo para touch */
            }
        }
        
        /* Secci√≥n 2FA responsiva */
        @media (max-width: 768px) {
            .twofa-section {
                padding: 1rem;
            }
            
            .twofa-content {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }
            
            .twofa-icon {
                width: 60px;
                height: 60px;
                margin: 0 auto;
            }
            
            .twofa-info {
                text-align: center;
            }
            
            .twofa-info h4 {
                font-size: 1.125rem;
                margin-bottom: 0.75rem;
            }
            
            .twofa-info p {
                font-size: 0.875rem;
                line-height: 1.5;
            }
            
            .twofa-status-card {
                padding: 1rem;
                margin: 1rem 0;
            }
            
            .twofa-status-card h5 {
                font-size: 0.875rem;
            }
            
            .twofa-status-card ul {
                font-size: 0.8rem;
            }
            
            .twofa-actions {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
                margin-top: 1rem;
            }
            
            .twofa-actions button {
                width: 100%;
                padding: 0.875rem;
                font-size: 0.875rem;
                border-radius: 8px;
                min-height: 44px;
            }
        }
        
        /* Tablet (768px - 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .configuraciones-container {
                padding: 1rem;
            }
            
            .form-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1.5rem;
            }
            
            .profile-photo-container {
                flex-direction: row;
                align-items: center;
            }
            
            .twofa-content {
                flex-direction: row;
                align-items: flex-start;
            }
            
            .twofa-actions {
                flex-direction: row;
                gap: 1rem;
            }
        }
        
        /* Desktop (1025px+) */
        @media (min-width: 1025px) {
            .configuraciones-container {
                padding: 1.5rem;
            }
            
            .form-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 2rem;
            }
            
            .profile-photo-container {
                flex-direction: row;
                align-items: center;
            }
            
            .twofa-content {
                flex-direction: row;
                align-items: flex-start;
            }
            
            .twofa-actions {
                flex-direction: row;
                gap: 1rem;
            }
        }
        
        /* Mejoras de accesibilidad y usabilidad */
        @media (max-width: 768px) {
            /* Asegurar que los inputs sean f√°ciles de usar en m√≥vil */
            input[type="text"],
            input[type="email"],
            input[type="tel"],
            input[type="date"],
            input[type="file"] {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                font-size: 16px; /* Previene zoom en iOS */
            }
            
            /* Mejorar el contraste en pantallas peque√±as */
            .form-field label {
                color: #374151;
                font-weight: 600;
            }
            
            /* Asegurar que los botones sean f√°ciles de tocar */
            button {
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
            }
            
            /* Mejorar el espaciado entre elementos t√°ctiles */
            .form-actions,
            .twofa-actions {
                gap: 0.75rem;
            }
        }
        
        /* Optimizaciones para pantallas de alta densidad */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .profile-photo-preview img {
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
            }
        }
        
        /* Mejoras para dispositivos con orientaci√≥n landscape */
        @media (orientation: landscape) and (max-height: 600px) {
            .configuraciones-container {
                padding: 0.5rem;
            }
            
            .config-header {
                margin-bottom: 0.75rem;
            }
            
            .profile-form,
            .twofa-section {
                padding: 0.75rem;
            }
            
            .form-actions,
            .twofa-actions {
                margin-top: 1rem;
            }
        }

        /* ===== RESPONSIVE DESIGN PARA CVs ===== */
        
        /* Configuraci√≥n global para CVs */
        @media (max-width: 768px) {
            .cvs-container {
                padding: 0.5rem;
            }
            
            /* Header de CVs responsivo */
            .cvs-header {
                margin-bottom: 1rem;
            }
            
            .cvs-header h1 {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }
            
            .cvs-header p {
                font-size: 0.875rem;
            }
            
            .cvs-header button {
                width: 100%;
                padding: 0.75rem;
                font-size: 0.875rem;
            }
        }
        
        /* Configuraci√≥n para pantallas medianas (640px - 768px) */
        @media (min-width: 640px) and (max-width: 768px) {
            .cvs-container {
                padding: 1rem;
            }
            
            .cvs-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: flex-start;
            }
            
            .cvs-header button {
                width: auto;
                padding: 0.75rem 1rem;
            }
        }
        
        /* Tarjetas de CVs responsivas */
        @media (max-width: 768px) {
            .cv-card {
                margin-bottom: 1rem;
                border-radius: 12px;
                overflow: hidden;
            }
            
            .cv-card h4 {
                font-size: 1rem;
                font-weight: 600;
                line-height: 1.4;
            }
            
            .cv-card p {
                font-size: 0.875rem;
                line-height: 1.5;
            }
            
            .cv-card .flex.space-x-2 {
                gap: 0.5rem;
            }
            
            .cv-card a {
                font-size: 0.875rem;
                padding: 0.75rem;
            }
        }
        
        /* Mejorar visualizaci√≥n en pantallas medianas */
        @media (min-width: 640px) and (max-width: 768px) {
            .cv-card {
                padding: 1rem;
            }
            
            .cv-card h4 {
                font-size: 1.1rem;
            }
            
            .cv-card .flex.space-x-2 {
                gap: 0.75rem;
            }
            
            .cv-card a, .cv-card button {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            /* Mejorar layout en pantallas medianas */
            .cvs-mobile-cards {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 1rem;
            }
        }
        
        /* Tablet (768px - 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .cvs-container {
                padding: 1rem;
            }
            
            .cvs-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: flex-start;
            }
            
            /* Asegurar que la tabla se vea en tablets */
            .cvs-desktop-table {
                display: block !important;
                width: 100%;
            }
            
            .cvs-desktop-table table {
                width: 100%;
                font-size: 0.875rem;
            }
            
            .cvs-desktop-table th,
            .cvs-desktop-table td {
                padding: 0.75rem 1rem;
            }
        }
        
        /* Desktop (1025px+) */
        @media (min-width: 1025px) {
            .cvs-container {
                padding: 1.5rem;
            }
            
            .cvs-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: flex-start;
            }
            
            /* Asegurar que la tabla se vea en desktop */
            .cvs-desktop-table {
                display: block !important;
                width: 100%;
            }
            
            .cvs-desktop-table table {
                width: 100%;
                table-layout: auto;
            }
            
            .cvs-desktop-table th,
            .cvs-desktop-table td {
                padding: 1rem 1.5rem;
                text-align: left;
                border-bottom: 1px solid #e5e7eb;
            }
            
            .cvs-desktop-table th {
                background-color: #f9fafb;
                font-weight: 600;
                font-size: 0.875rem;
                color: #6b7280;
                text-transform: uppercase;
                letter-spacing: 0.05em;
            }
            
            .cvs-desktop-table tbody tr:hover {
                background-color: #f9fafb;
            }
        }
        
        /* Eliminar todos los breakpoints conflictivos - TABLA SIEMPRE VISIBLE */
        
        /* Estilo base para la tabla desktop - SIEMPRE VISIBLE */
        .cvs-desktop-table {
            display: block !important;
            width: 100% !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .cvs-desktop-table table {
            display: table !important;
            width: 100% !important;
            table-layout: auto !important;
        }
        
        .cvs-desktop-table th,
        .cvs-desktop-table td {
            display: table-cell !important;
            padding: 0.75rem 1rem !important;
            border-bottom: 1px solid #e5e7eb !important;
        }
        
        .cvs-desktop-table th {
            background-color: #f9fafb !important;
            font-weight: 600 !important;
            font-size: 0.875rem !important;
            color: #6b7280 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.05em !important;
        }
        
        .cvs-desktop-table tbody tr:hover {
            background-color: #f9fafb !important;
        }
        
        /* Ocultar cards m√≥viles por defecto */
        .cvs-mobile-cards {
            display: none !important;
        }
        
        /* Estilos optimizados para diferentes resoluciones */
        @media (min-width: 1920px) {
            .cvs-desktop-table th,
            .cvs-desktop-table td {
                padding: 1rem 1.5rem !important;
            }
        }
        
        @media (min-width: 2560px) {
            .cvs-desktop-table th,
            .cvs-desktop-table td {
                padding: 1.25rem 2rem !important;
                font-size: 1rem !important;
            }
        }
        
        @media (min-width: 3840px) {
            .cvs-desktop-table th,
            .cvs-desktop-table td {
                padding: 1.5rem 2.5rem !important;
                font-size: 1.1rem !important;
            }
        }

        /* ===== RESPONSIVE DESIGN PARA RESE√ëAS ===== */
        
        /* Configuraci√≥n global para rese√±as */
        @media (max-width: 768px) {
            .resenas-container {
                padding: 0.5rem;
            }
            
            /* Header de rese√±as responsivo */
            .resenas-header {
                margin-bottom: 1rem;
            }
            
            .resenas-header h1 {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }
            
            .resenas-header p {
                font-size: 0.875rem;
            }
            
            .resenas-header button {
                width: 100%;
                padding: 0.75rem;
                font-size: 0.875rem;
            }
        }
        
        /* Filtros de rese√±as responsivos */
        @media (max-width: 768px) {
            .filtros-section {
                padding: 1rem;
            }
            
            .filtros-header {
                padding: 1rem;
                margin-bottom: 0;
            }
            
            .filtros-header h3 {
                font-size: 1rem;
                margin-bottom: 1rem;
            }
            
            /* Estad√≠sticas en m√≥vil */
            .estadisticas-mobile {
                display: flex;
                justify-content: space-between;
                margin-bottom: 1rem;
                padding: 0.75rem;
                background: #f8fafc;
                border-radius: 8px;
            }
            
            .estadistica-item {
                text-align: center;
                flex: 1;
            }
            
            .estadistica-item .icono {
                width: 32px;
                height: 32px;
                margin: 0 auto 0.25rem;
            }
            
            .estadistica-item .numero {
                font-size: 1.125rem;
                font-weight: 700;
            }
            
            .estadistica-item .label {
                font-size: 0.75rem;
                color: #6b7280;
            }
            
            /* Grid de filtros en m√≥vil */
            .filtros-grid {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }
            
            .filtro-field {
                width: 100%;
            }
            
            .filtro-field label {
                font-size: 0.875rem;
                margin-bottom: 0.5rem;
                display: block;
            }
            
            .filtro-field select {
                width: 100%;
                padding: 0.75rem;
                font-size: 16px; /* Previene zoom en iOS */
                border-radius: 8px;
            }
            
            /* Bot√≥n limpiar filtros */
            .btn-limpiar-filtros {
                width: 100%;
                padding: 0.875rem;
                font-size: 0.875rem;
                margin-top: 1rem;
            }
        }
        
        /* Lista de rese√±as responsiva */
        @media (max-width: 768px) {
            .lista-resenas {
                padding: 1rem;
            }
            
            .lista-resenas-header {
                padding: 1rem;
                margin-bottom: 0;
            }
            
            .lista-resenas-header h3 {
                font-size: 1rem;
                margin-bottom: 1rem;
            }
            
            .lista-resenas-header button {
                width: 100%;
                padding: 0.875rem;
                font-size: 0.875rem;
            }
            
            /* Contenido de rese√±as */
            .resenas-content {
                padding: 1rem;
            }
            
            /* Estado de carga */
            .loading-state {
                padding: 2rem 1rem;
                text-align: center;
            }
            
            .loading-state i {
                width: 2rem;
                height: 2rem;
                margin-bottom: 1rem;
            }
            
            .loading-state p {
                font-size: 0.875rem;
            }
        }
        
        /* Tarjetas de rese√±as responsivas */
        @media (max-width: 768px) {
            .resena-card {
                margin-bottom: 1rem;
                border-radius: 12px;
                overflow: hidden;
            }
            
            .resena-header {
                padding: 1rem;
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .resena-info {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .resena-titulo {
                font-size: 1rem;
                font-weight: 600;
                line-height: 1.4;
            }
            
            .resena-propiedad {
                font-size: 0.875rem;
                color: #6b7280;
            }
            
            .resena-calificacion {
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }
            
            .resena-estrellas {
                font-size: 1rem;
            }
            
            .resena-estado {
                padding: 0.25rem 0.75rem;
                border-radius: 20px;
                font-size: 0.75rem;
                font-weight: 600;
            }
            
            .resena-contenido {
                padding: 1rem;
            }
            
            .resena-texto {
                font-size: 0.875rem;
                line-height: 1.5;
                margin-bottom: 1rem;
            }
            
            .resena-metadata {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
                font-size: 0.75rem;
                color: #6b7280;
            }
            
            .resena-actions {
                padding: 1rem;
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
                border-top: 1px solid #e5e7eb;
            }
            
            .resena-actions button {
                width: 100%;
                padding: 0.875rem;
                font-size: 0.875rem;
                border-radius: 8px;
                min-height: 44px;
            }
        }
        
        /* Paginaci√≥n responsiva */
        @media (max-width: 768px) {
            .pagination {
                padding: 1rem;
                display: flex;
                justify-content: center;
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .pagination button {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
                border-radius: 8px;
                min-height: 44px;
                min-width: 44px;
            }
            
            .pagination .page-info {
                width: 100%;
                text-align: center;
                font-size: 0.875rem;
                margin-bottom: 0.5rem;
            }
        }
        
        /* Tablet (768px - 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .resenas-container {
                padding: 1rem;
            }
            
            .filtros-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1.5rem;
            }
            
            .filtros-grid .filtro-field:last-child {
                grid-column: 1 / -1;
            }
            
            .estadisticas-mobile {
                display: none;
            }
            
            .resena-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: flex-start;
            }
            
            .resena-actions {
                flex-direction: row;
                gap: 1rem;
            }
        }
        
        /* Desktop (1025px+) */
        @media (min-width: 1025px) {
            .resenas-container {
                padding: 1.5rem;
            }
            
            .filtros-grid {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
                gap: 2rem;
            }
            
            .estadisticas-mobile {
                display: none;
            }
            
            .resena-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: flex-start;
            }
            
            .resena-actions {
                flex-direction: row;
                gap: 1rem;
            }
        }
        
        /* Mejoras de accesibilidad y usabilidad para rese√±as */
        @media (max-width: 768px) {
            /* Asegurar que los selects sean f√°ciles de usar en m√≥vil */
            select {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                font-size: 16px; /* Previene zoom en iOS */
            }
            
            /* Mejorar el contraste en pantallas peque√±as */
            .filtro-field label {
                color: #374151;
                font-weight: 600;
            }
            
            /* Asegurar que los botones sean f√°ciles de tocar */
            button {
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
            }
            
            /* Mejorar el espaciado entre elementos t√°ctiles */
            .resena-actions,
            .filtros-grid {
                gap: 0.75rem;
            }
        }
        
        /* Optimizaciones para pantallas de alta densidad */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .resena-card img {
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
            }
        }
        
        /* Mejoras para dispositivos con orientaci√≥n landscape */
        @media (orientation: landscape) and (max-height: 600px) {
            .resenas-container {
                padding: 0.5rem;
            }
            
            .resenas-header {
                margin-bottom: 0.75rem;
            }
            
            .filtros-section,
            .lista-resenas {
                padding: 0.75rem;
            }
            
            .resena-actions {
                margin-top: 0.75rem;
            }
        }

        /* ===== RESPONSIVE DESIGN PARA MODAL DE NUEVO USUARIO ===== */
        
        /* Configuraci√≥n global para el modal de usuario */
        @media (max-width: 768px) {
            .modal-usuario-container {
                padding: 0.5rem;
            }
            
            .modal-usuario-content {
                max-width: 95vw;
                max-height: 95vh;
                margin: 0.5rem;
            }
            
            /* Header del modal responsivo */
            .modal-usuario-header {
                padding: 1rem;
            }
            
            .modal-usuario-header h2 {
                font-size: 1.25rem;
                margin-bottom: 0.25rem;
            }
            
            .modal-usuario-header p {
                font-size: 0.875rem;
            }
            
            .modal-usuario-header button {
                width: 2rem;
                height: 2rem;
            }
        }
        
        /* Tabs responsivos */
        @media (max-width: 768px) {
            .modal-usuario-tabs {
                flex-direction: column;
                gap: 0.5rem;
                margin-bottom: 1rem;
            }
            
            .modal-usuario-tab {
                width: 100%;
                padding: 0.875rem;
                font-size: 0.875rem;
                justify-content: center;
            }
            
            .modal-usuario-tab i {
                margin-right: 0.5rem;
            }
        }
        
        /* Formulario de crear usuario responsivo */
        @media (max-width: 768px) {
            .modal-usuario-form {
                padding: 1rem;
            }
            
            .modal-usuario-section {
                margin-bottom: 1.5rem;
            }
            
            .modal-usuario-section h3 {
                font-size: 1.125rem;
                margin-bottom: 1rem;
            }
            
            /* Grid de campos en m√≥vil */
            .modal-usuario-grid {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }
            
            .modal-usuario-field {
                width: 100%;
            }
            
            .modal-usuario-field label {
                font-size: 0.875rem;
                margin-bottom: 0.5rem;
                display: block;
            }
            
            .modal-usuario-field input,
            .modal-usuario-field select {
                width: 100%;
                padding: 0.75rem;
                font-size: 16px; /* Previene zoom en iOS */
                border-radius: 8px;
            }
            
            /* Foto de perfil m√≥vil */
            .modal-usuario-foto {
                text-align: center;
                margin: 1rem 0;
            }
            
            .modal-usuario-foto-preview {
                width: 100px;
                height: 100px;
                margin: 0 auto 1rem;
            }
            
            .modal-usuario-foto-placeholder {
                width: 100px;
                height: 100px;
                margin: 0 auto 1rem;
            }
            
            /* Botones de acci√≥n */
            .modal-usuario-actions {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
                margin-top: 1.5rem;
            }
            
            .modal-usuario-actions button {
                width: 100%;
                padding: 0.875rem;
                font-size: 0.875rem;
                border-radius: 8px;
                min-height: 44px; /* Tama√±o m√≠nimo para touch */
            }
        }
        
        /* Secci√≥n de gestionar usuarios responsiva */
        @media (max-width: 768px) {
            .modal-usuario-gestion {
                padding: 1rem;
            }
            
            .modal-usuario-gestion h3 {
                font-size: 1.125rem;
                margin-bottom: 1rem;
            }
            
            .modal-usuario-gestion-header {
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-bottom: 1rem;
            }
            
            .modal-usuario-gestion-header p {
                font-size: 0.875rem;
                text-align: center;
            }
            
            .modal-usuario-gestion-header button {
                width: 100%;
                padding: 0.875rem;
                font-size: 0.875rem;
            }
            
            /* Lista de usuarios */
            .modal-usuario-lista {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }
            
            .modal-usuario-item {
                border-radius: 12px;
                overflow: hidden;
                border: 1px solid #e5e7eb;
            }
            
            .modal-usuario-item-header {
                padding: 1rem;
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .modal-usuario-item-info {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .modal-usuario-item-nombre {
                font-size: 1rem;
                font-weight: 600;
            }
            
            .modal-usuario-item-email {
                font-size: 0.875rem;
                color: #6b7280;
            }
            
            .modal-usuario-item-actions {
                padding: 1rem;
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
                border-top: 1px solid #e5e7eb;
            }
            
            .modal-usuario-item-actions button {
                width: 100%;
                padding: 0.875rem;
                font-size: 0.875rem;
                border-radius: 8px;
                min-height: 44px;
            }
        }
        
        /* Tablet (768px - 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .modal-usuario-container {
                padding: 1rem;
            }
            
            .modal-usuario-content {
                max-width: 90vw;
                margin: 1rem;
            }
            
            .modal-usuario-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1.5rem;
            }
            
            .modal-usuario-tabs {
                flex-direction: row;
            }
            
            .modal-usuario-actions {
                flex-direction: row;
                gap: 1rem;
            }
            
            .modal-usuario-gestion-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            
            .modal-usuario-item-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: flex-start;
            }
            
            .modal-usuario-item-actions {
                flex-direction: row;
                gap: 1rem;
            }
        }
        
        /* Desktop (1025px+) */
        @media (min-width: 1025px) {
            .modal-usuario-container {
                padding: 1.5rem;
            }
            
            .modal-usuario-content {
                max-width: 6xl;
                margin: 1.5rem;
            }
            
            .modal-usuario-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 2rem;
            }
            
            .modal-usuario-tabs {
                flex-direction: row;
            }
            
            .modal-usuario-actions {
                flex-direction: row;
                gap: 1rem;
            }
            
            .modal-usuario-gestion-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            
            .modal-usuario-item-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: flex-start;
            }
            
            .modal-usuario-item-actions {
                flex-direction: row;
                gap: 1rem;
            }
        }
        
        /* Mejoras de accesibilidad y usabilidad para el modal de usuario */
        @media (max-width: 768px) {
            /* Asegurar que los inputs sean f√°ciles de usar en m√≥vil */
            .modal-usuario-field input,
            .modal-usuario-field select {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                font-size: 16px; /* Previene zoom en iOS */
            }
            
            /* Mejorar el contraste en pantallas peque√±as */
            .modal-usuario-field label {
                color: #374151;
                font-weight: 600;
            }
            
            /* Asegurar que los botones sean f√°ciles de tocar */
            .modal-usuario-actions button,
            .modal-usuario-item-actions button {
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
            }
            
            /* Mejorar el espaciado entre elementos t√°ctiles */
            .modal-usuario-actions,
            .modal-usuario-item-actions {
                gap: 0.75rem;
            }
        }
        
        /* Optimizaciones para pantallas de alta densidad */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .modal-usuario-foto-preview img {
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
            }
        }
        
        /* Mejoras para dispositivos con orientaci√≥n landscape */
        @media (orientation: landscape) and (max-height: 600px) {
            .modal-usuario-container {
                padding: 0.5rem;
            }
            
            .modal-usuario-content {
                max-height: 90vh;
            }
            
            .modal-usuario-header {
                padding: 0.75rem;
            }
            
            .modal-usuario-form,
            .modal-usuario-gestion {
                padding: 0.75rem;
            }
            
            .modal-usuario-section {
                margin-bottom: 1rem;
            }
        }

        /* ===== RESPONSIVE DESIGN PARA GESTIONAR PROPIEDADES ===== */
        
        /* Configuraci√≥n global para gestionar propiedades */
        @media (max-width: 768px) {
            .propiedades-container {
                padding: 0.5rem;
            }
            
            /* Header de propiedades responsivo */
            .propiedades-header {
                margin-bottom: 1rem;
            }
            
            .propiedades-header h1 {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }
            
            .propiedades-header p {
                font-size: 0.875rem;
            }
            
            .propiedades-header-buttons {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
                margin-top: 1rem;
            }
            
            .propiedades-header-buttons button {
                width: 100%;
                padding: 0.875rem;
                font-size: 0.875rem;
                min-height: 44px;
            }
        }
        
        /* Tabla de propiedades responsiva */
        @media (max-width: 768px) {
            .propiedades-tabla {
                padding: 1rem;
            }
            
            .propiedades-tabla-header {
                padding: 1rem;
                margin-bottom: 0;
            }
            
            .propiedades-tabla-header h3 {
                font-size: 1rem;
                margin-bottom: 1rem;
            }
            
            .propiedades-search {
                width: 100%;
                margin-top: 1rem;
            }
            
            .propiedades-search input {
                width: 100%;
                padding: 0.75rem;
                font-size: 16px; /* Previene zoom en iOS */
                border-radius: 8px;
            }
            
            /* Ocultar tabla en m√≥vil y mostrar cards */
            .propiedades-tabla-desktop {
                display: none;
            }
            
            .propiedades-cards-mobile {
                display: block;
            }
            
            /* Cards de propiedades en m√≥vil */
            .propiedad-card {
                background: white;
                border-radius: 12px;
                border: 1px solid #e5e7eb;
                margin-bottom: 1rem;
                overflow: hidden;
            }
            
            .propiedad-card-header {
                padding: 1rem;
                display: flex;
                align-items: center;
                gap: 1rem;
            }
            
            .propiedad-card-imagen {
                width: 60px;
                height: 60px;
                border-radius: 8px;
                object-fit: cover;
                flex-shrink: 0;
            }
            
            .propiedad-card-imagen-placeholder {
                width: 60px;
                height: 60px;
                background: #f3f4f6;
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
            }
            
            .propiedad-card-info {
                flex: 1;
                min-width: 0;
            }
            
            .propiedad-card-titulo {
                font-size: 1rem;
                font-weight: 600;
                color: #111827;
                margin-bottom: 0.25rem;
                line-height: 1.4;
            }
            
            .propiedad-card-metros {
                font-size: 0.875rem;
                color: #6b7280;
                margin-bottom: 0.5rem;
            }
            
            .propiedad-card-precio {
                font-size: 1rem;
                font-weight: 600;
                color: #059669;
            }
            
            .propiedad-card-body {
                padding: 1rem;
                border-top: 1px solid #e5e7eb;
            }
            
            .propiedad-card-details {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 0.75rem;
                margin-bottom: 1rem;
            }
            
            .propiedad-card-detail {
                display: flex;
                flex-direction: column;
                gap: 0.25rem;
            }
            
            .propiedad-card-detail-label {
                font-size: 0.75rem;
                color: #6b7280;
                font-weight: 500;
            }
            
            .propiedad-card-detail-value {
                font-size: 0.875rem;
                color: #111827;
                font-weight: 500;
            }
            
            .propiedad-card-estado {
                display: inline-flex;
                align-items: center;
                padding: 0.25rem 0.75rem;
                border-radius: 20px;
                font-size: 0.75rem;
                font-weight: 600;
                margin-bottom: 1rem;
            }
            
            .propiedad-card-estado.disponible {
                background: #dcfce7;
                color: #166534;
            }
            
            .propiedad-card-estado.vendida {
                background: #fee2e2;
                color: #991b1b;
            }
            
            .propiedad-card-estado.reservada {
                background: #fef3c7;
                color: #92400e;
            }
            
            .propiedad-card-actions {
                display: flex;
                gap: 0.75rem;
                padding-top: 1rem;
                border-top: 1px solid #e5e7eb;
            }
            
            .propiedad-card-actions button,
            .propiedad-card-actions a {
                flex: 1;
                padding: 0.75rem;
                border-radius: 8px;
                font-size: 0.875rem;
                font-weight: 500;
                text-align: center;
                text-decoration: none;
                min-height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
            }
            
            .propiedad-card-actions .btn-ver {
                background: #dbeafe;
                color: #1e40af;
            }
            
            .propiedad-card-actions .btn-editar {
                background: #fef3c7;
                color: #92400e;
            }
            
            .propiedad-card-actions .btn-eliminar {
                background: #fee2e2;
                color: #991b1b;
            }
        }
        
        /* Estado vac√≠o responsivo */
        @media (max-width: 768px) {
            .propiedades-empty {
                padding: 2rem 1rem;
                text-align: center;
            }
            
            .propiedades-empty i {
                width: 3rem;
                height: 3rem;
                margin-bottom: 1rem;
            }
            
            .propiedades-empty h3 {
                font-size: 1.125rem;
                margin-bottom: 0.5rem;
            }
            
            .propiedades-empty p {
                font-size: 0.875rem;
                margin-bottom: 1.5rem;
            }
            
            .propiedades-empty button {
                width: 100%;
                padding: 0.875rem;
                font-size: 0.875rem;
                min-height: 44px;
            }
        }
        
        /* Tablet (768px - 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .propiedades-container {
                padding: 1rem;
            }
            
            .propiedades-header-buttons {
                flex-direction: row;
                gap: 1rem;
            }
            
            .propiedades-header-buttons button {
                width: auto;
                padding: 0.75rem 1.5rem;
            }
            
            .propiedades-tabla-desktop {
                display: table;
            }
            
            .propiedades-cards-mobile {
                display: none;
            }
            
            /* Tabla optimizada para tablet */
            .propiedades-tabla-desktop th,
            .propiedades-tabla-desktop td {
                padding: 0.75rem 0.5rem;
                font-size: 0.875rem;
            }
            
            .propiedades-tabla-desktop th:first-child,
            .propiedades-tabla-desktop td:first-child {
                width: 60px;
            }
            
            .propiedades-tabla-desktop th:nth-child(2),
            .propiedades-tabla-desktop td:nth-child(2) {
                min-width: 150px;
            }
        }
        
        /* Desktop (1025px+) */
        @media (min-width: 1025px) {
            .propiedades-container {
                padding: 1.5rem;
            }
            
            .propiedades-header-buttons {
                flex-direction: row;
                gap: 1rem;
            }
            
            .propiedades-header-buttons button {
                width: auto;
                padding: 0.75rem 1.5rem;
            }
            
            .propiedades-tabla-desktop {
                display: table;
            }
            
            .propiedades-cards-mobile {
                display: none;
            }
        }
        
        /* Mejoras de accesibilidad y usabilidad para propiedades */
        @media (max-width: 768px) {
            /* Asegurar que los inputs sean f√°ciles de usar en m√≥vil */
            .propiedades-search input {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                font-size: 16px; /* Previene zoom en iOS */
            }
            
            /* Mejorar el contraste en pantallas peque√±as */
            .propiedad-card-detail-label {
                color: #374151;
                font-weight: 600;
            }
            
            /* Asegurar que los botones sean f√°ciles de tocar */
            .propiedades-header-buttons button,
            .propiedad-card-actions button,
            .propiedad-card-actions a {
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
            }
            
            /* Mejorar el espaciado entre elementos t√°ctiles */
            .propiedades-header-buttons,
            .propiedad-card-actions {
                gap: 0.75rem;
            }
        }
        
        /* Optimizaciones para pantallas de alta densidad */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .propiedad-card-imagen {
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
            }
        }
        
        /* Mejoras para dispositivos con orientaci√≥n landscape */
        @media (orientation: landscape) and (max-height: 600px) {
            .propiedades-container {
                padding: 0.5rem;
            }
            
            .propiedades-header {
                margin-bottom: 0.75rem;
            }
            
            .propiedades-tabla {
                padding: 0.75rem;
            }
            
            .propiedad-card {
                margin-bottom: 0.75rem;
            }
            
            .propiedad-card-header {
                padding: 0.75rem;
            }
            
            .propiedad-card-body {
                padding: 0.75rem;
            }
        }

        /* ===== RESPONSIVE DESIGN PARA MODAL DE NUEVA PROPIEDAD ===== */
        
        /* Configuraci√≥n global para el modal de nueva propiedad */
        @media (max-width: 768px) {
            .modal-propiedad-container {
                padding: 0.5rem;
            }
            
            .modal-propiedad-content {
                max-width: 95vw;
                max-height: 95vh;
                margin: 0.5rem;
            }
            
            /* Header del modal responsivo */
            .modal-propiedad-header {
                padding: 1rem;
            }
            
            .modal-propiedad-header h2 {
                font-size: 1.25rem;
                margin-bottom: 0.25rem;
            }
            
            .modal-propiedad-header p {
                font-size: 0.875rem;
            }
            
            .modal-propiedad-header button {
                width: 2rem;
                height: 2rem;
            }
        }
        
        /* Formulario de nueva propiedad responsivo */
        @media (max-width: 768px) {
            .modal-propiedad-form {
                padding: 1rem;
            }
            
            .modal-propiedad-section {
                margin-bottom: 1.5rem;
            }
            
            .modal-propiedad-section h3 {
                font-size: 1.125rem;
                margin-bottom: 1rem;
            }
            
            /* Grid de campos en m√≥vil */
            .modal-propiedad-grid {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }
            
            .modal-propiedad-grid-2 {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }
            
            .modal-propiedad-grid-3 {
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }
            
            .modal-propiedad-field {
                width: 100%;
            }
            
            .modal-propiedad-field label {
                font-size: 0.875rem;
                margin-bottom: 0.5rem;
                display: block;
            }
            
            .modal-propiedad-field input,
            .modal-propiedad-field select,
            .modal-propiedad-field textarea {
                width: 100%;
                padding: 0.75rem;
                font-size: 16px; /* Previene zoom en iOS */
                border-radius: 8px;
            }
            
            /* Campos con iconos */
            .modal-propiedad-field .relative {
                position: relative;
            }
            
            .modal-propiedad-field .relative input {
                padding-left: 2.5rem;
            }
            
            .modal-propiedad-field .relative .absolute {
                position: absolute;
                top: 50%;
                transform: translateY(-50%);
                left: 0.75rem;
                color: #6b7280;
                font-size: 0.875rem;
            }
            
            .modal-propiedad-field .relative .absolute.right-0 {
                left: auto;
                right: 0.75rem;
            }
            
            /* Botones de acci√≥n */
            .modal-propiedad-actions {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
                margin-top: 1.5rem;
            }
            
            .modal-propiedad-actions button {
                width: 100%;
                padding: 0.875rem;
                font-size: 0.875rem;
                border-radius: 8px;
                min-height: 44px; /* Tama√±o m√≠nimo para touch */
            }
        }
        
        /* Secci√≥n de im√°genes responsiva */
        @media (max-width: 768px) {
            .modal-propiedad-imagenes {
                margin-bottom: 1.5rem;
            }
            
            .modal-propiedad-imagenes h3 {
                font-size: 1.125rem;
                margin-bottom: 1rem;
            }
            
            .modal-propiedad-imagen-field {
                margin-bottom: 1rem;
            }
            
            .modal-propiedad-imagen-field label {
                font-size: 0.875rem;
                margin-bottom: 0.5rem;
            }
            
            .modal-propiedad-imagen-field input[type="file"] {
                width: 100%;
                padding: 0.75rem;
                font-size: 16px;
                border-radius: 8px;
            }
            
            /* √Årea de upload */
            .modal-propiedad-upload-area {
                padding: 1.5rem;
                text-align: center;
                border-radius: 12px;
            }
            
            .modal-propiedad-upload-area i {
                width: 3rem;
                height: 3rem;
                margin-bottom: 1rem;
            }
            
            .modal-propiedad-upload-area h6 {
                font-size: 0.875rem;
                margin-bottom: 0.5rem;
            }
            
            .modal-propiedad-upload-area p {
                font-size: 0.75rem;
                margin-bottom: 1rem;
            }
            
            .modal-propiedad-upload-area button {
                width: 100%;
                padding: 0.875rem;
                font-size: 0.875rem;
                min-height: 44px;
            }
            
            /* Grid de preview de fotos */
            .modal-propiedad-fotos-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 0.75rem;
                margin-top: 1rem;
            }
            
            .modal-propiedad-foto-preview {
                position: relative;
                border-radius: 8px;
                overflow: hidden;
                aspect-ratio: 1;
            }
            
            .modal-propiedad-foto-preview img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            
            .modal-propiedad-foto-remove {
                position: absolute;
                top: 0.25rem;
                right: 0.25rem;
                background: rgba(239, 68, 68, 0.9);
                color: white;
                border: none;
                border-radius: 50%;
                width: 1.5rem;
                height: 1.5rem;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.75rem;
                cursor: pointer;
            }
            
            /* Info box */
            .modal-propiedad-info-box {
                padding: 1rem;
                margin-top: 1rem;
                border-radius: 8px;
            }
            
            .modal-propiedad-info-box i {
                width: 1.25rem;
                height: 1.25rem;
                margin-right: 0.75rem;
            }
            
            .modal-propiedad-info-box p {
                font-size: 0.875rem;
                line-height: 1.5;
            }
        }
        
        /* Estilos para la secci√≥n de coordenadas */
        .modal-propiedad-coordenadas {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .modal-propiedad-coordenadas label {
            color: #1e293b;
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }
        
        .modal-propiedad-coordenadas p {
            color: #64748b;
            font-size: 0.875rem;
            margin-bottom: 1rem;
            line-height: 1.5;
        }
        
        .modal-propiedad-coordenadas .modal-propiedad-field {
            position: relative;
        }
        
        .modal-propiedad-coordenadas .modal-propiedad-field .relative input {
            padding-right: 3rem;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }
        
        .modal-propiedad-coordenadas .modal-propiedad-field .relative input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            outline: none;
        }
        
        .modal-propiedad-coordenadas .modal-propiedad-field .relative .absolute.right-0 {
            color: #6b7280;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .modal-propiedad-coordenadas .text-gray-500.text-xs {
            color: #6b7280;
            font-size: 0.75rem;
            margin-top: 0.25rem;
            line-height: 1.4;
        }
        
        /* Secci√≥n de amenidades responsiva */
        @media (max-width: 768px) {
            .modal-propiedad-coordenadas {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .modal-propiedad-coordenadas label {
                font-size: 0.9rem;
            }
            
            .modal-propiedad-coordenadas p {
                font-size: 0.8rem;
            }
            
            .modal-propiedad-amenidades {
                margin-bottom: 1.5rem;
            }
            
            .modal-propiedad-amenidades label {
                font-size: 1rem;
                margin-bottom: 0.5rem;
            }
            
            .modal-propiedad-amenidades p {
                font-size: 0.875rem;
                margin-bottom: 1rem;
            }
            
            .modal-propiedad-amenidades-grid {
                display: grid;
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .modal-propiedad-amenidad-item {
                padding: 1rem;
                border-radius: 8px;
                min-height: 44px;
                display: flex;
                align-items: center;
            }
            
            .modal-propiedad-amenidad-item input[type="checkbox"] {
                width: 1.25rem;
                height: 1.25rem;
                margin-right: 0.75rem;
            }
            
            .modal-propiedad-amenidad-item label {
                font-size: 0.875rem;
                margin-bottom: 0;
                flex: 1;
            }
            
            .modal-propiedad-amenidad-item i {
                margin-right: 0.5rem;
                font-size: 1rem;
            }
        }
        
        /* Tablet (768px - 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .modal-propiedad-container {
                padding: 1rem;
            }
            
            .modal-propiedad-content {
                max-width: 90vw;
                margin: 1rem;
            }
            
            .modal-propiedad-grid-2 {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1.5rem;
            }
            
            .modal-propiedad-grid-3 {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1.5rem;
            }
            
            .modal-propiedad-actions {
                flex-direction: row;
                gap: 1rem;
            }
            
            .modal-propiedad-amenidades-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
            }
            
            .modal-propiedad-fotos-grid {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 1rem;
            }
        }
        
        /* Desktop (1025px+) */
        @media (min-width: 1025px) {
            .modal-propiedad-container {
                padding: 1.5rem;
            }
            
            .modal-propiedad-content {
                max-width: 6xl;
                margin: 1.5rem;
            }
            
            .modal-propiedad-grid-2 {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 2rem;
            }
            
            .modal-propiedad-grid-3 {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
                gap: 2rem;
            }
            
            .modal-propiedad-actions {
                flex-direction: row;
                gap: 1rem;
            }
            
            .modal-propiedad-amenidades-grid {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
                gap: 1rem;
            }
            
            .modal-propiedad-fotos-grid {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 1rem;
            }
        }
        
        /* Mejoras de accesibilidad y usabilidad para el modal de propiedad */
        @media (max-width: 768px) {
            /* Asegurar que los inputs sean f√°ciles de usar en m√≥vil */
            .modal-propiedad-field input,
            .modal-propiedad-field select,
            .modal-propiedad-field textarea {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                font-size: 16px; /* Previene zoom en iOS */
            }
            
            /* Mejorar el contraste en pantallas peque√±as */
            .modal-propiedad-field label {
                color: #374151;
                font-weight: 600;
            }
            
            /* Asegurar que los botones sean f√°ciles de tocar */
            .modal-propiedad-actions button,
            .modal-propiedad-upload-area button,
            .modal-propiedad-foto-remove {
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
            }
            
            /* Mejorar el espaciado entre elementos t√°ctiles */
            .modal-propiedad-actions,
            .modal-propiedad-amenidades-grid {
                gap: 0.75rem;
            }
            
            /* Checkboxes m√°s grandes para touch */
            .modal-propiedad-amenidad-item input[type="checkbox"] {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                width: 1.5rem;
                height: 1.5rem;
                border: 2px solid #d1d5db;
                border-radius: 4px;
                background: white;
                position: relative;
                cursor: pointer;
            }
            
            .modal-propiedad-amenidad-item input[type="checkbox"]:checked {
                background: #3b82f6;
                border-color: #3b82f6;
            }
            
            .modal-propiedad-amenidad-item input[type="checkbox"]:checked::after {
                content: '‚úì';
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: white;
                font-size: 0.875rem;
                font-weight: bold;
            }
        }
        
        /* Optimizaciones para pantallas de alta densidad */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .modal-propiedad-foto-preview img {
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
            }
        }
        
        /* Mejoras para dispositivos con orientaci√≥n landscape */
        @media (orientation: landscape) and (max-height: 600px) {
            .modal-propiedad-container {
                padding: 0.5rem;
            }
            
            .modal-propiedad-content {
                max-height: 90vh;
            }
            
            .modal-propiedad-header {
                padding: 0.75rem;
            }
            
            .modal-propiedad-form {
                padding: 0.75rem;
            }
            
            .modal-propiedad-section {
                margin-bottom: 1rem;
            }
            
            .modal-propiedad-upload-area {
                padding: 1rem;
            }
        }

        /* ===== MODAL DE INFORMACI√ìN 2FA ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 0;
            max-width: 90vw;
            max-height: 90vh;
            width: 500px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            transform: scale(0.9) translateY(20px);
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .modal-overlay.active .modal-content {
            transform: scale(1) translateY(0);
        }
        
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
        }
        
        .modal-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-title i {
            margin-right: 0.75rem;
            font-size: 1.75rem;
        }
        
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .modal-body {
            padding: 2rem;
        }
        
        .modal-text {
            color: #374151;
            line-height: 1.7;
            font-size: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .modal-features {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .modal-features h4 {
            color: #1f2937;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }
        
        .modal-features h4 i {
            color: #667eea;
            margin-right: 0.5rem;
        }
        
        .modal-features ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .modal-features li {
            padding: 0.5rem 0;
            position: relative;
            padding-left: 1.5rem;
            color: #4b5563;
        }
        
        .modal-features li::before {
            content: '‚úì';
            position: absolute;
            left: 0;
            color: #22c55e;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .modal-footer {
            padding: 1.5rem 2rem;
            background: #f9fafb;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: center;
        }
        
        .modal-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .modal-btn i {
            margin-right: 0.5rem;
        }
        
        /* Responsive para el modal */
        @media (max-width: 768px) {
            .modal-content {
                width: 95vw;
                margin: 1rem;
            }
            
            .modal-header {
                padding: 1.5rem;
            }
            
            .modal-title {
                font-size: 1.25rem;
            }
            
            .modal-body {
                padding: 1.5rem;
            }
            
            .modal-footer {
                padding: 1rem 1.5rem;
            }
        }
        
        @media (max-width: 480px) {
            .modal-header {
                padding: 1rem;
            }
            
            .modal-title {
                font-size: 1.1rem;
            }
            
            .modal-body {
                padding: 1rem;
            }
            
            .modal-features {
                padding: 1rem;
            }
        }
    </style>
    
    <!-- Optimized initialization script -->
    <script>
        // Dashboard initialization and responsive behavior
        (function() {
            'use strict';
            
            // Configuration
            const CONFIG = {
                breakpoints: {
                    mobile: 640,
                    tablet: 1024,
                    desktop: 1035
                },
                sidebar: {
                    width: 280,
                    collapsed: 80
                },
                storage: {
                    key: 'sidebar-collapsed'
                }
            };
            
            // Utility functions
            const utils = {
                getScreenWidth: () => window.innerWidth,
                isLargeScreen: () => utils.getScreenWidth() > CONFIG.breakpoints.desktop,
                isMediumScreen: () => {
                    const width = utils.getScreenWidth();
                    return width > CONFIG.breakpoints.mobile && width <= CONFIG.breakpoints.desktop;
                },
                isMobileScreen: () => utils.getScreenWidth() <= CONFIG.breakpoints.mobile,
                setCSSVariable: (name, value) => {
                    document.documentElement.style.setProperty(name, value);
                }
            };
            
            // Initialize CSS variables based on screen size
            function initializeCSSVariables() {
                const screenWidth = utils.getScreenWidth();
                
                if (utils.isLargeScreen()) {
                    const isCollapsed = localStorage.getItem(CONFIG.storage.key) === 'true';
                    const sidebarWidth = isCollapsed ? CONFIG.sidebar.collapsed : CONFIG.sidebar.width;
                    const mainMargin = isCollapsed ? CONFIG.sidebar.collapsed : CONFIG.sidebar.width;
                    
                    utils.setCSSVariable('--sidebar-width', `${sidebarWidth}px`);
                    utils.setCSSVariable('--main-margin', `${mainMargin}px`);
                } else {
                    utils.setCSSVariable('--sidebar-width', `${CONFIG.sidebar.width}px`);
                    utils.setCSSVariable('--main-margin', utils.isMobileScreen() ? '0px' : `${CONFIG.sidebar.collapsed}px`);
                }
            }
            
            // Initialize on load
            initializeCSSVariables();
            
            // Make functions globally available
            window.DashboardUtils = utils;
            window.DashboardConfig = CONFIG;
        })();
    </script>
</head>
    
<body class="bg-gray-50 min-h-screen">
    <!-- Layout Principal -->
    <div class="flex h-screen">
        
        <!-- Overlay para m√≥vil -->
        <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden hidden"></div>
        
        <!-- Sidebar -->
        <aside id="sidebar" class="fixed lg:relative inset-y-0 left-0 z-50 w-64 sm:w-72 bg-gradient-to-b from-slate-800 to-slate-900 shadow-lg border-r border-slate-700 flex flex-col transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out">
            
            <!-- Logo/Header del Sidebar -->
            <header class="p-4 sm:p-6 border-b border-slate-700">
                <div class="flex items-center">
                    <div class="w-8 h-8 sm:w-10 sm:h-10 bg-slate-700 rounded-lg flex items-center justify-center border border-slate-600">
                        <img src="{% static 'images/Logo empresa.jpeg' %}" alt="Logo Empresa" class="w-6 h-6 sm:w-8 sm:h-8 object-contain">
                    </div>
                    <div class="ml-3">
                        <h2 class="text-base sm:text-lg font-semibold text-white">Inmobiliaria</h2>
                        <p class="text-xs sm:text-sm text-slate-300">Admin Panel</p>
                    </div>
                </div>
            </header>
            
            <!-- Navegaci√≥n -->
            <nav class="flex-1 px-3 sm:px-4 py-4 sm:py-6 space-y-1 sm:space-y-2">
                <button id="btn-inicio" class="flex items-center w-full px-3 sm:px-4 py-2 sm:py-3 text-white bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg transform scale-105 shadow-lg transition-all duration-200">
                    <i data-lucide="home" class="w-4 h-4 sm:w-5 sm:h-5 mr-2 sm:mr-3"></i>
                    <span class="font-medium text-sm sm:text-base">Inicio</span>
                </button>
                
                <button id="btn-nueva-propiedad" class="flex items-center w-full px-3 sm:px-4 py-2 sm:py-3 text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-blue-500 hover:to-purple-600 hover:scale-105 rounded-lg transition-all duration-200">
                    <i data-lucide="plus-circle" class="w-4 h-4 sm:w-5 sm:h-5 mr-2 sm:mr-3"></i>
                    <span class="font-medium text-sm sm:text-base">Nueva Propiedad</span>
                </button>
                
                <button id="btn-gestionar-propiedades" class="flex items-center w-full px-3 sm:px-4 py-2 sm:py-3 text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-blue-500 hover:to-purple-600 hover:scale-105 rounded-lg transition-all duration-200">
                    <i data-lucide="list" class="w-4 h-4 sm:w-5 sm:h-5 mr-2 sm:mr-3"></i>
                    <span class="font-medium text-sm sm:text-base">Gestionar Propiedades</span>
                </button>
                
                <button id="btn-gestionar-cvs" class="flex items-center w-full px-3 sm:px-4 py-2 sm:py-3 text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-blue-500 hover:to-purple-600 hover:scale-105 rounded-lg transition-all duration-200">
                    <i data-lucide="file-text" class="w-4 h-4 sm:w-5 sm:h-5 mr-2 sm:mr-3"></i>
                    <span class="font-medium text-sm sm:text-base">Curr√≠culums</span>
                </button>
                
                <button id="btn-nuevo-usuario" class="flex items-center w-full px-3 sm:px-4 py-2 sm:py-3 text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-blue-500 hover:to-purple-600 hover:scale-105 rounded-lg transition-all duration-200">
                    <i data-lucide="user-plus" class="w-4 h-4 sm:w-5 sm:h-5 mr-2 sm:mr-3"></i>
                    <span class="font-medium text-sm sm:text-base">Nuevo Usuario</span>
                </button>
                
                <button id="btn-gestionar-resenas" class="flex items-center w-full px-3 sm:px-4 py-2 sm:py-3 text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-blue-500 hover:to-purple-600 hover:scale-105 rounded-lg transition-all duration-200">
                    <i data-lucide="star" class="w-4 h-4 sm:w-5 sm:h-5 mr-2 sm:mr-3"></i>
                    <span class="font-medium text-sm sm:text-base">Rese√±as</span>
                </button>
                
                <button id="btn-configuraciones" class="flex items-center w-full px-3 sm:px-4 py-2 sm:py-3 text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-blue-500 hover:to-purple-600 hover:scale-105 rounded-lg transition-all duration-200">
                    <i data-lucide="settings" class="w-4 h-4 sm:w-5 sm:h-5 mr-2 sm:mr-3"></i>
                    <span class="font-medium text-sm sm:text-base">Configuraciones</span>
                </button>
            </nav>
            
            <!-- Usuario y Logout -->
            <footer class="p-3 sm:p-4 border-t border-gray-200">
                <div class="flex items-center mb-2 sm:mb-3">
                    <div class="w-7 h-7 sm:w-8 sm:h-8 bg-blue-600 rounded-full flex items-center justify-center overflow-hidden flex-shrink-0">
                        {% if user.admincredentials.foto_perfil %}
                            <img src="{{ user.admincredentials.foto_perfil.url|safe|escapejs }}" alt="Foto de perfil" class="w-full h-full object-cover rounded-full">
                        {% else %}
                        <i data-lucide="user" class="w-3 h-3 sm:w-4 sm:h-4 text-white"></i>
                        {% endif %}
                    </div>
                    <div class="ml-2 sm:ml-3 min-w-0 flex-1">
                        <p class="text-xs sm:text-sm font-medium text-white truncate">{{ user.admincredentials.get_nombre_completo|default:user.username|default:"Administrador"|safe }}</p>
                        <p class="text-xs text-slate-300">Administrador</p>
                    </div>
                </div>
                <a href="{% url 'login:logout' %}" 
                   class="flex items-center w-full px-2 sm:px-3 py-1.5 sm:py-2 text-xs sm:text-sm text-slate-300 hover:text-white hover:bg-gradient-to-r hover:from-red-500 hover:to-red-600 rounded-lg transition-all duration-200">
                    <i data-lucide="log-out" class="w-3 h-3 sm:w-4 sm:h-4 mr-1.5 sm:mr-2"></i>
                    Cerrar Sesi√≥n
                </a>
            </footer>
        </aside>
        
        <!-- Immediate sidebar state application -->
        <script>
            // Apply sidebar state immediately based on screen size
            (function() {
                const screenWidth = window.innerWidth;
                const sidebar = document.getElementById('sidebar');
                const mainContent = document.getElementById('main-content');
                const collapseBtn = document.getElementById('sidebar-collapse');
                
                if (screenWidth <= 1035 && screenWidth > 640) {
                    // Medium screens - auto-collapse (CSS handles this, but ensure classes are applied)
                    if (sidebar) {
                        sidebar.classList.add('collapsed');
                    }
                    if (mainContent) {
                        mainContent.classList.add('sidebar-collapsed');
                    }
                    if (collapseBtn) {
                        collapseBtn.style.display = 'none';
                    }
                } else if (screenWidth > 1035) {
                    // Large screens - check localStorage for manual state
                    const isCollapsed = localStorage.getItem('sidebar-collapsed') === 'true';
                    if (isCollapsed) {
                        if (sidebar) {
                            sidebar.classList.add('collapsed');
                        }
                        if (mainContent) {
                            mainContent.classList.add('sidebar-collapsed');
                        }
                        if (collapseBtn) {
                            const icon = collapseBtn.querySelector('i');
                            if (icon) {
                                icon.className = 'fas fa-chevron-right text-gray-600 text-lg';
                            }
                        }
                    }
                }
            })();
        </script>

    <!-- Contenido Principal -->
        <main class="flex-1 flex flex-col overflow-hidden">
            
            <!-- Header Principal -->
            <header class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 shadow-lg border-b border-purple-500/30 px-4 sm:px-6 py-7 sm:py-9 relative overflow-hidden">
                <!-- Efecto glassmorphism de fondo -->
                <div class="absolute inset-0 bg-gradient-to-r from-indigo-500/20 via-purple-500/20 to-pink-500/20 backdrop-blur-sm"></div>
                <!-- Contenido del header -->
                <div class="relative z-10">
                <div class="flex items-center justify-between">
                    <div class="flex items-center min-w-0 flex-1">
                        <!-- Bot√≥n de men√∫ para m√≥vil con glassmorphism -->
                        <button id="sidebar-toggle" class="lg:hidden mr-3 sm:mr-4 p-2 rounded-lg bg-white/10 backdrop-blur-sm text-white hover:bg-white/20 hover:text-white focus:outline-none focus:ring-2 focus:ring-white/30 border border-white/20 transition-all duration-200">
                            <i data-lucide="menu" class="w-5 h-5"></i>
                        </button>
                        <div class="min-w-0 flex-1">
                            <h1 class="text-lg sm:text-xl lg:text-2xl font-bold text-white truncate">Dashboard Administrativo</h1>
                            <p class="text-xs sm:text-sm text-white mt-1 truncate">Bienvenido, {{ user.admincredentials.get_nombre_completo|default:user.username|default:"Administrador"|safe }}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 sm:space-x-4 ml-2">
                        <!-- Fecha con tarjeta transparente -->
                        <div class="bg-white/10 backdrop-blur-sm rounded-lg px-3 py-2 border border-white/20">
                            <div class="text-xs sm:text-sm text-white flex items-center">
                                <i data-lucide="calendar" class="w-3 h-3 sm:w-4 sm:h-4 inline mr-1"></i>
                                <span id="currentDateFull" class="hidden xl:inline"></span>
                                <span id="currentDateMedium" class="hidden lg:inline xl:hidden"></span>
                                <span id="currentDateShort" class="hidden md:inline lg:hidden"></span>
                                <span id="currentDateMinimal" class="inline md:hidden"></span>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
            </header>

            <!-- Contenido Principal -->
            <div class="flex-1 overflow-y-auto p-3 sm:p-4 lg:p-6" style="background-color: #e5e7eb;">
                
                <!-- Contenido del Dashboard (por defecto) -->
                <div id="dashboard-content">
                    <!-- Widgets principales en fila -->
                <section class="mb-6 sm:mb-8">
                        <div class="widget-container">
                            
                            <!-- Widget de Clics en Ver Detalle (60%) -->
                            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6 animate-fade-in" style="flex: 0 0 60%;">
                        <!-- Header del Widget -->
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
                            <h2 class="text-lg sm:text-xl font-semibold text-gray-900 mb-4 sm:mb-0">
                                Clics en Ver Detalle por Mes
                            </h2>
                            
                            <!-- Selector de Propiedad -->
                            <div class="flex items-center space-x-2">
                                <label for="propiedad-select" class="text-sm font-medium text-gray-700">Propiedad:</label>
                                <select id="propiedad-select" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
                                    <option value="todas">Todas las Propiedades</option>
                                    {% for propiedad in todas_propiedades %}
                                    <option value="{{ propiedad.id|safe|escapejs }}">{{ propiedad.titulo|safe }}</option>
                                    {% endfor %}
                                </select>
                        </div>
                        </div>
                        
                        <!-- Gr√°fico de Barras -->
                        <div class="relative">
                            <!-- T√≠tulo del Gr√°fico -->
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-medium text-gray-600">Clics Mensuales</h3>
                                <div class="text-right">
                                        <div class="text-2xl font-bold text-blue-600 counter-animation" id="total-clicks">{{ total_clicks|default:"0"|safe }}</div>
                                    <div class="text-xs text-gray-500">Total este a√±o</div>
                    </div>
                </div>
                
                            <!-- Gr√°fico de Barras Verticales -->
                            <div class="h-64 flex items-end justify-between space-x-1 sm:space-x-2 px-2" id="grafico-barras">
                                {% for mes_data in clicks_por_mes %}
                                <div class="flex flex-col items-center flex-1">
                                    <div class="w-full bg-gray-100 rounded-t-lg relative overflow-hidden mb-2" style="height: 120px;">
                                            <div class="bar-chart w-full absolute bottom-0" 
                                                 style="height: 0%;" 
                                                 data-value="{{ mes_data.clicks|safe|escapejs }}"></div>
                                        <div class="absolute inset-0 flex items-center justify-center text-xs font-semibold text-white">{{ mes_data.clicks|safe }}</div>
                                    </div>
                                    <div class="text-xs text-gray-600 font-medium">{{ mes_data.mes|safe }}</div>
                                </div>
                                {% endfor %}
                            </div>
                            
                            <!-- Leyenda -->
                            <div class="mt-4 pt-4 border-t border-gray-200">
                                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between text-xs text-gray-500 space-y-2 sm:space-y-0">
                                    <div class="flex items-center space-x-4">
                                        <div class="flex items-center space-x-2">
                                                <div class="w-3 h-3 rounded-full" style="background: linear-gradient(to right, var(--color-bajo), var(--color-medio), var(--color-alto));"></div>
                                            <span>Escala de Calor</span>
                                        </div>
                                        <div class="flex items-center space-x-1">
                                                <span class="text-green-600 font-medium">0-60</span>
                                            <span>‚Üí</span>
                                                <span class="text-yellow-600 font-medium">61-150</span>
                                            <span>‚Üí</span>
                                                <span class="text-red-600 font-medium">151+</span>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <span id="leyenda-maximo">M√°ximo: 170 clics (Junio)</span>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
            
                        <!-- Tarjeta de Formularios de Contacto (40%) -->
                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6 animate-fade-in" style="flex: 0 0 40%;">
                <!-- Header de la Tarjeta -->
                <div class="text-center mb-6">
                    <!-- Icono Principal -->
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-green-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                        <i data-lucide="mail" class="w-8 h-8 text-white"></i>
                    </div>
                    
                    <!-- T√≠tulo -->
                    <h2 class="text-lg sm:text-xl font-semibold text-gray-900 mb-2">
                        Formularios Recibidos
                    </h2>
                    <p class="text-sm text-gray-600">Contactos e inter√©s en propiedades</p>
                </div>
                
                <!-- Contador Principal -->
                <div class="text-center mb-6">
                    <div class="text-4xl sm:text-5xl font-bold bg-gradient-to-r from-blue-600 to-green-600 bg-clip-text text-transparent mb-2 counter-animation" id="total-formularios">
                        {{ total_formularios_mes|floatformat:0|safe }}
                    </div>
                    <div class="flex items-center justify-center space-x-2 text-sm text-gray-600">
                        {% if cambio_porcentaje > 0 %}
                            <i data-lucide="trending-up" class="w-4 h-4 text-green-500"></i>
                            <span class="text-green-600">+{{ cambio_porcentaje|safe }}% este mes</span>
                        {% elif cambio_porcentaje < 0 %}
                            <i data-lucide="trending-down" class="w-4 h-4 text-red-500"></i>
                            <span class="text-red-600">{{ cambio_porcentaje|safe }}% este mes</span>
                        {% else %}
                            <i data-lucide="minus" class="w-4 h-4 text-gray-500"></i>
                            <span class="text-gray-600">Sin cambios este mes</span>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Estad√≠sticas Detalladas -->
                <div class="space-y-3 mb-6">
                    <!-- Formularios de Contacto -->
                    <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="user-plus" class="w-4 h-4 text-blue-600"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-900">Contacto General</p>
                                <p class="text-xs text-gray-600">Formularios de contacto</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold text-blue-600">{{ formularios_contacto|safe }}</div>
                        </div>
                    </div>
                    
                    <!-- Consultas de Propiedades -->
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="home" class="w-4 h-4 text-green-600"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-900">Consultas de Propiedades</p>
                                <p class="text-xs text-gray-600">Solicitudes espec√≠ficas</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold text-green-600">{{ formularios_consulta_propiedad|safe }}</div>
                        </div>
                    </div>
                    
                    <!-- Formularios de CV -->
                    <div class="flex items-center justify-between p-3 bg-purple-50 rounded-lg">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="file-text" class="w-4 h-4 text-purple-600"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-900">Curr√≠culums</p>
                                <p class="text-xs text-gray-600">CVs enviados</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold text-purple-600">{{ formularios_cv|safe }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

                <!-- Tarjetas de Estad√≠sticas -->
                <section class="mb-6 sm:mb-8">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
                        
                        <!-- Total Propiedades -->
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6 hover:shadow-md transition-all duration-200 animate-fade-in">
                            <div class="flex items-center">
                                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-3 sm:mr-4">
                                    <i data-lucide="home" class="w-5 h-5 sm:w-6 sm:h-6 text-blue-600"></i>
                                </div>
                                <div class="min-w-0 flex-1">
                                    <div class="text-xl sm:text-2xl font-bold text-gray-900 mb-1 counter-animation" id="totalProperties">{{ total_propiedades|default:"0"|safe }}</div>
                                    <div class="text-xs sm:text-sm text-gray-600">Total Propiedades</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Total Usuarios -->
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6 hover:shadow-md transition-all duration-200 animate-fade-in">
                            <div class="flex items-center">
                                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-green-100 rounded-lg flex items-center justify-center mr-3 sm:mr-4">
                                    <i data-lucide="users" class="w-5 h-5 sm:w-6 sm:h-6 text-green-600"></i>
                                </div>
                                <div class="min-w-0 flex-1">
                                    <div class="text-xl sm:text-2xl font-bold text-gray-900 mb-1 counter-animation" id="totalUsers" data-count="{{ total_users|default:"0"|safe }}">{{ total_users|default:"0"|safe }}</div>
                                    <div class="text-xs sm:text-sm text-gray-600">Total Usuarios</div>
                                </div>
                                <button onclick="actualizarContadorUsuarios()" class="ml-2 p-1 text-gray-400 hover:text-green-600 transition-colors" title="Actualizar contador">
                                    <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                </button>
                            </div>
                </div>
                        
                        <!-- Total Rese√±as -->
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6 hover:shadow-md transition-all duration-200 animate-fade-in sm:col-span-2 lg:col-span-1">
                            <div class="flex items-center">
                                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-yellow-100 rounded-lg flex items-center justify-center mr-3 sm:mr-4">
                                    <i data-lucide="star" class="w-5 h-5 sm:w-6 sm:h-6 text-yellow-600"></i>
                                </div>
                                <div class="min-w-0 flex-1">
                                    <div class="text-xl sm:text-2xl font-bold text-gray-900 mb-1 counter-animation" id="totalReviews">{{ total_resenas|default:"0"|safe }}</div>
                                    <div class="text-xs sm:text-sm text-gray-600">Total Rese√±as</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Actividades Recientes -->
                <section>
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 animate-fade-in">
                        <div class="px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <h2 class="text-base sm:text-lg font-semibold text-gray-900 flex items-center">
                                    <i data-lucide="activity" class="w-4 h-4 sm:w-5 sm:h-5 text-blue-600 mr-2"></i>
                                    Actividades Recientes
                                </h2>
                                <button id="btn-refrescar-actividades" class="text-gray-500 hover:text-blue-600 transition-colors" title="Actualizar actividades">
                                    <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                        <div class="p-4 sm:p-6">
                            <div id="actividades-container" class="space-y-3">
                                <!-- Las actividades se cargar√°n din√°micamente aqu√≠ -->
                                <div class="text-center py-8">
                                    <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                        <i data-lucide="activity" class="w-6 h-6 text-gray-400"></i>
                                    </div>
                                    <p class="text-sm text-gray-500">Cargando actividades...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                </div>
                
                <!-- Contenido de Gesti√≥n de Propiedades (oculto por defecto) -->
                <div id="gestion-propiedades-content" class="hidden propiedades-container">
                    <!-- Header de Gesti√≥n -->
                    <div class="mb-6 propiedades-header">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div>
                                <h1 class="text-2xl font-bold text-gray-900 mb-2">
                                    Gestionar Propiedades
                                </h1>
                                <p class="text-gray-600">Administra todas las propiedades del cat√°logo</p>
                            </div>
                            <div class="mt-4 sm:mt-0 flex gap-2 propiedades-header-buttons">
                                <button id="btn-volver-inicio-gestion" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                                    <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                                    Volver al Inicio
                                </button>
                                <button id="btn-nueva-propiedad-gestion" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                    <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                                    Nueva Propiedad
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Tabla de Propiedades -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 propiedades-tabla">
                        <div class="p-6 border-b border-gray-200 propiedades-tabla-header">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                                        <i data-lucide="list" class="w-5 h-5 mr-2 text-blue-600"></i>
                                        Lista de Propiedades (<span id="propiedades-count">{{ total_propiedades|default:"0"|safe }}</span>)
                                    </h3>
                                </div>
                                <div class="mt-4 sm:mt-0 propiedades-search">
                                    <div class="relative">
                                        <input type="text" id="searchInput" placeholder="Buscar propiedades..." 
                                               class="w-full sm:w-64 pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <i data-lucide="search" class="w-4 h-4 absolute left-3 top-3 text-gray-400"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full propiedades-tabla-desktop" id="propertiesTable">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Imagen</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">T√≠tulo</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Precio</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ubicaci√≥n</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="propertiesTableBody">
                                    {% for propiedad in propiedades_recientes %}
                                    <tr data-propiedad-id="{{ propiedad.id|safe|escapejs }}" class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            {% if propiedad.imagen_principal %}
                                                <img src="{{ propiedad.imagen_principal.url|safe|escapejs }}" alt="{{ propiedad.titulo|safe|escapejs }}" 
                                                     class="w-12 h-12 rounded-lg object-cover">
                                            {% else %}
                                                <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center">
                                                    <i data-lucide="home" class="w-5 h-5 text-gray-400"></i>
                                                </div>
                                            {% endif %}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div>
                                                <div class="text-sm font-medium text-gray-900">{{ propiedad.titulo|safe }}</div>
                                                <div class="text-sm text-gray-500">{{ propiedad.metros_cuadrados|safe }} m¬≤</div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                                                {{ propiedad.get_tipo_display|safe }}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-green-600">{{ propiedad.get_precio_formateado|safe }}</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            {% if propiedad.estado == 'disponible' %}
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                                    {{ propiedad.get_estado_display|safe }}
                                                </span>
                                            {% elif propiedad.estado == 'vendida' %}
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">
                                                    {{ propiedad.get_estado_display|safe }}
                                                </span>
                                            {% else %}
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                                    {{ propiedad.get_estado_display|safe }}
                                                </span>
                                            {% endif %}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            {{ propiedad.ubicacion|safe }}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            {{ propiedad.fecha_creacion|date:"d/m/Y"|safe }}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <div class="flex space-x-2">
                                                <a href="{% url 'propiedades:detalle' propiedad.slug %}" 
                                                   class="text-blue-600 hover:text-blue-900" title="Ver detalles">
                                                    <i data-lucide="eye" class="w-4 h-4"></i>
                                                </a>
                                                <a href="{% url 'login:editar_propiedad' propiedad.id %}" 
                                                   class="text-yellow-600 hover:text-yellow-900" title="Editar">
                                                    <i data-lucide="edit" class="w-4 h-4"></i>
                                                </a>
                                                <button type="button" class="text-red-600 hover:text-red-900" 
                                                        onclick="confirmarEliminar({{ propiedad.id|safe }}, '{{ propiedad.titulo|escapejs }}')" 
                                                        title="Eliminar">
                                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="8" class="px-6 py-12 text-center propiedades-empty">
                                            <div class="text-gray-500">
                                                <i data-lucide="home" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                                                <h3 class="text-lg font-medium text-gray-900 mb-2">No hay propiedades registradas</h3>
                                                <p class="text-gray-500 mb-4">Comienza agregando tu primera propiedad al cat√°logo.</p>
                                                <button id="btn-agregar-primera-propiedad" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                                    <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                                                    Agregar Primera Propiedad
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Cards m√≥viles (ocultas por defecto, se muestran en m√≥vil) -->
                        <div class="propiedades-cards-mobile" id="propertiesCardsMobile" style="display: none;">
                            <!-- Las cards se generar√°n din√°micamente aqu√≠ -->
                        </div>
                    </div>
                </div>
                
                <!-- Contenido de CVs (oculto por defecto) -->
                <div id="cvs-content" class="hidden cvs-container">
                    {% csrf_token %}
                    <!-- Header de CVs -->
                    <div class="mb-4 sm:mb-6 cvs-header">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div class="mb-3 sm:mb-0">
                                <h1 class="text-xl sm:text-2xl font-bold text-gray-900 mb-1 sm:mb-2">
                                    Curr√≠culums Recibidos
                                </h1>
                                <p class="text-sm sm:text-base text-gray-600">Gestiona los CVs enviados por candidatos</p>
                            </div>
                            <div class="mt-2 sm:mt-0">
                                <button id="btn-volver-inicio-cvs" class="w-full sm:w-auto bg-gray-500 text-white px-3 sm:px-4 py-2 sm:py-2 rounded-lg hover:bg-gray-600 transition-colors text-sm sm:text-base">
                                    <i data-lucide="arrow-left" class="w-4 h-4 mr-1 sm:mr-2"></i>
                                    Volver al Inicio
                                </button>
                            </div>
                        </div>
                    </div>


                    <!-- Lista de CVs -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="p-4 sm:p-6 border-b border-gray-200">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                                <h3 class="text-base sm:text-lg font-semibold text-gray-900 flex items-center mb-3 sm:mb-0">
                                    <i data-lucide="file-text" class="w-4 h-4 sm:w-5 sm:h-5 mr-2 text-purple-600"></i>
                                    CVs Recientes (<span id="cvs-count">{{ cvs_recientes|length|default:"0" }}</span>)
                                </h3>
                                <div class="mt-2 sm:mt-0">
                                    <button id="btn-refrescar-cvs" class="w-full sm:w-auto bg-blue-600 text-white px-3 sm:px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                        <i data-lucide="refresh-cw" class="w-4 h-4 mr-1 sm:mr-2"></i>
                                        Refrescar
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tabla Desktop -->
                        <div class="block overflow-x-auto cvs-desktop-table">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Candidato</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Posici√≥n</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Experiencia</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Archivo</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    {% for cv in cvs_recientes %}
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div>
                                                <div class="text-sm font-medium text-gray-900">{{ cv.nombre_completo|safe }}</div>
                                                <div class="text-sm text-gray-500">{{ cv.email|safe }}</div>
                                                {% if cv.telefono %}
                                                <div class="text-sm text-gray-500">{{ cv.telefono|safe }}</div>
                                                {% endif %}
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                                                {{ cv.get_posicion_interes_display|safe }}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            {{ cv.get_anos_experiencia_display|default:"No especificado"|safe }}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm text-gray-900">{{ cv.cv_file.name|slice:"-30:"|safe }}</div>
                                            <div class="text-sm text-gray-500">{{ cv.get_file_size|safe }} ({{ cv.get_file_extension|safe }})</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            {{ cv.fecha_envio|date:"d/m/Y H:i"|safe }}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <div class="flex space-x-2">
                                                <a href="{% url 'core:download_cv' cv.id %}" 
                                                   class="text-green-600 hover:text-green-900" 
                                                   title="Descargar CV"
                                                   target="_blank">
                                                    <i data-lucide="download" class="w-4 h-4"></i>
                                                </a>
                                                <a href="mailto:{{ cv.email|safe }}" 
                                                   class="text-blue-600 hover:text-blue-900" 
                                                   title="Enviar email">
                                                    <i data-lucide="mail" class="w-4 h-4"></i>
                                                </a>
                                                <button type="button" onclick="eliminarCV({{ cv.id|safe }}, '{{ cv.nombre_completo|escapejs }}')" 
                                                        class="text-red-600 hover:text-red-900" 
                                                        title="Eliminar CV">
                                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                                </button>
                                                {% if cv.procesado %}
                                                <span class="text-green-600" title="Procesado">
                                                    <i data-lucide="check-circle" class="w-4 h-4"></i>
                                                </span>
                                                {% else %}
                                                <span class="text-yellow-600" title="Pendiente">
                                                    <i data-lucide="clock" class="w-4 h-4"></i>
                                                </span>
                                                {% endif %}
                                            </div>
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="6" class="px-6 py-12 text-center">
                                            <div class="text-gray-500">
                                                <i data-lucide="file-text" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                                                <h3 class="text-lg font-medium text-gray-900 mb-2">No hay CVs recibidos</h3>
                                                <p class="text-gray-500">Los curr√≠culums enviados aparecer√°n aqu√≠.</p>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <!-- Cards M√≥viles -->
                        <div class="hidden p-4 sm:p-6 cvs-mobile-cards">
                            {% for cv in cvs_recientes %}
                            <div class="bg-white rounded-lg border border-gray-200 p-4 mb-4 cv-card">
                                <div class="flex items-start justify-between mb-3">
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-gray-900 text-base">{{ cv.nombre_completo|safe }}</h4>
                                        <p class="text-sm text-gray-600">{{ cv.email|safe }}</p>
                                        {% if cv.telefono %}
                                        <p class="text-sm text-gray-500">{{ cv.telefono|safe }}</p>
                                        {% endif %}
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        {% if cv.procesado %}
                                        <span class="text-green-600" title="Procesado">
                                            <i data-lucide="check-circle" class="w-5 h-5"></i>
                                        </span>
                                        {% else %}
                                        <span class="text-yellow-600" title="Pendiente">
                                            <i data-lucide="clock" class="w-5 h-5"></i>
                                        </span>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                                        {{ cv.get_posicion_interes_display|safe }}
                                    </span>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="text-sm text-gray-900 font-medium">Archivo CV</div>
                                    <div class="text-sm text-gray-600">{{ cv.cv_file.name|slice:"-30:"|safe }}</div>
                                    <div class="text-xs text-gray-500">{{ cv.get_file_size|safe }} ({{ cv.get_file_extension|safe }})</div>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="text-sm text-gray-500">{{ cv.fecha_envio|date:"d/m/Y H:i"|safe }}</div>
                                </div>
                                
                                <div class="flex space-x-2">
                                    <a href="{% url 'core:download_cv' cv.id %}" 
                                       class="flex-1 bg-green-600 text-white px-3 py-2 rounded-lg text-center text-sm hover:bg-green-700 transition-colors"
                                       target="_blank">
                                        <i data-lucide="download" class="w-4 h-4 mr-1"></i>
                                        Descargar
                                    </a>
                                    <a href="mailto:{{ cv.email|safe }}" 
                                       class="flex-1 bg-blue-600 text-white px-3 py-2 rounded-lg text-center text-sm hover:bg-blue-700 transition-colors">
                                        <i data-lucide="mail" class="w-4 h-4 mr-1"></i>
                                        Contactar
                                    </a>
                                    <button type="button" onclick="eliminarCV({{ cv.id|safe }}, '{{ cv.nombre_completo|escapejs }}')" 
                                            class="bg-red-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-red-700 transition-colors">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                            {% empty %}
                            <div class="text-center py-8 text-gray-500">
                                <i data-lucide="file-text" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                                <h3 class="text-lg font-medium text-gray-900 mb-2">No hay CVs recibidos</h3>
                                <p class="text-gray-500">Los curr√≠culums enviados aparecer√°n aqu√≠.</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <!-- Contenido de Configuraciones (oculto por defecto) -->
                <div id="configuraciones-content" class="hidden configuraciones-container">
                    <!-- Header de Configuraciones -->
                    <div class="mb-6 config-header">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div>
                                <h1 class="text-2xl font-bold text-gray-900 mb-2">
                                    Configuraciones
                                </h1>
                                <p class="text-gray-600">Gestiona tu perfil y configuraciones de cuenta</p>
                            </div>
                            <div class="mt-4 sm:mt-0">
                                <button id="btn-volver-inicio-config" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                                    <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                                    Volver al Inicio
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Formulario de Configuraci√≥n de Perfil -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="p-6 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                                <i data-lucide="user" class="w-5 h-5 mr-2 text-blue-600"></i>
                                Configuraci√≥n de Perfil
                            </h3>
                        </div>
                        
                        <div class="p-6 profile-form">
                            <!-- DEBUG: Datos del usuario -->
                            <!-- Nombre: {{ user.admincredentials.nombre|default:"No definido"|safe }} -->
                            <!-- Apellido: {{ user.admincredentials.apellido|default:"No definido"|safe }} -->
                            <!-- Tel√©fono: {{ user.admincredentials.telefono|default:"No definido"|safe }} -->
                            <!-- Fecha: {{ user.admincredentials.fecha_nacimiento|default:"No definido"|safe }} -->
                            
                            <form id="configuracion-perfil-form" method="post" enctype="multipart/form-data">
                                {% csrf_token %}
                                
                                <!-- Foto de Perfil -->
                                <div class="mb-8 form-section profile-photo-section">
                                    <label class="block text-sm font-semibold text-gray-700 mb-4">
                                        <i data-lucide="camera" class="w-4 h-4 mr-2 text-blue-600"></i>
                                        Foto de Perfil
                                    </label>
                                    
                                    <div class="flex items-center space-x-6 profile-photo-container">
                                        <!-- Preview de la foto actual -->
                                        <div class="relative">
                                            <div id="foto-perfil-preview" class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center overflow-hidden profile-photo-preview">
                                                {% if user.admincredentials.foto_perfil %}
                                                    <img src="{{ user.admincredentials.foto_perfil.url|safe|escapejs }}" alt="Foto de perfil" class="w-full h-full object-cover">
                                                {% else %}
                                                    <i data-lucide="user" class="w-8 h-8 text-gray-400"></i>
                                                {% endif %}
                                            </div>
                                            <button type="button" id="btn-cambiar-foto" class="absolute -bottom-1 -right-1 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center hover:bg-blue-700 transition-colors">
                                                <i data-lucide="camera" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                        
                                        <div class="flex-1 profile-photo-info">
                                            <input type="file" id="foto-perfil-input" name="foto_perfil" 
                                                   accept="image/jpeg,image/jpg,image/png,image/gif,image/webp" 
                                                   title="Solo se permiten archivos de imagen (JPEG, PNG, GIF, WebP)"
                                                   class="hidden">
                                            <div class="text-sm text-gray-600">
                                                <p class="font-medium">Cambiar foto de perfil</p>
                                                <p class="text-gray-500">JPG, PNG o GIF. M√°ximo 20MB</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Informaci√≥n Personal -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6 form-grid">
                                    <div class="form-field">
                                        <label for="nombre" class="block text-sm font-semibold text-gray-700 mb-2">
                                            Nombre
                                        </label>
                                        <input type="text" id="nombre" name="nombre" 
                                               value="{{ user.admincredentials.nombre|default:user.first_name|safe|escapejs }}" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    
                                    <div class="form-field">
                                        <label for="apellido" class="block text-sm font-semibold text-gray-700 mb-2">
                                            Apellido
                                        </label>
                                        <input type="text" id="apellido" name="apellido" 
                                               value="{{ user.admincredentials.apellido|default:user.last_name|safe|escapejs }}" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                </div>

                                <!-- Email (solo lectura) -->
                                <div class="mb-6 form-section">
                                    <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">
                                        <i data-lucide="mail" class="w-4 h-4 mr-2 text-blue-600"></i>
                                        Correo Electr√≥nico
                                    </label>
                                        <input type="email" id="email" name="email" 
                                               value="{{ user.email|safe|escapejs }}" 
                                               readonly
                                               pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}"
                                               title="Ingresa un correo electr√≥nico v√°lido"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-600">
                                    <p class="text-xs text-gray-500 mt-1">El correo electr√≥nico no se puede modificar</p>
                                </div>

                                <!-- Informaci√≥n Adicional -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6 form-grid">
                                    <div class="form-field">
                                        <label for="telefono" class="block text-sm font-semibold text-gray-700 mb-2">
                                            <i data-lucide="phone" class="w-4 h-4 mr-2 text-blue-600"></i>
                                            Tel√©fono
                                        </label>
                                        <input type="tel" id="telefono" name="telefono" 
                                               value="{{ user.admincredentials.telefono|default:'No definido'|safe|escapejs }}" 
                                               readonly
                                               pattern="^\+54\d{10,12}$"
                                               title="El tel√©fono debe comenzar con +54 y tener entre 10 y 12 d√≠gitos"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-600 cursor-not-allowed">
                                        <p class="text-xs text-gray-500 mt-1">El tel√©fono no se puede modificar</p>
                                    </div>
                                    
                                    <div class="form-field">
                                        <label for="fecha_nacimiento" class="block text-sm font-semibold text-gray-700 mb-2">
                                            <i data-lucide="calendar" class="w-4 h-4 mr-2 text-blue-600"></i>
                                            Fecha de Nacimiento
                                        </label>
                                        <input type="date" id="fecha_nacimiento" name="fecha_nacimiento" 
                                               value="{% if user.admincredentials.fecha_nacimiento %}{{ user.admincredentials.fecha_nacimiento|date:'Y-m-d'|safe }}{% else %}No definido{% endif %}" 
                                               readonly
                                               min="1900-01-01"
                                               max="{% now 'Y' %}-12-31"
                                               title="La fecha debe estar entre 1900 y {% now 'Y' %}"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-600 cursor-not-allowed">
                                        <p class="text-xs text-gray-500 mt-1">La fecha de nacimiento no se puede modificar</p>
                                    </div>
                                </div>

                                <!-- Botones de Acci√≥n -->
                                <div class="flex flex-col sm:flex-row gap-4 justify-end form-actions">
                                    <button type="button" id="cancelar-config" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                                        <i data-lucide="x" class="w-4 h-4 mr-2"></i>
                                        Cancelar
                                    </button>
                                    <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                        <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                                        Guardar Cambios
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Tarjeta de Configuraci√≥n 2FA -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 mt-6">
                        <div class="p-6 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                                {% if user.admincredentials.two_factor_enabled %}
                                    <i data-lucide="shield-check" class="w-5 h-5 mr-2 text-green-600"></i>
                                    Autenticaci√≥n de Dos Factores (2FA) - Activo
                                {% else %}
                                    <i data-lucide="shield" class="w-5 h-5 mr-2 text-orange-600"></i>
                                    Autenticaci√≥n de Dos Factores (2FA)
                                {% endif %}
                            </h3>
                        </div>
                        
                        <div class="p-6 twofa-section">
                            {% if user.admincredentials.two_factor_enabled %}
                                <!-- Estado: 2FA Habilitado -->
                                <div class="flex items-start space-x-4 twofa-content">
                                    <div class="flex-shrink-0">
                                        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center twofa-icon">
                                            <i data-lucide="shield-check" class="w-6 h-6 text-green-600"></i>
                                        </div>
                                    </div>
                                    
                                    <div class="flex-1 twofa-info">
                                        <h4 class="text-lg font-semibold text-gray-900 mb-2">
                                            ‚úÖ 2FA Habilitado
                                        </h4>
                                        <p class="text-gray-600 mb-4">
                                            Tu cuenta est√° protegida con autenticaci√≥n de dos factores. 
                                            Cada vez que inicies sesi√≥n necesitar√°s tu contrase√±a y un c√≥digo de Google Authenticator.
                                        </p>
                                        
                                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4 twofa-status-card">
                                            <div class="flex items-start">
                                                <i data-lucide="check-circle" class="w-5 h-5 text-green-600 mr-3 mt-0.5"></i>
                                                <div>
                                                    <h5 class="text-sm font-semibold text-green-800 mb-1">Estado de Seguridad</h5>
                                                    <ul class="text-sm text-green-700 space-y-1">
                                                        <li>‚Ä¢ 2FA activo y funcionando</li>
                                                        <li>‚Ä¢ C√≥digos de respaldo disponibles</li>
                                                        <li>‚Ä¢ Cuenta protegida contra accesos no autorizados</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="flex flex-col sm:flex-row gap-3 twofa-actions">
                                            <button type="button" id="btn-desactivar-2fa" 
                                                    class="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center justify-center">
                                                <i data-lucide="shield-x" class="w-4 h-4 mr-2"></i>
                                                Desactivar 2FA
                                            </button>
                                            
                                            <button type="button" id="btn-ver-codigos-respaldo" 
                                                    class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center">
                                                <i data-lucide="key" class="w-4 h-4 mr-2"></i>
                                                Ver C√≥digos de Respaldo
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            {% else %}
                                <!-- Estado: 2FA No Habilitado -->
                                <div class="flex items-start space-x-4 twofa-content">
                                    <div class="flex-shrink-0">
                                        <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center twofa-icon">
                                            <i data-lucide="shield" class="w-6 h-6 text-orange-600"></i>
                                        </div>
                                    </div>
                                    
                                    <div class="flex-1 twofa-info">
                                        <h4 class="text-lg font-semibold text-gray-900 mb-2">
                                            Protege tu cuenta con 2FA
                                        </h4>
                                        <p class="text-gray-600 mb-4">
                                            La autenticaci√≥n de dos factores a√±ade una capa extra de seguridad a tu cuenta. 
                                            Necesitar√°s tu contrase√±a y un c√≥digo generado por tu dispositivo m√≥vil para iniciar sesi√≥n.
                                        </p>
                                        
                                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4 twofa-status-card">
                                            <div class="flex items-start">
                                                <i data-lucide="info" class="w-5 h-5 text-blue-600 mr-3 mt-0.5"></i>
                                                <div>
                                                    <h5 class="text-sm font-semibold text-blue-800 mb-1">¬øC√≥mo funciona?</h5>
                                                    <ul class="text-sm text-blue-700 space-y-1">
                                                        <li>‚Ä¢ Descarga Google Authenticator en tu m√≥vil</li>
                                                        <li>‚Ä¢ Escanea el c√≥digo QR que te proporcionaremos</li>
                                                        <li>‚Ä¢ Usa el c√≥digo de 6 d√≠gitos para completar el login</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="flex flex-col sm:flex-row gap-3 twofa-actions">
                                            <button type="button" id="btn-configurar-2fa" 
                                                    class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center">
                                                <i data-lucide="shield-check" class="w-4 h-4 mr-2"></i>
                                                Configurar 2FA
                                            </button>
                                            
                                            <button type="button" id="btn-info-2fa" 
                                                    class="px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center justify-center">
                                                <i data-lucide="help-circle" class="w-4 h-4 mr-2"></i>
                                                M√°s informaci√≥n
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                </div>
                
                <!-- Contenido de Gesti√≥n de Rese√±as (oculto por defecto) -->
                <div id="gestion-resenas-content" class="hidden resenas-container">
                    <!-- Header de Gesti√≥n de Rese√±as -->
                    <div class="mb-4 sm:mb-6 resenas-header">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div class="mb-3 sm:mb-0">
                                <h1 class="text-xl sm:text-2xl font-bold text-gray-900 mb-1 sm:mb-2">
                                    Gesti√≥n de Rese√±as
                                </h1>
                                <p class="text-sm sm:text-base text-gray-600">Modera y administra las rese√±as de propiedades</p>
                            </div>
                            <div class="mt-2 sm:mt-0">
                                <button id="btn-volver-inicio-resenas" class="w-full sm:w-auto bg-gray-500 text-white px-3 sm:px-4 py-2 sm:py-2 rounded-lg hover:bg-gray-600 transition-colors text-sm sm:text-base">
                                    <i data-lucide="arrow-left" class="w-4 h-4 mr-1 sm:mr-2"></i>
                                    Volver al Inicio
                                </button>
                            </div>
                        </div>
                    </div>


                    <!-- Filtros de Rese√±as -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 mb-4 sm:mb-6">
                        <div class="p-4 sm:p-6 border-b border-gray-200 filtros-header">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                                <h3 class="text-base sm:text-lg font-semibold text-gray-900 flex items-center mb-3 sm:mb-0">
                                    <i data-lucide="filter" class="w-4 h-4 sm:w-5 sm:h-5 mr-2 text-blue-600"></i>
                                    Filtros
                                </h3>
                                
                                <!-- Estad√≠sticas peque√±as (desktop/tablet) -->
                                <div class="hidden sm:flex items-center space-x-4 sm:space-x-6">
                                    <!-- En Espera -->
                                    <div class="flex items-center">
                                        <div class="w-6 h-6 bg-yellow-100 rounded-full flex items-center justify-center mr-1.5">
                                            <i data-lucide="clock" class="w-3 h-3 text-yellow-600"></i>
                                        </div>
                                        <div>
                                            <div class="text-sm font-bold text-gray-900" id="resenasEspera">{{ resenas_espera|default:"0"|safe }}</div>
                                            <div class="text-xs text-gray-500">Espera</div>
                                        </div>
                                    </div>

                                    <!-- Aceptadas -->
                                    <div class="flex items-center">
                                        <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center mr-1.5">
                                            <i data-lucide="check-circle" class="w-3 h-3 text-green-600"></i>
                                        </div>
                                        <div>
                                            <div class="text-sm font-bold text-gray-900" id="resenasAceptadas">{{ resenas_aceptadas|default:"0"|safe }}</div>
                                            <div class="text-xs text-gray-500">Aceptadas</div>
                                        </div>
                                    </div>

                                    <!-- Rechazadas -->
                                    <div class="flex items-center">
                                        <div class="w-6 h-6 bg-red-100 rounded-full flex items-center justify-center mr-1.5">
                                            <i data-lucide="x-circle" class="w-3 h-3 text-red-600"></i>
                                        </div>
                                        <div>
                                            <div class="text-sm font-bold text-gray-900" id="resenasRechazadas">{{ resenas_rechazadas|default:"0"|safe }}</div>
                                            <div class="text-xs text-gray-500">Rechazadas</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Estad√≠sticas m√≥viles -->
                            <div class="sm:hidden estadisticas-mobile">
                                <div class="estadistica-item">
                                    <div class="w-6 h-6 bg-yellow-100 rounded-full flex items-center justify-center icono">
                                        <i data-lucide="clock" class="w-3 h-3 text-yellow-600"></i>
                                    </div>
                                    <div class="numero" id="resenasEsperaMobile">{{ resenas_espera|default:"0"|safe }}</div>
                                    <div class="label">Espera</div>
                                </div>
                                <div class="estadistica-item">
                                    <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center icono">
                                        <i data-lucide="check-circle" class="w-3 h-3 text-green-600"></i>
                                    </div>
                                    <div class="numero" id="resenasAceptadasMobile">{{ resenas_aceptadas|default:"0"|safe }}</div>
                                    <div class="label">Aceptadas</div>
                                </div>
                                <div class="estadistica-item">
                                    <div class="w-6 h-6 bg-red-100 rounded-full flex items-center justify-center icono">
                                        <i data-lucide="x-circle" class="w-3 h-3 text-red-600"></i>
                                    </div>
                                    <div class="numero" id="resenasRechazadasMobile">{{ resenas_rechazadas|default:"0"|safe }}</div>
                                    <div class="label">Rechazadas</div>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 sm:p-6 filtros-section">
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 filtros-grid">
                                <div class="filtro-field">
                                    <label for="filtro-estado" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 sm:mb-2">Estado</label>
                                    <select id="filtro-estado" class="w-full px-3 py-2 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base">
                                        <option value="todos">Todos los estados</option>
                                        <option value="pendiente">Pendientes</option>
                                        <option value="aprobada">Aprobadas</option>
                                        <option value="rechazada">Rechazadas</option>
                                    </select>
                                </div>
                                <div class="filtro-field">
                                    <label for="filtro-propiedad" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 sm:mb-2">Propiedad</label>
                                    <select id="filtro-propiedad" class="w-full px-3 py-2 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base">
                                        <option value="todas">Todas las propiedades</option>
                                        {% for propiedad in todas_propiedades %}
                                        <option value="{{ propiedad.id|safe|escapejs }}">{{ propiedad.titulo|safe }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="filtro-field sm:col-span-2 lg:col-span-1">
                                    <label for="filtro-calificacion" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 sm:mb-2">Calificaci√≥n</label>
                                    <select id="filtro-calificacion" class="w-full px-3 py-2 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base">
                                        <option value="todas">Todas las calificaciones</option>
                                        <option value="5">5 estrellas</option>
                                        <option value="4">4 estrellas</option>
                                        <option value="3">3 estrellas</option>
                                        <option value="2">2 estrellas</option>
                                        <option value="1">1 estrella</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Bot√≥n para limpiar filtros -->
                            <div class="mt-4 flex justify-end">
                                <button id="btn-limpiar-filtros" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors text-sm btn-limpiar-filtros">
                                    <i data-lucide="x" class="w-4 h-4 mr-2"></i>
                                    Limpiar Filtros
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Lista de Rese√±as -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 lista-resenas">
                        <div class="p-4 sm:p-6 border-b border-gray-200 lista-resenas-header">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                                <div class="mb-3 sm:mb-0">
                                    <h3 class="text-base sm:text-lg font-semibold text-gray-900 flex items-center">
                                        <i data-lucide="star" class="w-4 h-4 sm:w-5 sm:h-5 mr-2 text-blue-600"></i>
                                        Rese√±as (<span id="resenas-count">0</span>)
                                    </h3>
                                </div>
                                <div class="mt-2 sm:mt-0">
                                    <button id="btn-refrescar-resenas" class="w-full sm:w-auto bg-blue-600 text-white px-3 sm:px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                        <i data-lucide="refresh-cw" class="w-4 h-4 mr-1 sm:mr-2"></i>
                                        Refrescar
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="resenas-list" class="p-4 sm:p-6 resenas-content">
                            <div class="text-center py-6 sm:py-8 text-gray-500 loading-state">
                                <i data-lucide="star" class="w-8 h-8 sm:w-12 sm:h-12 mx-auto mb-3 sm:mb-4 text-gray-300"></i>
                                <p class="text-sm sm:text-base">Cargando rese√±as...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </main>
                                </div>
                                

    <!-- Modal Nueva Propiedad -->
    <div id="modal-nueva-propiedad" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <!-- Font Awesome para el modal -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <div class="flex items-center justify-center min-h-screen p-4 modal-propiedad-container">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden modal-propiedad-content">
                <!-- Header del Modal -->
                <div class="flex items-center justify-between p-6 border-b border-gray-200 bg-blue-600 text-white modal-propiedad-header">
                    <div>
                        <h2 class="text-xl font-bold">Crear Nueva Propiedad</h2>
                        <p class="text-blue-100">Agrega una nueva propiedad al cat√°logo inmobiliario</p>
                    </div>
                    <button id="cerrar-modal" class="text-white hover:text-blue-200 transition-colors">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
        </div>
        
                <!-- Contenido del Modal -->
                <div class="overflow-y-auto max-h-[calc(90vh-120px)]">
                    <div class="p-6 modal-propiedad-form">
                        <!-- Messages -->
                        <div id="modal-messages" class="hidden"></div>

                        <form method="post" enctype="multipart/form-data" id="crearPropiedadForm" action="{% url 'propiedades:crear' %}">
                            {% csrf_token %}
                            
                            <!-- T√≠tulo y Descripci√≥n -->
                            <div class="grid grid-cols-1 gap-6 mb-6 modal-propiedad-grid">
                                <div class="modal-propiedad-field">
                                    <label for="{{ form.titulo.id_for_label|safe|escapejs }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                        {{ form.titulo.label|safe }}
                                    </label>
                                    {{ form.titulo|safe }}
                                    {% if form.titulo.errors %}
                                        <div class="text-red-600 text-sm mt-1">
                                            {% for error in form.titulo.errors %}
                                                <p>{{ error|safe }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>

                                <div class="modal-propiedad-field">
                                    <label for="{{ form.descripcion.id_for_label|safe|escapejs }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                        {{ form.descripcion.label|safe }}
                                    </label>
                                    {{ form.descripcion|safe }}
                                    {% if form.descripcion.errors %}
                                        <div class="text-red-600 text-sm mt-1">
                                            {% for error in form.descripcion.errors %}
                                                <p>{{ error|safe }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Precio, Tipo y Operaci√≥n -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6 modal-propiedad-grid-3">
                                <div class="modal-propiedad-field">
                                    <label for="{{ form.precio.id_for_label|safe|escapejs }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                        {{ form.precio.label|safe }}
                                    </label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <span class="text-gray-500 sm:text-sm">$</span>
                                        </div>
                                        {{ form.precio|safe }}
                                    </div>
                                    {% if form.precio.errors %}
                                        <div class="text-red-600 text-sm mt-1">
                                            {% for error in form.precio.errors %}
                                                <p>{{ error|safe }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <div class="modal-propiedad-field">
                                    <label for="{{ form.tipo.id_for_label|safe|escapejs }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                        {{ form.tipo.label|safe }}
                                    </label>
                                    {{ form.tipo|safe }}
                                    {% if form.tipo.errors %}
                                        <div class="text-red-600 text-sm mt-1">
                                            {% for error in form.tipo.errors %}
                                                <p>{{ error|safe }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <div class="modal-propiedad-field">
                                    <label for="{{ form.operacion.id_for_label|safe|escapejs }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                        {{ form.operacion.label|safe }}
                                    </label>
                                    {{ form.operacion|safe }}
                                    {% if form.operacion.errors %}
                                        <div class="text-red-600 text-sm mt-1">
                                            {% for error in form.operacion.errors %}
                                                <p>{{ error|safe }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Estado y Ubicaci√≥n -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6 modal-propiedad-grid-2">
                                <div class="modal-propiedad-field">
                                    <label for="{{ form.estado.id_for_label|safe|escapejs }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                        {{ form.estado.label|safe }}
                                    </label>
                                    {{ form.estado|safe }}
                                    {% if form.estado.errors %}
                                        <div class="text-red-600 text-sm mt-1">
                                            {% for error in form.estado.errors %}
                                                <p>{{ error|safe }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <div class="modal-propiedad-field">
                                    <label for="{{ form.ubicacion.id_for_label|safe|escapejs }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                        {{ form.ubicacion.label|safe }}
                                    </label>
                                    {{ form.ubicacion|safe }}
                                    {% if form.ubicacion.errors %}
                                        <div class="text-red-600 text-sm mt-1">
                                            {% for error in form.ubicacion.errors %}
                                                <p>{{ error|safe }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Ciudad y Lugares Cercanos -->
                            <div class="grid grid-cols-1 gap-6 mb-6 modal-propiedad-grid">
                                <div class="modal-propiedad-field">
                                    <label for="{{ form.ciudad.id_for_label|safe|escapejs }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                        {{ form.ciudad.label|safe }}
                                        <span class="text-red-500">*</span>
                                    </label>
                                    {{ form.ciudad|safe }}
                                    {% if form.ciudad.errors %}
                                        <div class="text-red-600 text-sm mt-1">
                                            {% for error in form.ciudad.errors %}
                                                <p>{{ error|safe }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <p class="text-gray-500 text-xs mt-1">{{ form.ciudad.help_text|safe }}</p>
                                </div>
                                
                                <div class="modal-propiedad-field">
                                    <label for="{{ form.lugares_cercanos.id_for_label|safe|escapejs }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                        {{ form.lugares_cercanos.label|safe }}
                                        <span class="text-red-500">*</span>
                                    </label>
                                    {{ form.lugares_cercanos|safe }}
                                    {% if form.lugares_cercanos.errors %}
                                        <div class="text-red-600 text-sm mt-1">
                                            {% for error in form.lugares_cercanos.errors %}
                                                <p>{{ error|safe }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <p class="text-gray-500 text-xs mt-1">{{ form.lugares_cercanos.help_text|safe }}</p>
                                </div>
                            </div>

                            <!-- Caracter√≠sticas -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6 modal-propiedad-grid-3">
                                <div class="modal-propiedad-field">
                                    <label for="{{ form.metros_cuadrados.id_for_label|safe|escapejs }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                        {{ form.metros_cuadrados.label|safe }}
                                    </label>
                                    <div class="relative">
                                        {{ form.metros_cuadrados|safe }}
                                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                            <span class="text-gray-500 sm:text-sm">m¬≤</span>
                                        </div>
                                    </div>
                                    {% if form.metros_cuadrados.errors %}
                                        <div class="text-red-600 text-sm mt-1">
                                            {% for error in form.metros_cuadrados.errors %}
                                                <p>{{ error|safe }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <div class="modal-propiedad-field">
                                    <label for="{{ form.habitaciones.id_for_label|safe|escapejs }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                        {{ form.habitaciones.label|safe }}
                                    </label>
                                    {{ form.habitaciones|safe }}
                                    {% if form.habitaciones.errors %}
                                        <div class="text-red-600 text-sm mt-1">
                                            {% for error in form.habitaciones.errors %}
                                                <p>{{ error|safe }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <div class="modal-propiedad-field">
                                    <label for="{{ form.banos.id_for_label|safe|escapejs }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                        {{ form.banos.label|safe }}
                                    </label>
                                    {{ form.banos|safe }}
                                    {% if form.banos.errors %}
                                        <div class="text-red-600 text-sm mt-1">
                                            {% for error in form.banos.errors %}
                                                <p>{{ error|safe }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Caracter√≠sticas Adicionales -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6 modal-propiedad-grid-2">
                                <div class="modal-propiedad-field">
                                    <label for="{{ form.ambientes.id_for_label|safe|escapejs }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                        {{ form.ambientes.label|safe }}
                                    </label>
                                    {{ form.ambientes|safe }}
                                    {% if form.ambientes.errors %}
                                        <div class="text-red-600 text-sm mt-1">
                                            {% for error in form.ambientes.errors %}
                                                <p>{{ error|safe }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <p class="text-gray-500 text-xs mt-1">{{ form.ambientes.help_text|safe }}</p>
                                </div>
                                
                                <div class="modal-propiedad-field">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        {{ form.balcon.label|safe }}
                                    </label>
                                    <div class="flex items-center space-x-4">
                                        <label class="flex items-center">
                                            <input type="radio" name="{{ form.balcon.name }}" value="True" class="mr-2 text-blue-600 focus:ring-blue-500">
                                            <span class="text-sm text-gray-700">S√≠</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="{{ form.balcon.name }}" value="False" class="mr-2 text-blue-600 focus:ring-blue-500" checked>
                                            <span class="text-sm text-gray-700">No</span>
                                        </label>
                                    </div>
                                    {% if form.balcon.errors %}
                                        <div class="text-red-600 text-sm mt-1">
                                            {% for error in form.balcon.errors %}
                                                <p>{{ error|safe }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <p class="text-gray-500 text-xs mt-1">{{ form.balcon.help_text|safe }}</p>
                                </div>
                            </div>

                            <!-- Im√°genes -->
                            <div class="mb-6 modal-propiedad-imagenes">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <i data-lucide="image" class="w-5 h-5 mr-2 text-blue-600"></i>
                                    Im√°genes de la Propiedad
                                </h3>
                                
                                <!-- Imagen Principal -->
                                <div class="mb-4 modal-propiedad-imagen-field">
                                    <label for="{{ form.imagen_principal.id_for_label|safe|escapejs }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                        {{ form.imagen_principal.label|safe }}
                                        <span class="text-red-500">*</span>
                                    </label>
                                    {{ form.imagen_principal|safe }}
                                    {% if form.imagen_principal.errors %}
                                        <div class="text-red-600 text-sm mt-1">
                                            {% for error in form.imagen_principal.errors %}
                                                <p>{{ error|safe }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <!-- Imagen Secundaria -->
                                <div class="mb-4 modal-propiedad-imagen-field">
                                    <label for="{{ form.imagen_secundaria.id_for_label|safe|escapejs }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                        {{ form.imagen_secundaria.label|safe }}
                                    </label>
                                    {{ form.imagen_secundaria|safe }}
                                    {% if form.imagen_secundaria.errors %}
                                        <div class="text-red-600 text-sm mt-1">
                                            {% for error in form.imagen_secundaria.errors %}
                                                <p>{{ error|safe }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>

                                <!-- Campo oculto para fotos adicionales -->
                                {{ form.fotos_adicionales|safe }}
                                
                                <!-- Fotos y Videos Adicionales -->
                                <div class="mb-4">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        <i data-lucide="video" class="w-4 h-4 mr-2 text-blue-600"></i>
                                        Fotos y Videos Adicionales
                                    </label>
                                    <div class="upload-area border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-400 transition-colors cursor-pointer modal-propiedad-upload-area" id="uploadArea">
                                        <div class="upload-content">
                                            <i data-lucide="upload" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
                                            <h6 class="text-gray-600 mb-2">Arrastra y suelta archivos aqu√≠ o haz clic para seleccionar</h6>
                                            <p class="text-gray-500 text-sm mb-2">M√°ximo 10 archivos de 200MB cada uno</p>
                                            <p class="text-gray-500 text-xs mb-4">Im√°genes: JPG, PNG | Videos: MP4, AVI, MOV</p>
                                            <input type="file" id="fotosInput" multiple accept="image/*,video/*" class="hidden">
                                            <button type="button" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors" onclick="document.getElementById('fotosInput').click()">
                                                <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                                                Seleccionar Archivos
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Preview de archivos seleccionados -->
                                    <div id="fotos-preview" class="mt-4 hidden">
                                        <h6 class="text-sm font-semibold text-gray-700 mb-2">
                                            <i data-lucide="video" class="w-4 h-4 mr-2 text-blue-600"></i>
                                            Archivos seleccionados:
                                        </h6>
                                        <div id="fotos-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4 modal-propiedad-fotos-grid"></div>
                                    </div>
                                </div>
                                
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 modal-propiedad-info-box">
                                    <div class="flex items-start">
                                        <i data-lucide="info" class="w-5 h-5 text-blue-600 mr-3 mt-0.5"></i>
                                        <div>
                                            <p class="text-sm text-blue-800">
                                                <strong>Consejo:</strong> La imagen principal se mostrar√° en el home, la secundaria en el detalle. Los archivos adicionales (fotos y videos) estar√°n disponibles en la galer√≠a completa.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Amenidades -->
                            <div class="mb-6 modal-propiedad-amenidades">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i data-lucide="check-circle" class="w-4 h-4 mr-2 text-blue-600"></i>
                                    Amenidades Incluidas
                                </label>
                                <p class="text-gray-600 text-sm mb-4">Selecciona las amenidades que incluye esta propiedad:</p>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 modal-propiedad-amenidades-grid">
                                    {% for amenidad in amenidades %}
                                    <div class="amenidad-checkbox bg-gray-50 border border-gray-200 rounded-lg p-4 hover:bg-blue-50 hover:border-blue-300 transition-all cursor-pointer modal-propiedad-amenidad-item">
                                        <input type="checkbox" name="amenidades" value="{{ amenidad.id|safe|escapejs }}" id="id_amenidades_{{ forloop.counter0|safe }}" class="form-check-input">
                                        <label class="form-check-label cursor-pointer ml-3" for="id_amenidades_{{ forloop.counter0|safe }}">
                                            <i class="fas mr-2 text-blue-600" data-icon="{{ amenidad.icono|safe|escapejs }}"></i>
                                            {{ amenidad.nombre|safe }}
                                        </label>
                                    </div>
                                    {% endfor %}
                                </div>
                                
                                {% if form.amenidades.errors %}
                                    <div class="text-red-600 text-sm mt-2">
                                        {% for error in form.amenidades.errors %}
                                            <p>{{ error|safe }}</p>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Coordenadas de Ubicaci√≥n -->
                            <div class="mb-6 modal-propiedad-coordenadas">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i data-lucide="map-pin" class="w-4 h-4 mr-2 text-blue-600"></i>
                                    Coordenadas de Ubicaci√≥n
                                    <span class="text-red-500">*</span>
                                </label>
                                <p class="text-gray-600 text-sm mb-4">Ingresa las coordenadas exactas para mostrar la ubicaci√≥n en el mapa:</p>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 modal-propiedad-grid-2">
                                    <div class="modal-propiedad-field">
                                        <label for="{{ form.latitud.id_for_label|safe|escapejs }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                            {{ form.latitud.label|safe }}
                                            <span class="text-red-500">*</span>
                                        </label>
                                        <div class="relative">
                                            {{ form.latitud|safe }}
                                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                                <span class="text-gray-500 text-sm">¬∞N/S</span>
                                            </div>
                                        </div>
                                        {% if form.latitud.errors %}
                                            <div class="text-red-600 text-sm mt-1">
                                                {% for error in form.latitud.errors %}
                                                    <p>{{ error|safe }}</p>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                        <p class="text-gray-500 text-xs mt-1">{{ form.latitud.help_text|safe }}</p>
                                    </div>
                                    
                                    <div class="modal-propiedad-field">
                                        <label for="{{ form.longitud.id_for_label|safe|escapejs }}" class="block text-sm font-semibold text-gray-700 mb-2">
                                            {{ form.longitud.label|safe }}
                                            <span class="text-red-500">*</span>
                                        </label>
                                        <div class="relative">
                                            {{ form.longitud|safe }}
                                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                                <span class="text-gray-500 text-sm">¬∞E/W</span>
                                            </div>
                                        </div>
                                        {% if form.longitud.errors %}
                                            <div class="text-red-600 text-sm mt-1">
                                                {% for error in form.longitud.errors %}
                                                    <p>{{ error|safe }}</p>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                        <p class="text-gray-500 text-xs mt-1">{{ form.longitud.help_text|safe }}</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Submit Buttons -->
                            <div class="flex flex-col sm:flex-row gap-4 justify-end modal-propiedad-actions">
                                <button type="button" id="cancelar-modal" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                                    <i data-lucide="x" class="w-4 h-4 mr-2"></i>
                                    Cancelar
                                </button>
                                <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                                    Crear Propiedad
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nuevo Usuario Administrativo -->
    <div id="modal-nuevo-usuario" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4 modal-usuario-container">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden modal-usuario-content">
                <!-- Header del Modal -->
                <div class="flex items-center justify-between p-6 border-b border-gray-200 bg-green-600 text-white modal-usuario-header">
                    <div>
                        <h2 class="text-xl font-bold">Gesti√≥n de Usuarios Administrativos</h2>
                        <p class="text-green-100">Crea y administra usuarios del sistema</p>
                    </div>
                    <button id="cerrar-modal-usuario" class="text-white hover:text-green-200 transition-colors">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                
                <!-- Contenido del Modal -->
                <div class="overflow-y-auto max-h-[calc(90vh-120px)]">
                    <div class="p-6">
                        <!-- Tabs -->
                        <div class="flex space-x-1 mb-6 bg-gray-100 p-1 rounded-lg modal-usuario-tabs">
                            <button id="tab-crear-usuario" class="flex-1 py-2 px-4 text-sm font-medium rounded-md bg-green-600 text-white transition-colors modal-usuario-tab">
                                <i data-lucide="user-plus" class="w-4 h-4 mr-2"></i>
                                Crear Usuario
                            </button>
                            <button id="tab-gestionar-usuarios" class="flex-1 py-2 px-4 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-200 transition-colors modal-usuario-tab">
                                <i data-lucide="users" class="w-4 h-4 mr-2"></i>
                                Gestionar Usuarios
                            </button>
                        </div>

                        <!-- Tab: Crear Usuario -->
                          <!-- Tab: Crear Usuario -->
                        <div id="content-crear-usuario" class="modal-usuario-form">
                            <!-- Messages -->
                            <div id="modal-messages-usuario" class="hidden"></div>

                            <form method="post" enctype="multipart/form-data" id="crearUsuarioForm" action="{% url 'login:crear_nuevo_usuario_admin' %}">
                                {% csrf_token %}
                                
                                <!-- Informaci√≥n Personal -->
                                <div class="mb-6 modal-usuario-section">
                                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                        <i data-lucide="user" class="w-5 h-5 mr-2 text-green-600"></i>
                                        Informaci√≥n Personal
                                    </h3>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 modal-usuario-grid">
                                        <div class="modal-usuario-field">
                                            <label for="nombre_usuario" class="block text-sm font-semibold text-gray-700 mb-2">
                                                Nombre
                                            </label>
                                            <input type="text" id="nombre_usuario" name="nombre" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                                   placeholder="Ingresa el nombre" 
                                                   pattern="^[a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s]{2,50}$"
                                                   title="El nombre debe tener entre 2 y 50 caracteres, solo letras y espacios"
                                                   required>
                                        </div>
                                        
                                        <div class="modal-usuario-field">
                                            <label for="apellido_usuario" class="block text-sm font-semibold text-gray-700 mb-2">
                                                Apellido
                                            </label>
                                            <input type="text" id="apellido_usuario" name="apellido" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                                   placeholder="Ingresa el apellido" 
                                                   pattern="^[a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s]{2,50}$"
                                                   title="El apellido debe tener entre 2 y 50 caracteres, solo letras y espacios"
                                                   required>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4 modal-usuario-grid">
                                        <div class="modal-usuario-field">
                                            <label for="telefono_usuario" class="block text-sm font-semibold text-gray-700 mb-2">
                                                Tel√©fono
                                            </label>
                                            <input type="tel" id="telefono_usuario" name="telefono" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                                   placeholder="+5491123456789"
                                                   value="+54"
                                                   pattern="^\+54\d{10,12}$"
                                                   title="El tel√©fono debe comenzar con +54 y tener entre 10 y 12 d√≠gitos"
                                                   required>
                                        </div>
                                        
                                        <div class="modal-usuario-field">
                                            <label for="fecha_nacimiento_usuario" class="block text-sm font-semibold text-gray-700 mb-2">
                                                Fecha de Nacimiento
                                            </label>
                                            <input type="date" id="fecha_nacimiento_usuario" name="fecha_nacimiento" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                                   min="1900-01-01"
                                                   max="{% now 'Y' %}-12-31"
                                                   title="La fecha debe estar entre 1900 y {% now 'Y' %}">
                                        </div>
                                    </div>
                                    
                                    <div class="mt-4 modal-usuario-foto">
                                        <label for="foto_perfil_usuario" class="block text-sm font-semibold text-gray-700 mb-2">
                                            Foto de Perfil
                                        </label>
                                        
                                        <!-- Preview de la foto -->
                                        <div class="text-center mb-3">
                                            <div id="foto-preview-usuario" class="hidden modal-usuario-foto-preview">
                                                <img id="foto-preview-img-usuario" src="" alt="Preview" class="rounded-full border-4 border-green-500 mx-auto" style="width: 120px; height: 120px; object-fit: cover;">
                                                <p class="text-gray-600 text-sm mt-2">Vista previa de la foto de perfil</p>
                                            </div>
                                            <div id="foto-placeholder-usuario" class="border-2 border-dashed border-gray-300 rounded-full flex items-center justify-center mx-auto modal-usuario-foto-placeholder" style="width: 120px; height: 120px;">
                                                <i data-lucide="camera" class="w-8 h-8 text-gray-400"></i>
                                            </div>
                                        </div>
                                        
                                        <input type="file" id="foto_perfil_usuario" name="foto_perfil" 
                                               accept="image/jpeg,image/jpg,image/png,image/gif,image/webp" 
                                               title="Solo se permiten archivos de imagen (JPEG, PNG, GIF, WebP)"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                    </div>
                                </div>
                                
                                <!-- Informaci√≥n de Acceso -->
                                <div class="mb-6 modal-usuario-section">
                                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                        <i data-lucide="lock" class="w-5 h-5 mr-2 text-green-600"></i>
                                        Informaci√≥n de Acceso
                                    </h3>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 modal-usuario-grid">
                                        <div class="modal-usuario-field">
                                            <label for="email_usuario" class="block text-sm font-semibold text-gray-700 mb-2">
                                                Correo Electr√≥nico
                                            </label>
                                            <input type="email" id="email_usuario" name="email" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                                   placeholder="usuario@email.com" 
                                                   pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}"
                                                   title="Ingresa un correo electr√≥nico v√°lido"
                                                   required>
                                        </div>
                                        
                                        <div class="modal-usuario-field">
                                            <label for="password_usuario" class="block text-sm font-semibold text-gray-700 mb-2">
                                                Contrase√±a
                                            </label>
                                            <input type="password" id="password_usuario" name="password" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                                   placeholder="M√≠nimo 8 caracteres" 
                                                   pattern=".{8,}"
                                                   title="La contrase√±a debe tener al menos 8 caracteres"
                                                   required>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-4 modal-usuario-field">
                                        <label for="confirmar_password_usuario" class="block text-sm font-semibold text-gray-700 mb-2">
                                            Confirmar Contrase√±a
                                        </label>
                                        <input type="password" id="confirmar_password_usuario" name="confirmar_password" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                               placeholder="Repite la contrase√±a" 
                                               pattern=".{8,}"
                                               title="La contrase√±a debe tener al menos 8 caracteres"
                                               required>
                                    </div>
                                </div>

                                <!-- Submit Buttons -->
                                <div class="flex flex-col sm:flex-row gap-4 justify-end modal-usuario-actions">
                                    <button type="button" id="cancelar-modal-usuario" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                                        <i data-lucide="x" class="w-4 h-4 mr-2"></i>
                                        Cancelar
                                    </button>
                                    <button type="submit" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                        <i data-lucide="user-plus" class="w-4 h-4 mr-2"></i>
                                        Crear Usuario
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Tab: Gestionar Usuarios -->
                        <div id="content-gestionar-usuarios" class="hidden modal-usuario-gestion">
                            <div class="mb-4">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <i data-lucide="users" class="w-5 h-5 mr-2 text-blue-600"></i>
                                    Usuarios Administrativos
                                </h3>
                                
                                <!-- Messages para gesti√≥n de usuarios -->
                                <div id="usuarios-messages" class="hidden mb-4"></div>
                                
                                <!-- Bot√≥n para refrescar -->
                                <div class="flex justify-between items-center mb-4 modal-usuario-gestion-header">
                                    <p class="text-sm text-gray-600">Gestiona los usuarios administrativos del sistema</p>
                                    <button id="btn-refrescar-usuarios" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                        <i data-lucide="refresh-cw" class="w-4 h-4 mr-2"></i>
                                        Refrescar
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Lista de usuarios -->
                            <div id="usuarios-list" class="space-y-4 modal-usuario-lista">
                                <!-- Los usuarios se cargar√°n aqu√≠ din√°micamente -->
                                <div class="text-center py-8 text-gray-500">
                                    <i data-lucide="users" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                                    <p>Cargando usuarios...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmaci√≥n de Eliminaci√≥n de Propiedad -->
    <div id="modal-eliminar-propiedad" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-md">
                <div class="p-6">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-4">
                            <i data-lucide="alert-triangle" class="w-6 h-6 text-red-600"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">Confirmar Eliminaci√≥n</h3>
                            <p class="text-sm text-gray-500">Esta acci√≥n no se puede deshacer</p>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <p class="text-gray-700">
                            ¬øEst√°s seguro de que quieres eliminar la propiedad 
                            <strong id="propiedad-titulo-eliminar" class="text-gray-900"></strong>?
                        </p>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button id="cancelar-eliminar" class="flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                            Cancelar
                        </button>
                        <button id="confirmar-eliminar" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                            <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i>
                            S√≠, Eliminar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmaci√≥n de Eliminaci√≥n de Usuario -->
    <div id="modal-eliminar-usuario" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-md">
                <div class="p-6">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-4">
                            <i data-lucide="user-x" class="w-6 h-6 text-red-600"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">Confirmar Eliminaci√≥n de Usuario</h3>
                            <p class="text-sm text-gray-500">Esta acci√≥n no se puede deshacer</p>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <p class="text-gray-700">
                            ¬øEst√°s seguro de que quieres eliminar al usuario 
                            <strong id="usuario-nombre-eliminar" class="text-gray-900"></strong>?
                        </p>
                        <p class="text-sm text-red-600 mt-2">
                            <i data-lucide="alert-circle" class="w-4 h-4 inline mr-1"></i>
                            Se eliminar√°n todas las credenciales y datos asociados.
                        </p>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button id="cancelar-eliminar-usuario" class="flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                            Cancelar
                        </button>
                        <button id="confirmar-eliminar-usuario" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                            <i data-lucide="user-x" class="w-4 h-4 mr-2"></i>
                            S√≠, Eliminar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript organizado en m√≥dulos -->
    <script>
        console.log('Dashboard JavaScript cargado');
        
        // ========================================
        // FUNCIONES DE NAVEGACI√ìN CENTRALIZADAS
        // ========================================
        
        // Funci√≥n para ocultar todas las secciones
        function hideAllSections() {
            const sections = [
                'dashboard-content',
                'gestion-propiedades-content', 
                'gestion-resenas-content',
                'cvs-content',
                'configuraciones-content'
            ];
            
            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.add('hidden');
                }
            });
        }
        
        // Funci√≥n para mostrar una secci√≥n espec√≠fica
        function showSection(sectionId) {
            hideAllSections(); // Ocultar todas primero
            limpiarModales(); // Limpiar modales activos
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.remove('hidden');
            }
        }
        
        // Funci√≥n para actualizar el estado del sidebar
        function updateSidebarState(activeSection) {
            // Remover estado activo de todos los botones
            document.querySelectorAll('#sidebar button, #sidebar a').forEach(btn => {
                btn.classList.remove('text-white', 'bg-gradient-to-r', 'from-blue-500', 'to-purple-600', 'transform', 'scale-105', 'shadow-lg');
                btn.classList.add('text-slate-300', 'hover:text-white', 'hover:bg-gradient-to-r', 'hover:from-blue-500', 'hover:to-purple-600', 'hover:scale-105');
            });
            
            // Agregar estado activo al bot√≥n correspondiente
            let activeButton = null;
            switch(activeSection) {
                case 'dashboard':
                    activeButton = document.getElementById('btn-inicio');
                    break;
                case 'gestion':
                    activeButton = document.getElementById('btn-gestionar-propiedades');
                    break;
                case 'cvs':
                    activeButton = document.getElementById('btn-gestionar-cvs');
                    break;
                case 'resenas':
                    activeButton = document.getElementById('btn-gestionar-resenas');
                    break;
                case 'config':
                    activeButton = document.getElementById('btn-configuraciones');
                    break;
            }
            
            if (activeButton) {
                activeButton.classList.remove('text-slate-300', 'hover:text-white', 'hover:bg-gradient-to-r', 'hover:from-blue-500', 'hover:to-purple-600', 'hover:scale-105');
                activeButton.classList.add('text-white', 'bg-gradient-to-r', 'from-blue-500', 'to-purple-600', 'transform', 'scale-105', 'shadow-lg');
            }
        }

        // ========================================
        // SISTEMA DE ACTIVIDADES RECIENTES
        // ========================================
        
        // Almacenamiento de actividades en localStorage
        const ActivitiesManager = {
            storageKey: 'dashboard-activities',
            maxActivities: 20,
            
            // Agregar una nueva actividad
            addActivity(type, title, description, icon = 'activity', color = 'blue') {
                const activity = {
                    id: Date.now(),
                    type: type,
                    title: title,
                    description: description,
                    icon: icon,
                    color: color,
                    timestamp: new Date().toISOString(),
                    timeAgo: 'ahora'
                };
                
                // Obtener actividades existentes
                const activities = this.getActivities();
                
                // Agregar nueva actividad al inicio
                activities.unshift(activity);
                
                // Limitar a maxActivities
                if (activities.length > this.maxActivities) {
                    activities.splice(this.maxActivities);
                }
                
                // Guardar en localStorage
                localStorage.setItem(this.storageKey, JSON.stringify(activities));
                
                // Actualizar la UI
                this.updateUI();
                
                console.log('Nueva actividad agregada:', activity);
            },
            
            // Obtener todas las actividades
            getActivities() {
                try {
                    const stored = localStorage.getItem(this.storageKey);
                    return stored ? JSON.parse(stored) : [];
                } catch (error) {
                    console.error('Error al obtener actividades:', error);
                    return [];
                }
            },
            
            // Calcular tiempo transcurrido
            getTimeAgo(timestamp) {
                const now = new Date();
                const activityTime = new Date(timestamp);
                const diffMs = now - activityTime;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMins / 60);
                const diffDays = Math.floor(diffHours / 24);
                
                if (diffMins < 1) return 'ahora';
                if (diffMins < 60) return `hace ${diffMins}m`;
                if (diffHours < 24) return `hace ${diffHours}h`;
                if (diffDays < 7) return `hace ${diffDays}d`;
                return activityTime.toLocaleDateString('es-ES');
            },
            
            // Actualizar la UI
            updateUI() {
                const container = document.getElementById('actividades-container');
                if (!container) return;
                
                const activities = this.getActivities();
                
                if (activities.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i data-lucide="activity" class="w-6 h-6 text-gray-400"></i>
                            </div>
                            <p class="text-sm text-gray-500">No hay actividades recientes</p>
                            <p class="text-xs text-gray-400 mt-1">Las acciones del dashboard aparecer√°n aqu√≠</p>
                        </div>
                    `;
                    return;
                }
                
                // Generar HTML de actividades
                const activitiesHTML = activities.map(activity => {
                    const timeAgo = this.getTimeAgo(activity.timestamp);
                    const colorClasses = {
                        blue: 'bg-blue-100 text-blue-600',
                        green: 'bg-green-100 text-green-600',
                        yellow: 'bg-yellow-100 text-yellow-600',
                        red: 'bg-red-100 text-red-600',
                        purple: 'bg-purple-100 text-purple-600',
                        gray: 'bg-gray-100 text-gray-600'
                    };
                    
                    return `
                        <div class="flex items-center py-2 px-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="w-8 h-8 ${colorClasses[activity.color]} rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                                <i data-lucide="${activity.icon}" class="w-4 h-4"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-medium text-gray-900 truncate">${activity.title}</p>
                                <p class="text-xs text-gray-500 truncate">${activity.description}</p>
                            </div>
                            <div class="text-xs text-gray-400 ml-2 flex-shrink-0">${timeAgo}</div>
                        </div>
                    `;
                }).join('');
                
                container.innerHTML = activitiesHTML;
                
                // Recrear iconos de Lucide
                if (window.lucide) {
                    lucide.createIcons();
                }
            },
            
            // Inicializar el sistema
            init() {
                this.updateUI();
                
                // Actualizar tiempo transcurrido cada minuto
                setInterval(() => {
                    this.updateUI();
                }, 60000);
                
                // Event listener para bot√≥n de refrescar
                const refreshBtn = document.getElementById('btn-refrescar-actividades');
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', () => {
                        this.updateUI();
                        // Efecto visual de refrescar
                        refreshBtn.style.transform = 'rotate(360deg)';
                        setTimeout(() => {
                            refreshBtn.style.transform = 'rotate(0deg)';
                        }, 300);
                    });
                }
            }
        };
        
        // Hacer el manager globalmente disponible
        window.ActivitiesManager = ActivitiesManager;
        
        // ========================================
        // FUNCIONES PARA ACTUALIZAR CONTADORES DE RESE√ëAS
        // ========================================
        
        // Funci√≥n para actualizar el total de rese√±as desde el backend
        function actualizarTotalResenas(total) {
            const totalElement = document.getElementById('totalReviews');
            if (totalElement && total !== undefined) {
                totalElement.textContent = total;
            }
        }
        
        // Funci√≥n para cargar estad√≠sticas de rese√±as desde el backend
        async function cargarEstadisticasResenas() {
            try {
                const response = await fetch(`{% url "login:gestionar_resenas" %}?estadisticas=true`);
                const data = await response.json();
                
                if (data.success && data.estadisticas) {
                    // Actualizar el total en el dashboard
                    actualizarTotalResenas(data.estadisticas.total);
                    
                    // Actualizar los contadores individuales en la vista de rese√±as (desktop/tablet)
                    const esperaElement = document.getElementById('resenasEspera');
                    const aceptadasElement = document.getElementById('resenasAceptadas');
                    const rechazadasElement = document.getElementById('resenasRechazadas');
                    
                    if (esperaElement) esperaElement.textContent = data.estadisticas.en_espera || 0;
                    if (aceptadasElement) aceptadasElement.textContent = data.estadisticas.aceptadas || 0;
                    if (rechazadasElement) rechazadasElement.textContent = data.estadisticas.rechazadas || 0;
                    
                    // Actualizar los contadores m√≥viles
                    const esperaElementMobile = document.getElementById('resenasEsperaMobile');
                    const aceptadasElementMobile = document.getElementById('resenasAceptadasMobile');
                    const rechazadasElementMobile = document.getElementById('resenasRechazadasMobile');
                    
                    if (esperaElementMobile) esperaElementMobile.textContent = data.estadisticas.en_espera || 0;
                    if (aceptadasElementMobile) aceptadasElementMobile.textContent = data.estadisticas.aceptadas || 0;
                    if (rechazadasElementMobile) rechazadasElementMobile.textContent = data.estadisticas.rechazadas || 0;
                    
                    console.log('Estad√≠sticas de rese√±as cargadas:', data.estadisticas);
                }
            } catch (error) {
                console.error('Error al cargar estad√≠sticas de rese√±as:', error);
            }
        }
        
        // Hacer las funciones globalmente disponibles
        window.actualizarTotalResenas = actualizarTotalResenas;
        window.cargarEstadisticasResenas = cargarEstadisticasResenas;
        window.aplicarFiltrosResenas = aplicarFiltrosResenas;

        // ========================================
        // M√ìDULO: CONFIGURACI√ìN Y UTILIDADES
        // ========================================
        const DashboardConfig = {
            // Colores del gr√°fico (m√°s vivos y vibrantes)
            colors: {
                bajo: '#10B981',    // Verde vibrante: 0-33%
                medio: '#F59E0B',   // Amarillo vibrante: 34-66%
                alto: '#DC2626'     // Rojo vibrante: 67-100%
            },
            
            // Configuraci√≥n de animaciones
            animation: {
                duration: 300,
                steps: 50
            }
        };

        // ========================================
        // M√ìDULO: FUNCIONES DE UTILIDAD
        // ========================================
        const Utils = {
            // Obtener color seg√∫n escala de calor (basado en rangos absolutos)
            getHeatColor(value, maxValue = null) {
                console.log(`Evaluando color para valor: ${value}, m√°ximo: ${maxValue}`);
                
                // Si no hay valor, usar verde (escala de calor)
                if (value === 0) {
                    console.log(`Valor ${value} -> Verde (bajo - escala de calor)`);
                    return DashboardConfig.colors.bajo; // Verde para 0 clics
                }
                
                // Usar rangos absolutos: 0-60 ‚Üí 61-150 ‚Üí 151+
                if (value <= 60) {
                    console.log(`Valor ${value} -> Verde (bajo - rango absoluto)`);
                    return DashboardConfig.colors.bajo; // Verde para 0-60 clics
                }
                if (value <= 150) {
                    console.log(`Valor ${value} -> Amarillo (medio - rango absoluto)`);
                    return DashboardConfig.colors.medio; // Amarillo para 61-150 clics
                }
                console.log(`Valor ${value} -> Rojo (alto - rango absoluto)`);
                return DashboardConfig.colors.alto; // Rojo para 151+ clics
            },

            // Formatear fecha
            formatDate(date, options) {
                return date.toLocaleDateString('es-ES', options);
            },

            // Animar contador
            animateCounter(element, target) {
                let current = 0;
                const increment = target / DashboardConfig.animation.steps;
                
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        element.textContent = target;
                        clearInterval(timer);
                    } else {
                        element.textContent = Math.floor(current);
                    }
                }, DashboardConfig.animation.duration / DashboardConfig.animation.steps);
            }
        };

        // ========================================
        // M√ìDULO: GESTI√ìN DEL SIDEBAR
        // ========================================
        const SidebarManager = {
            init() {
                this.sidebar = document.getElementById('sidebar');
                this.sidebarToggle = document.getElementById('sidebar-toggle');
                this.sidebarOverlay = document.getElementById('sidebar-overlay');
                
                this.bindEvents();
            },

            bindEvents() {
            // Toggle sidebar
                this.sidebarToggle.addEventListener('click', () => {
                    this.sidebar.classList.toggle('-translate-x-full');
                    this.sidebarOverlay.classList.toggle('hidden');
            });
            
            // Cerrar sidebar al hacer clic en overlay
                this.sidebarOverlay.addEventListener('click', () => {
                    this.sidebar.classList.add('-translate-x-full');
                    this.sidebarOverlay.classList.add('hidden');
            });
            
            // Cerrar sidebar al redimensionar a desktop
            window.addEventListener('resize', () => {
                if (window.innerWidth >= 1024) {
                        this.sidebar.classList.remove('-translate-x-full');
                        this.sidebarOverlay.classList.add('hidden');
                    }
                });
            }
        };

        // ========================================
        // M√ìDULO: GESTI√ìN DEL GR√ÅFICO
        // ========================================
        const ChartManager = {
            init() {
                console.log('=== INICIALIZANDO CHART MANAGER ===');
                
                this.propiedadSelect = document.getElementById('propiedad-select');
                this.totalClicksElement = document.getElementById('total-clicks');
                this.leyendaMaximo = document.getElementById('leyenda-maximo');
                
                // Datos desde Django
                this.datosPropiedades = {
                    'todas': { 
                        total: {{ total_clicks|default:"0"|safe }}, 
                        datos: [{% for mes_data in clicks_por_mes %}{{ mes_data.clicks|safe }}{% if not forloop.last %},{% endif %}{% endfor %}] 
                    }
                };
                
                console.log('Datos iniciales:', this.datosPropiedades);
            
                // Agregar datos de propiedades individuales usando JSON seguro
                try {
                    const datosPropiedadesRaw = {{ clicks_por_propiedad|safe|safe }};
                    console.log('=== DATOS RAW DE PROPIEDADES ===');
                    console.log('Datos raw completos:', datosPropiedadesRaw);
                    console.log('Tipo de datos:', typeof datosPropiedadesRaw);
                    console.log('Claves disponibles:', Object.keys(datosPropiedadesRaw));
                    
                    {% for propiedad in todas_propiedades %}
                    const datosPropiedad_{{ propiedad.id|safe }} = datosPropiedadesRaw && datosPropiedadesRaw['{{ propiedad.id|safe|escapejs }}'] ? datosPropiedadesRaw['{{ propiedad.id|safe|escapejs }}'] : null;
                    console.log(`Datos raw para propiedad {{ propiedad.id|safe }} ({{ propiedad.titulo|escapejs|safe }}):`, datosPropiedad_{{ propiedad.id|safe }});
                    if (datosPropiedad_{{ propiedad.id|safe }}) {
                        console.log(`  - Total: ${datosPropiedad_{{ propiedad.id|safe }}.clicks_totales}`);
                        console.log(`  - Por mes: ${JSON.stringify(datosPropiedad_{{ propiedad.id|safe }}.clicks_por_mes)}`);
                    }
                    
                    this.datosPropiedades['{{ propiedad.id|safe|escapejs }}'] = {
                        total: datosPropiedad_{{ propiedad.id|safe }} ? datosPropiedad_{{ propiedad.id|safe }}.clicks_totales : 0,
                        datos: datosPropiedad_{{ propiedad.id|safe }} ? datosPropiedad_{{ propiedad.id|safe }}.clicks_por_mes : [0,0,0,0,0,0,0,0,0,0,0,0]
                    };
                    console.log(`Datos finales para propiedad {{ propiedad.id|safe }} ({{ propiedad.titulo|escapejs|safe }}):`, this.datosPropiedades['{{ propiedad.id|safe|escapejs }}']);
                    console.log(`  - Total final: ${this.datosPropiedades['{{ propiedad.id|safe|escapejs }}'].total}`);
                    console.log(`  - Datos finales: ${JSON.stringify(this.datosPropiedades['{{ propiedad.id|safe|escapejs }}'].datos)}`);
            {% endfor %}
                } catch (error) {
                    console.error('Error al cargar datos de propiedades:', error);
                    // Fallback: datos por defecto
                    {% for propiedad in todas_propiedades %}
                    this.datosPropiedades['{{ propiedad.id|safe|escapejs }}'] = {
                        total: 0,
                        datos: [0,0,0,0,0,0,0,0,0,0,0,0]
                    };
                    {% endfor %}
                }
                
                // Log final de todos los datos cargados
                console.log('=== DATOS FINALES CARGADOS ===');
                console.log('Todos los datos de propiedades:', this.datosPropiedades);
                
                // Verificar espec√≠ficamente los datos de "casa arleth"
                console.log('=== VERIFICACI√ìN ESPEC√çFICA CASA ARLETH ===');
                Object.keys(this.datosPropiedades).forEach(key => {
                    if (key !== 'todas') {
                        console.log(`Propiedad ${key}:`, this.datosPropiedades[key]);
                        console.log(`  - Total: ${this.datosPropiedades[key].total}`);
                        console.log(`  - Datos: ${JSON.stringify(this.datosPropiedades[key].datos)}`);
                        console.log(`  - Datos por mes detallado:`, this.datosPropiedades[key].datos.map((valor, index) => `Mes ${index + 1}: ${valor}`));
                    }
                });
                
                // Verificar que los datos son diferentes entre propiedades
                console.log('=== COMPARACI√ìN DE DATOS ===');
                const claves = Object.keys(this.datosPropiedades);
                for (let i = 0; i < claves.length; i++) {
                    for (let j = i + 1; j < claves.length; j++) {
                        const clave1 = claves[i];
                        const clave2 = claves[j];
                        const datos1 = this.datosPropiedades[clave1];
                        const datos2 = this.datosPropiedades[clave2];
                        
                        const sonIguales = JSON.stringify(datos1.datos) === JSON.stringify(datos2.datos);
                        console.log(`${clave1} vs ${clave2}: ${sonIguales ? 'IGUALES' : 'DIFERENTES'}`);
                        if (sonIguales) {
                            console.log(`  - Ambos tienen: ${JSON.stringify(datos1.datos)}`);
                        }
                    }
                }
            
                this.bindEvents();
                
                // Ejecutar inmediatamente y con delay para asegurar que funcione
                console.log('Ejecutando updateChart inicial...');
                this.updateChart('todas');
                setTimeout(() => {
                    console.log('Ejecutando updateChart con delay...');
                    this.updateChart('todas');
                }, 100);
            },

            bindEvents() {
                this.propiedadSelect.addEventListener('change', (e) => {
                    console.log('=== CAMBIO DE PROPIEDAD ===');
                    console.log('Nueva propiedad seleccionada:', e.target.value);
                    console.log('Datos disponibles para esta propiedad:', this.datosPropiedades[e.target.value]);
                    this.updateChart(e.target.value);
                });
            },

            updateChart(propiedad) {
                try {
                    console.log('=== INICIANDO ACTUALIZACI√ìN DE GR√ÅFICO ===');
                    console.log('Propiedad solicitada:', propiedad);
                    console.log('Datos disponibles:', Object.keys(this.datosPropiedades));
                    
                    const datos = this.datosPropiedades[propiedad];
                    if (!datos || !datos.datos || !Array.isArray(datos.datos)) {
                        console.log('No hay datos v√°lidos para la propiedad:', propiedad);
                        console.log('Datos encontrados:', datos);
                        return;
                    }
                    
                    console.log('=== ACTUALIZANDO GR√ÅFICO ===');
                    console.log('Propiedad seleccionada:', propiedad);
                    console.log('Datos encontrados:', datos);
                    console.log('Total de clics:', datos.total);
                    console.log('Datos por mes:', datos.datos);
                    console.log('Datos por mes (detallado):', datos.datos.map((valor, index) => `Mes ${index + 1}: ${valor}`));
                    
                    // Verificar si los datos son diferentes a "todas"
                    if (propiedad !== 'todas') {
                        const datosTodas = this.datosPropiedades['todas'];
                        const sonIguales = JSON.stringify(datos.datos) === JSON.stringify(datosTodas.datos);
                        console.log(`Los datos de ${propiedad} son iguales a "todas"? ${sonIguales ? 'SI' : 'NO'}`);
                        if (sonIguales) {
                            console.log('PROBLEMA: Los datos son id√©nticos a "todas las propiedades"');
                        }
                    }
                
                // Actualizar total
                this.totalClicksElement.textContent = datos.total.toLocaleString();
                console.log('Total actualizado en el DOM:', datos.total.toLocaleString());
                
                // Actualizar barras - usar selector m√°s espec√≠fico
                const barras = document.querySelectorAll('#grafico-barras .bar-chart');
                const numeros = document.querySelectorAll('#grafico-barras .absolute.inset-0.flex.items-center.justify-center.text-xs.font-semibold.text-white');
                
                console.log('=== ACTUALIZANDO BARRAS ===');
                console.log('Barras encontradas:', barras.length);
                console.log('N√∫meros encontrados:', numeros.length);
                console.log('Datos a mostrar:', datos.datos);
                
                // Verificar si el contenedor del gr√°fico existe
                const graficoContainer = document.getElementById('grafico-barras');
                if (!graficoContainer) {
                    console.error('‚ùå No se encontr√≥ el contenedor del gr√°fico #grafico-barras');
                    return;
                }
                console.log('‚úÖ Contenedor del gr√°fico encontrado');
                
                const maxValor = Math.max(...datos.datos);
                console.log('Valor m√°ximo para calcular porcentajes:', maxValor);
                
                barras.forEach((barra, index) => {
                    if (index < datos.datos.length) {
                        const valor = datos.datos[index];
                        
                        // Escalado autom√°tico con barras proporcionales
                        let porcentaje;
                        if (maxValor === 0) {
                            // Si no hay datos, todas las barras quedan en 0%
                            porcentaje = 0;
                        } else if (valor === 0) {
                            // Para 0 clics, barra m√≠nima (3% de altura)
                            porcentaje = 3;
                        } else {
                            // Para valores > 0, escalado proporcional real
                            // Rango: 10% a 85% (75% de espacio disponible)
                            const escalado = (valor / maxValor) * 75; // 75% del espacio disponible
                            porcentaje = escalado + 10; // Base del 10% + escalado proporcional
                        }
                        
                        console.log(`Procesando barra ${index}: valor=${valor}, porcentaje=${porcentaje}%`);
                        
                        // Aplicar color basado en la escala de calor (din√°mico)
                        const color = Utils.getHeatColor(valor, maxValor);
                        
                        // Aplicar estilos con escalado proporcional
                        barra.style.setProperty('width', '100%', 'important');
                        barra.style.setProperty('border-radius', '0.5rem 0.5rem 0 0', 'important');
                        barra.style.setProperty('position', 'absolute', 'important');
                        barra.style.setProperty('bottom', '0', 'important');
                        barra.style.setProperty('height', `${porcentaje}%`, 'important');
                        barra.style.setProperty('transition', 'all 0.3s ease', 'important');
                        barra.style.setProperty('background-color', color, 'important');
                        
                        // Ajustar opacidad para que se vean bien los colores de la escala de calor
                        if (valor === 0) {
                            barra.style.setProperty('opacity', '0.2', 'important');
                        } else {
                            barra.style.setProperty('opacity', '0.9', 'important');
                        }
                        
                        // ACTUALIZAR LA BARRA DE FONDO PROPORCIONALMENTE
                        const contenedorBarra = barra.parentElement;
                        if (contenedorBarra) {
                            // Ajustar la altura del contenedor de fondo proporcionalmente
                            // Para 0 clics, hacer la barra de fondo m√°s grande para que se vea el color gris
                            let alturaContenedor;
                            if (valor === 0) {
                                alturaContenedor = 25; // M√°s grande para 0 clics (25px)
                            } else {
                                alturaContenedor = Math.max(porcentaje + 8, 20); // M√≠nimo 20px para otros valores
                            }
                            contenedorBarra.style.setProperty('height', `${alturaContenedor}px`, 'important');
                            contenedorBarra.style.setProperty('transition', 'all 0.3s ease', 'important');
                        }
                        
                        console.log(`Barra ${index} actualizada: valor=${valor}, color=${color}, altura=${porcentaje}%`);
                        
                        // Actualizar el atributo data-value
                        barra.setAttribute('data-value', valor);
                        
                        // Actualizar n√∫mero
                        if (numeros[index]) {
                            numeros[index].textContent = valor;
                            // Para 0 clics, mostrar el n√∫mero en gris
                            if (valor === 0) {
                                numeros[index].style.color = '#9ca3af';
                            } else {
                                numeros[index].style.color = 'white';
                            }
                            console.log(`N√∫mero ${index} actualizado a: ${valor}`);
                        }
                    }
                });
                
                // Verificar que las barras se actualizaron correctamente
                console.log('=== VERIFICACI√ìN FINAL DE BARRAS ===');
                barras.forEach((barra, index) => {
                    console.log(`Barra ${index} final:`, {
                        height: barra.style.height,
                        backgroundColor: barra.style.backgroundColor,
                        dataValue: barra.getAttribute('data-value'),
                        textContent: numeros[index] ? numeros[index].textContent : 'N/A'
                    });
                });
                
                // Verificar que las barras se actualizaron correctamente
                console.log('=== VERIFICACI√ìN POST-ACTUALIZACI√ìN ===');
                const barrasVerificacion = document.querySelectorAll('#grafico-barras .bar-chart');
                console.log('Barras despu√©s de actualizaci√≥n:', barrasVerificacion.length);
                
                // Actualizar m√°ximo en la leyenda
                const maxIndex = datos.datos.indexOf(maxValor);
                const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                              'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
                this.leyendaMaximo.textContent = `M√°ximo: ${maxValor} clics (${meses[maxIndex]})`;
                
                } catch (error) {
                    console.error('Error al actualizar el gr√°fico:', error);
                }
            }
        };


        // ========================================
        // M√ìDULO: GESTI√ìN DE PROPIEDADES
        // ========================================
        const PropertyManager = {
            init() {
                this.dashboardContent = document.getElementById('dashboard-content');
                this.gestionContent = document.getElementById('gestion-propiedades-content');
                this.btnInicio = document.getElementById('btn-inicio');
                this.btnGestionar = document.getElementById('btn-gestionar-propiedades');
                this.btnNuevaGestion = document.getElementById('btn-nueva-propiedad-gestion');
                this.btnAgregarPrimera = document.getElementById('btn-agregar-primera-propiedad');
                
                this.bindEvents();
            },

            bindEvents() {
                // Bot√≥n de inicio
                this.btnInicio.addEventListener('click', () => {
                    this.showDashboard();
                });
                
                // Mostrar gesti√≥n de propiedades
                this.btnGestionar.addEventListener('click', () => {
                    this.showGestionPropiedades();
                });
                
                
                // Nueva propiedad desde gesti√≥n
                this.btnNuevaGestion.addEventListener('click', () => {
                    PropertyModalManager.openModal();
                });
                
                // Agregar primera propiedad
                if (this.btnAgregarPrimera) {
                    this.btnAgregarPrimera.addEventListener('click', () => {
                        PropertyModalManager.openModal();
                    });
                }
            },

            showGestionPropiedades() {
                this.dashboardContent.classList.add('hidden');
                this.gestionContent.classList.remove('hidden');
                
                // Actualizar estado del sidebar
                updateSidebarState('gestion');
                
                // Recrear iconos
                lucide.createIcons();
            },

            showDashboard() {
                this.gestionContent.classList.add('hidden');
                this.dashboardContent.classList.remove('hidden');
                
                // Actualizar estado del sidebar
                updateSidebarState('dashboard');
                
                // Recrear iconos
                lucide.createIcons();
            },

        };

        // ========================================
        // M√ìDULO: GESTI√ìN DE CONFIGURACIONES
        // ========================================
        const ConfigManager = {
            init() {
                this.configContent = document.getElementById('configuraciones-content');
                this.btnConfiguraciones = document.getElementById('btn-configuraciones');
                this.form = document.getElementById('configuracion-perfil-form');
                this.fotoInput = document.getElementById('foto-perfil-input');
                this.btnCambiarFoto = document.getElementById('btn-cambiar-foto');
                this.fotoPreview = document.getElementById('foto-perfil-preview');
                
                this.bindEvents();
            },

            bindEvents() {
                // Mostrar configuraciones
                this.btnConfiguraciones.addEventListener('click', () => {
                    this.showConfiguraciones();
                });
                
                
                // Navegaci√≥n desde configuraciones
                const btnInicio = document.getElementById('btn-inicio');
                const btnGestionar = document.getElementById('btn-gestionar-propiedades');
                
                if (btnInicio) {
                    btnInicio.addEventListener('click', () => {
                        this.showDashboard();
                    });
                }
                
                if (btnGestionar) {
                    btnGestionar.addEventListener('click', () => {
                        this.showGestionPropiedades();
                    });
                }
                
                // Cambiar foto de perfil
                this.btnCambiarFoto.addEventListener('click', () => {
                    this.fotoInput.click();
                });
                
                // Preview de foto
                this.fotoInput.addEventListener('change', (e) => {
                    this.handleFotoChange(e);
                });
                
                // Env√≠o del formulario (solo para configuraciones)
                if (this.form.id === 'configuracion-perfil-form') {
                    this.form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.handleFormSubmit();
                    });
                    
                    // Validaci√≥n en tiempo real para nombre y apellido
                    this.initRealTimeValidation();
                }
                
                // Inicializar gesti√≥n de cambio de contrase√±a
                this.initPasswordManager();
            },

            showConfiguraciones() {
                showSection('configuraciones-content');
                updateSidebarState('config');
                lucide.createIcons();
            },

            showDashboard() {
                showSection('dashboard-content');
                updateSidebarState('dashboard');
                lucide.createIcons();
            },

            showGestionPropiedades() {
                showSection('gestion-propiedades-content');
                updateSidebarState('gestion');
                lucide.createIcons();
            },


            handleFotoChange(e) {
                const file = e.target.files[0];
                if (file) {
                    // Validar tipo de archivo
                    if (!file.type.startsWith('image/')) {
                        mostrarMensaje('Por favor selecciona solo archivos de imagen.', 'danger');
                        return;
                    }
                    
                    // Validar tama√±o (20MB)
                    if (file.size > 20 * 1024 * 1024) {
                        mostrarMensaje('La imagen debe ser menor a 20MB.', 'danger');
                        return;
                    }
                    
                    // Mostrar preview
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.fotoPreview.innerHTML = `<img src="${e.target.result}" alt="Foto de perfil" class="w-full h-full object-cover">`;
                    };
                    reader.readAsDataURL(file);
                }
            },

            async handleFormSubmit() {
                console.log('=== INICIANDO ACTUALIZACI√ìN DE PERFIL ===');
                
                // Validar campos antes de enviar
                if (!this.validateForm()) {
                    return;
                }
                
                const formData = new FormData(this.form);
                
                // Log de los datos que se van a enviar
                console.log('Datos del formulario:');
                for (let [key, value] of formData.entries()) {
                    console.log(`${key}: ${value}`);
                }
                
                try {
                    const response = await fetch('/login/actualizar-perfil/', {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    });
                    
                    console.log('Respuesta del servidor:', response.status, response.statusText);
                    const result = await response.json();
                    console.log('Resultado JSON:', result);
                    
                    if (result.success) {
                        console.log('Perfil actualizado exitosamente');
                        mostrarMensaje('Perfil actualizado exitosamente.', 'success');
                        
                        // Actualizar la interfaz con los nuevos datos
                        this.updateUserInterface(formData);
                        
                        // Actualizar la foto en el sidebar si cambi√≥
                        if (result.foto_url) {
                            this.updateSidebarFoto(result.foto_url);
                        }
                    } else {
                        console.log('Error en la respuesta:', result.message);
                        mostrarMensaje(result.message || 'Error al actualizar el perfil.', 'danger');
                    }
                } catch (error) {
                    console.error('Error en la petici√≥n:', error);
                    mostrarMensaje('Error al actualizar el perfil.', 'danger');
                }
            },

            updateSidebarFoto(fotoUrl) {
                const sidebarFoto = document.querySelector('#sidebar footer .w-7');
                if (sidebarFoto && fotoUrl) {
                    sidebarFoto.innerHTML = `<img src="${fotoUrl}" alt="Foto de perfil" class="w-full h-full object-cover rounded-full">`;
                }
            },

            updateUserInterface(formData) {
                // Obtener los nuevos valores del formulario
                const nuevoNombre = formData.get('nombre') || '';
                const nuevoApellido = formData.get('apellido') || '';
                const nombreCompleto = `${nuevoNombre} ${nuevoApellido}`.trim() || 'Administrador';
                
                console.log('Actualizando interfaz con:', { nuevoNombre, nuevoApellido, nombreCompleto });
                
                // Actualizar el nombre en el sidebar
                const sidebarNombre = document.querySelector('#sidebar footer .ml-2 p');
                if (sidebarNombre) {
                    sidebarNombre.textContent = nombreCompleto;
                }
                
                // Actualizar el saludo en el header
                const headerSaludo = document.querySelector('.min-w-0 p');
                if (headerSaludo) {
                    headerSaludo.textContent = `Bienvenido, ${nombreCompleto}`;
                }
                
                console.log('Interfaz actualizada exitosamente');
            },

            validateForm() {
                console.log('=== VALIDANDO FORMULARIO ===');
                let isValid = true;
                
                // Limpiar errores anteriores
                this.clearValidationErrors();
                
                // Validar nombre
                const nombreInput = document.getElementById('nombre');
                const nombre = nombreInput.value.trim();
                
                if (!nombre) {
                    this.showFieldError(nombreInput, 'El nombre es obligatorio');
                    isValid = false;
                } else if (nombre.length < 2) {
                    this.showFieldError(nombreInput, 'El nombre debe tener al menos 2 caracteres');
                    isValid = false;
                } else if (nombre.length > 50) {
                    this.showFieldError(nombreInput, 'El nombre no puede tener m√°s de 50 caracteres');
                    isValid = false;
                } else if (!/^[a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s]+$/.test(nombre)) {
                    this.showFieldError(nombreInput, 'El nombre solo puede contener letras y espacios');
                    isValid = false;
                } else {
                    this.showFieldSuccess(nombreInput);
                }
                
                // Validar apellido
                const apellidoInput = document.getElementById('apellido');
                const apellido = apellidoInput.value.trim();
                
                if (!apellido) {
                    this.showFieldError(apellidoInput, 'El apellido es obligatorio');
                    isValid = false;
                } else if (apellido.length < 2) {
                    this.showFieldError(apellidoInput, 'El apellido debe tener al menos 2 caracteres');
                    isValid = false;
                } else if (apellido.length > 50) {
                    this.showFieldError(apellidoInput, 'El apellido no puede tener m√°s de 50 caracteres');
                    isValid = false;
                } else if (!/^[a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s]+$/.test(apellido)) {
                    this.showFieldError(apellidoInput, 'El apellido solo puede contener letras y espacios');
                    isValid = false;
                } else {
                    this.showFieldSuccess(apellidoInput);
                }
                
                // Validar foto de perfil
                const fotoInput = document.getElementById('foto-perfil-input');
                if (fotoInput.files.length > 0) {
                    const file = fotoInput.files[0];
                    const maxSize = 20 * 1024 * 1024; // 20MB
                    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                    
                    if (!allowedTypes.includes(file.type)) {
                        this.showFieldError(fotoInput, 'Solo se permiten archivos de imagen (JPEG, PNG, GIF, WebP)');
                        isValid = false;
                    } else if (file.size > maxSize) {
                        this.showFieldError(fotoInput, 'El archivo debe ser menor a 20MB');
                        isValid = false;
                    } else {
                        this.showFieldSuccess(fotoInput);
                    }
                }
                
                console.log('Validaci√≥n completada. V√°lido:', isValid);
                return isValid;
            },

            clearValidationErrors() {
                // Limpiar todos los mensajes de error y √©xito
                const errorMessages = document.querySelectorAll('.field-error-message');
                errorMessages.forEach(msg => msg.remove());
                
                // Limpiar clases de error y √©xito de todos los inputs
                const inputs = document.querySelectorAll('#configuracion-perfil-form input[type="text"]');
                inputs.forEach(input => {
                    input.classList.remove('border-red-500', 'border-green-500', 'bg-red-50', 'bg-green-50');
                    input.classList.add('border-gray-300');
                });
            },

            showFieldError(input, message) {
                // Agregar clase de error al input
                input.classList.remove('border-gray-300', 'border-green-500', 'bg-green-50');
                input.classList.add('border-red-500', 'bg-red-50');
                
                // Remover mensaje de error anterior si existe
                const existingError = input.parentNode.querySelector('.field-error-message');
                if (existingError) {
                    existingError.remove();
                }
                
                // Crear y mostrar mensaje de error
                const errorDiv = document.createElement('div');
                errorDiv.className = 'field-error-message text-red-500 text-xs mt-1 flex items-center';
                errorDiv.innerHTML = `
                    <i data-lucide="alert-circle" class="w-3 h-3 mr-1"></i>
                    ${message}
                `;
                
                input.parentNode.appendChild(errorDiv);
                lucide.createIcons();
            },

            showFieldSuccess(input) {
                // Agregar clase de √©xito al input
                input.classList.remove('border-gray-300', 'border-red-500', 'bg-red-50');
                input.classList.add('border-green-500', 'bg-green-50');
                
                // Remover mensaje de error anterior si existe
                const existingError = input.parentNode.querySelector('.field-error-message');
                if (existingError) {
                    existingError.remove();
                }
            },

            initRealTimeValidation() {
                const nombreInput = document.getElementById('nombre');
                const apellidoInput = document.getElementById('apellido');
                const fotoInput = document.getElementById('foto-perfil-input');
                
                if (nombreInput) {
                    nombreInput.addEventListener('blur', () => {
                        this.validateSingleField(nombreInput, 'nombre');
                    });
                    
                    nombreInput.addEventListener('input', () => {
                        // Limpiar errores mientras se escribe
                        if (nombreInput.classList.contains('border-red-500')) {
                            this.clearFieldError(nombreInput);
                        }
                    });
                }
                
                if (apellidoInput) {
                    apellidoInput.addEventListener('blur', () => {
                        this.validateSingleField(apellidoInput, 'apellido');
                    });
                    
                    apellidoInput.addEventListener('input', () => {
                        // Limpiar errores mientras se escribe
                        if (apellidoInput.classList.contains('border-red-500')) {
                            this.clearFieldError(apellidoInput);
                        }
                    });
                }
                
                if (fotoInput) {
                    fotoInput.addEventListener('change', () => {
                        this.validateSingleField(fotoInput, 'foto');
                    });
                }
            },

            validateSingleField(input, fieldType) {
                const value = input.value.trim();
                let isValid = true;
                let errorMessage = '';
                
                if (fieldType === 'nombre') {
                    if (!value) {
                        errorMessage = 'El nombre es obligatorio';
                        isValid = false;
                    } else if (value.length < 2) {
                        errorMessage = 'El nombre debe tener al menos 2 caracteres';
                        isValid = false;
                    } else if (value.length > 50) {
                        errorMessage = 'El nombre no puede tener m√°s de 50 caracteres';
                        isValid = false;
                    } else if (!/^[a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s]+$/.test(value)) {
                        errorMessage = 'El nombre solo puede contener letras y espacios';
                        isValid = false;
                    }
                } else if (fieldType === 'apellido') {
                    if (!value) {
                        errorMessage = 'El apellido es obligatorio';
                        isValid = false;
                    } else if (value.length < 2) {
                        errorMessage = 'El apellido debe tener al menos 2 caracteres';
                        isValid = false;
                    } else if (value.length > 50) {
                        errorMessage = 'El apellido no puede tener m√°s de 50 caracteres';
                        isValid = false;
                    } else if (!/^[a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s]+$/.test(value)) {
                        errorMessage = 'El apellido solo puede contener letras y espacios';
                        isValid = false;
                    }
                } else if (fieldType === 'foto') {
                    if (input.files.length > 0) {
                        const file = input.files[0];
                        const maxSize = 20 * 1024 * 1024; // 20MB
                        const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                        
                        if (!allowedTypes.includes(file.type)) {
                            errorMessage = 'Solo se permiten archivos de imagen (JPEG, PNG, GIF, WebP)';
                            isValid = false;
                        } else if (file.size > maxSize) {
                            errorMessage = 'El archivo debe ser menor a 20MB';
                            isValid = false;
                        }
                    }
                }
                
                if (!isValid) {
                    this.showFieldError(input, errorMessage);
                } else if (value || (fieldType === 'foto' && input.files.length > 0)) {
                    this.showFieldSuccess(input);
                } else {
                    this.clearFieldError(input);
                }
            },

            clearFieldError(input) {
                input.classList.remove('border-red-500', 'border-green-500', 'bg-red-50', 'bg-green-50');
                input.classList.add('border-gray-300');
                
                const existingError = input.parentNode.querySelector('.field-error-message');
                if (existingError) {
                    existingError.remove();
                }
            },

            initPasswordManager() {
                const passwordForm = document.getElementById('cambiar-password-form');
                const btnEnviarSMS = document.getElementById('btn-enviar-sms');
                const btnVerificarSMS = document.getElementById('btn-verificar-sms');
                const btnCancelarPassword = document.getElementById('cancelar-password');
                const btnCambiarPassword = document.getElementById('btn-cambiar-password');
                
                // Event listeners para cambio de contrase√±a
                if (btnEnviarSMS) {
                    btnEnviarSMS.addEventListener('click', enviarCodigoSMS);
                }
                
                if (btnVerificarSMS) {
                    btnVerificarSMS.addEventListener('click', verificarCodigoSMS);
                }
                
                if (btnCancelarPassword) {
                    btnCancelarPassword.addEventListener('click', () => {
                        this.resetPasswordForm();
                    });
                }
                
                if (passwordForm) {
                    passwordForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.handlePasswordChange();
                    });
                }
                
                // Validaci√≥n en tiempo real de contrase√±as
                const nuevaPassword = document.getElementById('nueva_password');
                const confirmarPassword = document.getElementById('confirmar_nueva_password');
                
                if (nuevaPassword && confirmarPassword) {
                    [nuevaPassword, confirmarPassword].forEach(input => {
                        input.addEventListener('input', () => {
                            this.validatePasswords();
                        });
                    });
                }
            },

            validatePasswords() {
                const nuevaPassword = document.getElementById('nueva_password').value;
                const confirmarPassword = document.getElementById('confirmar_nueva_password').value;
                const btnCambiarPassword = document.getElementById('btn-cambiar-password');
                
                // Validar que las contrase√±as coincidan
                if (nuevaPassword && confirmarPassword) {
                    if (nuevaPassword === confirmarPassword) {
                        if (nuevaPassword.length >= 8) {
                            // Habilitar bot√≥n si est√° verificado por SMS o tiene contrase√±a actual
                            const passwordActual = document.getElementById('password_actual').value;
                            if (passwordActual || smsVerified) {
                                btnCambiarPassword.disabled = false;
                            }
                        } else {
                            btnCambiarPassword.disabled = true;
                            mostrarMensajePassword('La contrase√±a debe tener al menos 8 caracteres.', 'danger');
                        }
                    } else {
                        btnCambiarPassword.disabled = true;
                        mostrarMensajePassword('Las contrase√±as no coinciden.', 'danger');
                    }
                } else {
                    btnCambiarPassword.disabled = true;
                }
            },

            resetPasswordForm() {
                const form = document.getElementById('cambiar-password-form');
                if (form) form.reset();
                
                // Limpiar variables globales
                smsCodeSent = false;
                smsVerified = false;
                if (smsTimer) {
                    clearInterval(smsTimer);
                    smsTimer = null;
                }
                
                // Ocultar secci√≥n de SMS
                const smsSection = document.getElementById('sms-verification-section');
                if (smsSection) smsSection.classList.add('hidden');
                
                // Deshabilitar bot√≥n
                const btnCambiarPassword = document.getElementById('btn-cambiar-password');
                if (btnCambiarPassword) btnCambiarPassword.disabled = true;
                
                // Limpiar mensajes
                const messagesContainer = document.getElementById('password-messages');
                if (messagesContainer) {
                    messagesContainer.innerHTML = '';
                    messagesContainer.classList.add('hidden');
                }
            },

            async handlePasswordChange() {
                const formData = new FormData(document.getElementById('cambiar-password-form'));
                const passwordActual = formData.get('password_actual');
                const nuevaPassword = formData.get('nueva_password');
                const confirmarPassword = formData.get('confirmar_nueva_password');
                
                // Validaciones
                if (!nuevaPassword || !confirmarPassword) {
                    mostrarMensajePassword('Por favor completa todos los campos.', 'danger');
                    return;
                }
                
                if (nuevaPassword !== confirmarPassword) {
                    mostrarMensajePassword('Las contrase√±as no coinciden.', 'danger');
                    return;
                }
                
                if (nuevaPassword.length < 8) {
                    mostrarMensajePassword('La contrase√±a debe tener al menos 8 caracteres.', 'danger');
                    return;
                }
                
                // Verificar que tenga contrase√±a actual O verificaci√≥n SMS
                if (!passwordActual && !smsVerified) {
                    mostrarMensajePassword('Debes ingresar tu contrase√±a actual o verificar por SMS.', 'danger');
                    return;
                }
                
                try {
                    const response = await fetch('/login/cambiar-password/', {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        mostrarMensajePassword('Contrase√±a cambiada exitosamente.', 'success');
                        this.resetPasswordForm();
                    } else {
                        mostrarMensajePassword(result.message || 'Error al cambiar la contrase√±a.', 'danger');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    mostrarMensajePassword('Error al cambiar la contrase√±a.', 'danger');
                }
            }
        };

        // ========================================
        // M√ìDULO: GESTI√ìN DEL MODAL DE NUEVO USUARIO
        // ========================================
        const UsuarioModalManager = {
            init() {
                this.modal = document.getElementById('modal-nuevo-usuario');
                this.btnAbrir = document.getElementById('btn-nuevo-usuario');
                this.btnCerrar = document.getElementById('cerrar-modal-usuario');
                this.btnCancelar = document.getElementById('cancelar-modal-usuario');
                this.form = document.getElementById('crearUsuarioForm');
                this.messagesContainer = document.getElementById('modal-messages-usuario');
                
                // Tabs
                this.tabCrearUsuario = document.getElementById('tab-crear-usuario');
                this.tabGestionarUsuarios = document.getElementById('tab-gestionar-usuarios');
                this.contentCrearUsuario = document.getElementById('content-crear-usuario');
                this.contentGestionarUsuarios = document.getElementById('content-gestionar-usuarios');
                
                // Gesti√≥n de usuarios
                this.btnRefrescarUsuarios = document.getElementById('btn-refrescar-usuarios');
                this.usuariosList = document.getElementById('usuarios-list');
                this.usuariosMessages = document.getElementById('usuarios-messages');
                
                this.bindEvents();
                this.initFormHandlers();
                this.initTabHandlers();
            },

            bindEvents() {
                // Abrir modal
                this.btnAbrir.addEventListener('click', () => {
                    this.openModal();
                });
                
                // Cerrar modal
                this.btnCerrar.addEventListener('click', () => {
                    this.closeModal();
                });
                
                this.btnCancelar.addEventListener('click', () => {
                    this.closeModal();
                });
                
                // Cerrar al hacer clic fuera del modal
                this.modal.addEventListener('click', (e) => {
                    if (e.target === this.modal) {
                        this.closeModal();
                    }
                });
                
                // Cerrar con tecla Escape
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && !this.modal.classList.contains('hidden')) {
                        this.closeModal();
                    }
                });
            },

            openModal() {
                this.modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                // Recrear iconos de Lucide para el modal
                lucide.createIcons();
            },

            closeModal() {
                this.modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                this.resetForm();
            },

            resetForm() {
                this.form.reset();
                this.clearMessages();
                // Limpiar preview de foto
                const fotoPreview = document.getElementById('foto-preview-usuario');
                const fotoPlaceholder = document.getElementById('foto-placeholder-usuario');
                if (fotoPreview) fotoPreview.classList.add('hidden');
                if (fotoPlaceholder) fotoPlaceholder.classList.remove('hidden');
            },

            showMessage(message, type = 'success') {
                const bgColor = type === 'success' ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800';
                const iconColor = type === 'success' ? 'text-green-600' : 'text-red-600';
                const icon = type === 'success' ? 'check-circle' : 'alert-circle';
                
                this.messagesContainer.innerHTML = 
                    '<div class="border rounded-lg p-4 ' + bgColor + ' flex items-start">' +
                        '<i data-lucide="' + icon + '" class="w-5 h-5 ' + iconColor + ' mr-3 mt-0.5"></i>' +
                        '<div class="flex-1">' +
                            '<p class="text-sm font-medium">' + message + '</p>' +
                        '</div>' +
                        '<button type="button" onclick="this.parentElement.parentElement.remove()" class="ml-3 text-gray-400 hover:text-gray-600">' +
                            '<i data-lucide="x" class="w-4 h-4"></i>' +
                        '</button>' +
                    '</div>';
                this.messagesContainer.classList.remove('hidden');
                // Recrear iconos de Lucide
                lucide.createIcons();
            },

            clearMessages() {
                this.messagesContainer.innerHTML = '';
                this.messagesContainer.classList.add('hidden');
            },

            initFormHandlers() {
                // Preview de foto de perfil
                const fotoInput = document.getElementById('foto_perfil_usuario');
                const fotoPreview = document.getElementById('foto-preview-usuario');
                const fotoPreviewImg = document.getElementById('foto-preview-img-usuario');
                const fotoPlaceholder = document.getElementById('foto-placeholder-usuario');
                
                if (fotoInput) {
                    fotoInput.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            // Validar que sea una imagen
                            if (!file.type.startsWith('image/')) {
                                alert('Por favor selecciona solo archivos de imagen.');
                                this.resetForm();
                                return;
                            }
                            
                            // Validar tama√±o (20MB)
                            if (file.size > 20 * 1024 * 1024) {
                                alert('La imagen debe ser menor a 20MB.');
                                this.resetForm();
                                return;
                            }
                            
                            // Mostrar preview
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                fotoPreviewImg.src = e.target.result;
                                fotoPreview.classList.remove('hidden');
                                fotoPlaceholder.classList.add('hidden');
                            };
                            reader.readAsDataURL(file);
                        } else {
                            // Ocultar preview si no hay archivo
                            fotoPreview.classList.add('hidden');
                            fotoPlaceholder.classList.remove('hidden');
                        }
                    });
                }
                
                // Validaci√≥n antes de enviar (solo para nuevo usuario)
                if (this.form.id === 'crearUsuarioForm') {
                    this.form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.handleFormSubmit();
                    });
                    
                    // Validaci√≥n en tiempo real para nombre y apellido
                    this.initRealTimeValidationCreateUser();
                }
            },

            async handleFormSubmit() {
                // Validar campos antes de enviar
                if (!this.validateCreateUserForm()) {
                    return;
                }
                
                const formData = new FormData(this.form);
                
                try {
                    const response = await fetch(this.form.action, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        if (result.success) {
                            this.showMessage(result.message, 'success');
                            
                            // Agregar actividad
                            const nombre = formData.get('nombre') || 'Nuevo usuario';
                            const apellido = formData.get('apellido') || '';
                            const nombreCompleto = `${nombre} ${apellido}`.trim();
                            
                            ActivitiesManager.addActivity(
                                'user', 
                                'Usuario creado', 
                                `"${nombreCompleto}" agregado al sistema`, 
                                'user-plus', 
                                'green'
                            );
                            
                            setTimeout(() => {
                                this.closeModal();
                                // Recargar la p√°gina para actualizar las estad√≠sticas
                                window.location.reload();
                            }, 2000);
                        } else {
                            // Mostrar errores espec√≠ficos del formulario
                            if (result.errors) {
                                let errorMessage = result.message || 'Por favor corrige los siguientes errores:';
                                for (const [field, errors] of Object.entries(result.errors)) {
                                    errorMessage += `\n- ${field}: ${errors.join(', ')}`;
                                }
                                this.showMessage(errorMessage, 'danger');
                            } else {
                                this.showMessage(result.message || 'Error al crear el usuario', 'danger');
                            }
                        }
                    } else {
                        this.showMessage('Error al crear el usuario. Por favor intenta de nuevo.', 'danger');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    this.showMessage('Error al crear el usuario. Por favor intenta de nuevo.', 'danger');
                }
            },

            initTabHandlers() {
                // Tab: Crear Usuario
                this.tabCrearUsuario.addEventListener('click', () => {
                    this.showTab('crear');
                });
                
                // Tab: Gestionar Usuarios
                this.tabGestionarUsuarios.addEventListener('click', () => {
                    this.showTab('gestionar');
                });
                
                // Bot√≥n refrescar usuarios
                this.btnRefrescarUsuarios.addEventListener('click', () => {
                    this.cargarUsuarios();
                });
            },

            showTab(tabName) {
                // Remover clases activas de todos los tabs
                this.tabCrearUsuario.classList.remove('bg-green-600', 'text-white');
                this.tabCrearUsuario.classList.add('text-gray-600', 'hover:bg-gray-200');
                this.tabGestionarUsuarios.classList.remove('bg-green-600', 'text-white');
                this.tabGestionarUsuarios.classList.add('text-gray-600', 'hover:bg-gray-200');
                
                // Ocultar todos los contenidos
                this.contentCrearUsuario.classList.add('hidden');
                this.contentGestionarUsuarios.classList.add('hidden');
                
                if (tabName === 'crear') {
                    // Activar tab crear usuario
                    this.tabCrearUsuario.classList.remove('text-gray-600', 'hover:bg-gray-200');
                    this.tabCrearUsuario.classList.add('bg-green-600', 'text-white');
                    this.contentCrearUsuario.classList.remove('hidden');
                } else if (tabName === 'gestionar') {
                    // Activar tab gestionar usuarios
                    this.tabGestionarUsuarios.classList.remove('text-gray-600', 'hover:bg-gray-200');
                    this.tabGestionarUsuarios.classList.add('bg-green-600', 'text-white');
                    this.contentGestionarUsuarios.classList.remove('hidden');
                    // Cargar usuarios cuando se muestra el tab
                    this.cargarUsuarios();
                }
                
                lucide.createIcons();
            },

            async cargarUsuarios() {
                try {
                    this.usuariosList.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <i data-lucide="loader" class="w-8 h-8 mx-auto mb-4 text-gray-300 animate-spin"></i>
                            <p>Cargando usuarios...</p>
                        </div>
                    `;
                    lucide.createIcons();
                    
                    const response = await fetch('/login/listar-usuarios-admin/', {
                        method: 'GET',
                        headers: {
                            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.mostrarUsuarios(result.usuarios);
                    } else {
                        this.mostrarErrorUsuarios(result.message || 'Error al cargar usuarios');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    this.mostrarErrorUsuarios('Error al cargar usuarios');
                }
            },

            mostrarUsuarios(usuarios) {
                if (usuarios.length === 0) {
                    this.usuariosList.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <i data-lucide="users" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                            <p>No hay usuarios administrativos registrados</p>
                        </div>
                    `;
                } else {
                    this.usuariosList.innerHTML = usuarios.map(usuario => `
                        <div class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center overflow-hidden">
                                        ${usuario.foto_perfil ? 
                                            `<img src="${usuario.foto_perfil}" alt="Foto de perfil" class="w-full h-full object-cover">` :
                                            `<i data-lucide="user" class="w-6 h-6 text-blue-600"></i>`
                                        }
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-gray-900">${usuario.nombre_completo}</h4>
                                        <p class="text-sm text-gray-600">${usuario.email}</p>
                                        <p class="text-xs text-gray-500">Creado: ${usuario.fecha_creacion}</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${usuario.activo ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                        ${usuario.activo ? 'Activo' : 'Inactivo'}
                                    </span>
                                    <button onclick="UsuarioModalManager.confirmarEliminarUsuario(${usuario.id}, \`${usuario.nombre_completo}\`)" 
                                            class="text-red-600 hover:text-red-800 transition-colors" title="Eliminar usuario">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
                lucide.createIcons();
            },

            mostrarErrorUsuarios(mensaje) {
                this.usuariosList.innerHTML = `
                    <div class="text-center py-8 text-red-500">
                        <i data-lucide="alert-circle" class="w-12 h-12 mx-auto mb-4 text-red-300"></i>
                        <p>${mensaje}</p>
                    </div>
                `;
                lucide.createIcons();
            },

            confirmarEliminarUsuario(usuarioId, nombreUsuario) {
                window.usuarioAEliminar = usuarioId;
                document.getElementById('usuario-nombre-eliminar').textContent = nombreUsuario;
                
                const modal = document.getElementById('modal-eliminar-usuario');
                modal.classList.remove('hidden');
                
                lucide.createIcons();
            },

            validateCreateUserForm() {
                console.log('=== VALIDANDO FORMULARIO DE CREAR USUARIO ===');
                let isValid = true;
                
                // Limpiar errores anteriores
                this.clearCreateUserValidationErrors();
                
                // Validar nombre
                const nombreInput = document.getElementById('nombre_usuario');
                const nombre = nombreInput.value.trim();
                
                if (!nombre) {
                    this.showCreateUserFieldError(nombreInput, 'El nombre es obligatorio');
                    isValid = false;
                } else if (nombre.length < 2) {
                    this.showCreateUserFieldError(nombreInput, 'El nombre debe tener al menos 2 caracteres');
                    isValid = false;
                } else if (nombre.length > 50) {
                    this.showCreateUserFieldError(nombreInput, 'El nombre no puede tener m√°s de 50 caracteres');
                    isValid = false;
                } else if (!/^[a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s]+$/.test(nombre)) {
                    this.showCreateUserFieldError(nombreInput, 'El nombre solo puede contener letras y espacios');
                    isValid = false;
                } else {
                    this.showCreateUserFieldSuccess(nombreInput);
                }
                
                // Validar apellido
                const apellidoInput = document.getElementById('apellido_usuario');
                const apellido = apellidoInput.value.trim();
                
                if (!apellido) {
                    this.showCreateUserFieldError(apellidoInput, 'El apellido es obligatorio');
                    isValid = false;
                } else if (apellido.length < 2) {
                    this.showCreateUserFieldError(apellidoInput, 'El apellido debe tener al menos 2 caracteres');
                    isValid = false;
                } else if (apellido.length > 50) {
                    this.showCreateUserFieldError(apellidoInput, 'El apellido no puede tener m√°s de 50 caracteres');
                    isValid = false;
                } else if (!/^[a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s]+$/.test(apellido)) {
                    this.showCreateUserFieldError(apellidoInput, 'El apellido solo puede contener letras y espacios');
                    isValid = false;
                } else {
                    this.showCreateUserFieldSuccess(apellidoInput);
                }
                
                // Validar tel√©fono
                const telefonoInput = document.getElementById('telefono_usuario');
                const telefono = telefonoInput.value.trim();
                
                if (!telefono || telefono === '+54') {
                    this.showCreateUserFieldError(telefonoInput, 'Debes ingresar el n√∫mero de tel√©fono despu√©s del +54');
                    isValid = false;
                } else if (!/^\+54\d{10,12}$/.test(telefono)) {
                    this.showCreateUserFieldError(telefonoInput, 'El tel√©fono debe tener entre 10 y 12 d√≠gitos despu√©s del +54');
                    isValid = false;
                } else {
                    this.showCreateUserFieldSuccess(telefonoInput);
                }
                
                // Validar fecha de nacimiento
                const fechaInput = document.getElementById('fecha_nacimiento_usuario');
                const fecha = fechaInput.value;
                
                if (fecha) {
                    const fechaNacimiento = new Date(fecha);
                    const a√±oActual = new Date().getFullYear();
                    const minFecha = new Date('1900-01-01');
                    const maxFecha = new Date(`${a√±oActual}-12-31`);
                    
                    if (fechaNacimiento < minFecha || fechaNacimiento > maxFecha) {
                        this.showCreateUserFieldError(fechaInput, `La fecha debe estar entre 1900 y ${a√±oActual}`);
                        isValid = false;
                    } else {
                        this.showCreateUserFieldSuccess(fechaInput);
                    }
                }
                
                // Validar foto de perfil
                const fotoInput = document.getElementById('foto_perfil_usuario');
                if (fotoInput.files.length > 0) {
                    const file = fotoInput.files[0];
                    const maxSize = 20 * 1024 * 1024; // 20MB
                    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                    
                    if (!allowedTypes.includes(file.type)) {
                        this.showCreateUserFieldError(fotoInput, 'Solo se permiten archivos de imagen (JPEG, PNG, GIF, WebP)');
                        isValid = false;
                    } else if (file.size > maxSize) {
                        this.showCreateUserFieldError(fotoInput, 'El archivo debe ser menor a 20MB');
                        isValid = false;
                    } else {
                        this.showCreateUserFieldSuccess(fotoInput);
                    }
                }
                
                // Validar correo electr√≥nico
                const emailInput = document.getElementById('email_usuario');
                const email = emailInput.value.trim();
                
                if (!email) {
                    this.showCreateUserFieldError(emailInput, 'El correo electr√≥nico es obligatorio');
                    isValid = false;
                } else if (!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(email)) {
                    this.showCreateUserFieldError(emailInput, 'Ingresa un correo electr√≥nico v√°lido');
                    isValid = false;
                } else {
                    this.showCreateUserFieldSuccess(emailInput);
                }
                
                // Validar contrase√±a
                const passwordInput = document.getElementById('password_usuario');
                const password = passwordInput.value;
                
                if (!password) {
                    this.showCreateUserFieldError(passwordInput, 'La contrase√±a es obligatoria');
                    isValid = false;
                } else if (password.length < 8) {
                    this.showCreateUserFieldError(passwordInput, 'La contrase√±a debe tener al menos 8 caracteres');
                    isValid = false;
                } else {
                    this.showCreateUserFieldSuccess(passwordInput);
                }
                
                // Validar confirmar contrase√±a
                const confirmPasswordInput = document.getElementById('confirmar_password_usuario');
                const confirmPassword = confirmPasswordInput.value;
                
                if (!confirmPassword) {
                    this.showCreateUserFieldError(confirmPasswordInput, 'Debes confirmar la contrase√±a');
                    isValid = false;
                } else if (password !== confirmPassword) {
                    this.showCreateUserFieldError(confirmPasswordInput, 'Las contrase√±as no coinciden');
                    isValid = false;
                } else {
                    this.showCreateUserFieldSuccess(confirmPasswordInput);
                }
                
                console.log('Validaci√≥n de crear usuario completada. V√°lido:', isValid);
                return isValid;
            },

            clearCreateUserValidationErrors() {
                // Limpiar todos los mensajes de error y √©xito
                const errorMessages = document.querySelectorAll('.create-user-field-error-message');
                errorMessages.forEach(msg => msg.remove());
                
                // Limpiar clases de error y √©xito de todos los inputs
                const inputs = document.querySelectorAll('#crearUsuarioForm input[type="text"]');
                inputs.forEach(input => {
                    input.classList.remove('border-red-500', 'border-green-500', 'bg-red-50', 'bg-green-50');
                    input.classList.add('border-gray-300');
                });
            },

            showCreateUserFieldError(input, message) {
                // Agregar clase de error al input
                input.classList.remove('border-gray-300', 'border-green-500', 'bg-green-50');
                input.classList.add('border-red-500', 'bg-red-50');
                
                // Remover mensaje de error anterior si existe
                const existingError = input.parentNode.querySelector('.create-user-field-error-message');
                if (existingError) {
                    existingError.remove();
                }
                
                // Crear y mostrar mensaje de error
                const errorDiv = document.createElement('div');
                errorDiv.className = 'create-user-field-error-message text-red-500 text-xs mt-1 flex items-center';
                errorDiv.innerHTML = `
                    <i data-lucide="alert-circle" class="w-3 h-3 mr-1"></i>
                    ${message}
                `;
                
                input.parentNode.appendChild(errorDiv);
                lucide.createIcons();
            },

            showCreateUserFieldSuccess(input) {
                // Agregar clase de √©xito al input
                input.classList.remove('border-gray-300', 'border-red-500', 'bg-red-50');
                input.classList.add('border-green-500', 'bg-green-50');
                
                // Remover mensaje de error anterior si existe
                const existingError = input.parentNode.querySelector('.create-user-field-error-message');
                if (existingError) {
                    existingError.remove();
                }
            },

            initRealTimeValidationCreateUser() {
                const nombreInput = document.getElementById('nombre_usuario');
                const apellidoInput = document.getElementById('apellido_usuario');
                const telefonoInput = document.getElementById('telefono_usuario');
                const fechaInput = document.getElementById('fecha_nacimiento_usuario');
                const fotoInput = document.getElementById('foto_perfil_usuario');
                const emailInput = document.getElementById('email_usuario');
                const passwordInput = document.getElementById('password_usuario');
                const confirmPasswordInput = document.getElementById('confirmar_password_usuario');
                
                // Validaci√≥n para nombre
                if (nombreInput) {
                    nombreInput.addEventListener('blur', () => {
                        this.validateCreateUserSingleField(nombreInput, 'nombre');
                    });
                    
                    nombreInput.addEventListener('input', () => {
                        if (nombreInput.classList.contains('border-red-500')) {
                            this.clearCreateUserFieldError(nombreInput);
                        }
                    });
                }
                
                // Validaci√≥n para apellido
                if (apellidoInput) {
                    apellidoInput.addEventListener('blur', () => {
                        this.validateCreateUserSingleField(apellidoInput, 'apellido');
                    });
                    
                    apellidoInput.addEventListener('input', () => {
                        if (apellidoInput.classList.contains('border-red-500')) {
                            this.clearCreateUserFieldError(apellidoInput);
                        }
                    });
                }
                
                // Validaci√≥n para tel√©fono
                if (telefonoInput) {
                    // Asegurar que siempre tenga el prefijo +54
                    telefonoInput.addEventListener('focus', () => {
                        if (!telefonoInput.value.startsWith('+54')) {
                            telefonoInput.value = '+54';
                        }
                    });
                    
                    telefonoInput.addEventListener('input', () => {
                        // Si el usuario intenta borrar el prefijo, restaurarlo
                        if (!telefonoInput.value.startsWith('+54')) {
                            telefonoInput.value = '+54' + telefonoInput.value.replace(/[^\d]/g, '');
                        }
                        
                        if (telefonoInput.classList.contains('border-red-500')) {
                            this.clearCreateUserFieldError(telefonoInput);
                        }
                    });
                    
                    telefonoInput.addEventListener('blur', () => {
                        this.validateCreateUserSingleField(telefonoInput, 'telefono');
                    });
                    
                    // Prevenir que el usuario borre el prefijo +54
                    telefonoInput.addEventListener('keydown', (e) => {
                        const cursorPos = telefonoInput.selectionStart;
                        if (cursorPos <= 3 && (e.key === 'Backspace' || e.key === 'Delete')) {
                            e.preventDefault();
                        }
                    });
                }
                
                // Validaci√≥n para fecha de nacimiento
                if (fechaInput) {
                    fechaInput.addEventListener('change', () => {
                        this.validateCreateUserSingleField(fechaInput, 'fecha');
                    });
                }
                
                // Validaci√≥n para foto de perfil
                if (fotoInput) {
                    fotoInput.addEventListener('change', () => {
                        this.validateCreateUserSingleField(fotoInput, 'foto');
                    });
                }
                
                // Validaci√≥n para correo electr√≥nico
                if (emailInput) {
                    emailInput.addEventListener('blur', () => {
                        this.validateCreateUserSingleField(emailInput, 'email');
                    });
                    
                    emailInput.addEventListener('input', () => {
                        if (emailInput.classList.contains('border-red-500')) {
                            this.clearCreateUserFieldError(emailInput);
                        }
                    });
                }
                
                // Validaci√≥n para contrase√±a
                if (passwordInput) {
                    passwordInput.addEventListener('blur', () => {
                        this.validateCreateUserSingleField(passwordInput, 'password');
                    });
                    
                    passwordInput.addEventListener('input', () => {
                        if (passwordInput.classList.contains('border-red-500')) {
                            this.clearCreateUserFieldError(passwordInput);
                        }
                    });
                }
                
                // Validaci√≥n para confirmar contrase√±a
                if (confirmPasswordInput) {
                    confirmPasswordInput.addEventListener('blur', () => {
                        this.validateCreateUserSingleField(confirmPasswordInput, 'confirmPassword');
                    });
                    
                    confirmPasswordInput.addEventListener('input', () => {
                        if (confirmPasswordInput.classList.contains('border-red-500')) {
                            this.clearCreateUserFieldError(confirmPasswordInput);
                        }
                    });
                }
            },

            validateCreateUserSingleField(input, fieldType) {
                const value = input.value.trim();
                let isValid = true;
                let errorMessage = '';
                
                if (fieldType === 'nombre') {
                    if (!value) {
                        errorMessage = 'El nombre es obligatorio';
                        isValid = false;
                    } else if (value.length < 2) {
                        errorMessage = 'El nombre debe tener al menos 2 caracteres';
                        isValid = false;
                    } else if (value.length > 50) {
                        errorMessage = 'El nombre no puede tener m√°s de 50 caracteres';
                        isValid = false;
                    } else if (!/^[a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s]+$/.test(value)) {
                        errorMessage = 'El nombre solo puede contener letras y espacios';
                        isValid = false;
                    }
                } else if (fieldType === 'apellido') {
                    if (!value) {
                        errorMessage = 'El apellido es obligatorio';
                        isValid = false;
                    } else if (value.length < 2) {
                        errorMessage = 'El apellido debe tener al menos 2 caracteres';
                        isValid = false;
                    } else if (value.length > 50) {
                        errorMessage = 'El apellido no puede tener m√°s de 50 caracteres';
                        isValid = false;
                    } else if (!/^[a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë\s]+$/.test(value)) {
                        errorMessage = 'El apellido solo puede contener letras y espacios';
                        isValid = false;
                    }
                } else if (fieldType === 'telefono') {
                    if (!value || value === '+54') {
                        errorMessage = 'Debes ingresar el n√∫mero de tel√©fono despu√©s del +54';
                        isValid = false;
                    } else if (!/^\+54\d{10,12}$/.test(value)) {
                        errorMessage = 'El tel√©fono debe tener entre 10 y 12 d√≠gitos despu√©s del +54';
                        isValid = false;
                    }
                } else if (fieldType === 'fecha') {
                    if (value) {
                        const fechaNacimiento = new Date(value);
                        const minFecha = new Date('1900-01-01');
                        const a√±oActual = new Date().getFullYear();
                        const maxFecha = new Date(`${a√±oActual}-12-31`);
                        
                        if (fechaNacimiento < minFecha || fechaNacimiento > maxFecha) {
                            errorMessage = `La fecha debe estar entre 1900 y ${a√±oActual}`;
                            isValid = false;
                        }
                    }
                } else if (fieldType === 'foto') {
                    if (input.files.length > 0) {
                        const file = input.files[0];
                        const maxSize = 20 * 1024 * 1024; // 20MB
                        const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                        
                        if (!allowedTypes.includes(file.type)) {
                            errorMessage = 'Solo se permiten archivos de imagen (JPEG, PNG, GIF, WebP)';
                            isValid = false;
                        } else if (file.size > maxSize) {
                            errorMessage = 'El archivo debe ser menor a 20MB';
                            isValid = false;
                        }
                    }
                } else if (fieldType === 'email') {
                    if (!value) {
                        errorMessage = 'El correo electr√≥nico es obligatorio';
                        isValid = false;
                    } else if (!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(value)) {
                        errorMessage = 'Ingresa un correo electr√≥nico v√°lido';
                        isValid = false;
                    }
                } else if (fieldType === 'password') {
                    if (!value) {
                        errorMessage = 'La contrase√±a es obligatoria';
                        isValid = false;
                    } else if (value.length < 8) {
                        errorMessage = 'La contrase√±a debe tener al menos 8 caracteres';
                        isValid = false;
                    }
                } else if (fieldType === 'confirmPassword') {
                    const password = document.getElementById('password_usuario').value;
                    if (!value) {
                        errorMessage = 'Debes confirmar la contrase√±a';
                        isValid = false;
                    } else if (password !== value) {
                        errorMessage = 'Las contrase√±as no coinciden';
                        isValid = false;
                    }
                }
                
                if (!isValid) {
                    this.showCreateUserFieldError(input, errorMessage);
                } else if (value || (fieldType === 'foto' && input.files.length > 0)) {
                    this.showCreateUserFieldSuccess(input);
                } else {
                    this.clearCreateUserFieldError(input);
                }
            },

            clearCreateUserFieldError(input) {
                input.classList.remove('border-red-500', 'border-green-500', 'bg-red-50', 'bg-green-50');
                input.classList.add('border-gray-300');
                
                const existingError = input.parentNode.querySelector('.create-user-field-error-message');
                if (existingError) {
                    existingError.remove();
                }
            }
        };

        // ========================================
        // M√ìDULO: GESTI√ìN DEL MODAL DE NUEVA PROPIEDAD
        // ========================================
        const PropertyModalManager = {
            init() {
                this.modal = document.getElementById('modal-nueva-propiedad');
                this.btnAbrir = document.getElementById('btn-nueva-propiedad');
                this.btnCerrar = document.getElementById('cerrar-modal');
                this.btnCancelar = document.getElementById('cancelar-modal');
                this.form = document.getElementById('crearPropiedadForm');
                this.messagesContainer = document.getElementById('modal-messages');
                
                this.bindEvents();
                this.initFormHandlers();
            },

            bindEvents() {
                // Abrir modal
                this.btnAbrir.addEventListener('click', () => {
                    this.openModal();
                });
                
                // Cerrar modal
                this.btnCerrar.addEventListener('click', () => {
                    this.closeModal();
                });
                
                this.btnCancelar.addEventListener('click', () => {
                    this.closeModal();
                });
                
                // Cerrar al hacer clic fuera del modal
                this.modal.addEventListener('click', (e) => {
                    if (e.target === this.modal) {
                        this.closeModal();
                    }
                });
                
                // Cerrar con tecla Escape
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && !this.modal.classList.contains('hidden')) {
                        this.closeModal();
                    }
                });
            },

            openModal() {
                this.modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                // Recrear iconos de Lucide para el modal
                lucide.createIcons();
            },

            closeModal() {
                this.modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                this.resetForm();
            },

            resetForm() {
                this.form.reset();
                this.clearMessages();
                // Limpiar preview de fotos
                const fotosPreview = document.getElementById('fotos-preview');
                const fotosGrid = document.getElementById('fotos-grid');
                if (fotosPreview) fotosPreview.classList.add('hidden');
                if (fotosGrid) fotosGrid.innerHTML = '';
            },

            clearMessages() {
                this.messagesContainer.innerHTML = '';
                this.messagesContainer.classList.add('hidden');
            },

            initFormHandlers() {
                // Form validation
                const precioInput = document.getElementById('{{ form.precio.id_for_label|safe|escapejs }}');
                const metrosInput = document.getElementById('{{ form.metros_cuadrados.id_for_label|safe|escapejs }}');
                
                // Formato de precio - DESHABILITADO para permitir formato argentino
                // if (precioInput) {
                //     precioInput.addEventListener('input', function(e) {
                //         let value = e.target.value.replace(/[^\d.]/g, '');
                //         if (value && !isNaN(value)) {
                //             value = parseFloat(value).toFixed(2);
                //             e.target.value = value;
                //         }
                //     });
                // }
                // Validaci√≥n antes de enviar (solo para nueva propiedad)
                if (this.form.id === 'crearPropiedadForm') {
                    this.form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.handleFormSubmit();
                    });
                    
                    // Validaci√≥n en tiempo real para todos los campos
                    this.initPropertyRealTimeValidation();
                }
                
                // Preview de imagen principal
                const imagenPrincipalInput = document.getElementById('{{ form.imagen_principal.id_for_label|safe|escapejs }}');
                if (imagenPrincipalInput) {
                    imagenPrincipalInput.addEventListener('change', (e) => {
                        this.validateImageFile(e.target, 'imagen principal');
                    });
                }
                
                // Preview de imagen secundaria
                const imagenSecundariaInput = document.getElementById('{{ form.imagen_secundaria.id_for_label|safe|escapejs }}');
                if (imagenSecundariaInput) {
                    imagenSecundariaInput.addEventListener('change', (e) => {
                        this.validateImageFile(e.target, 'imagen secundaria');
                    });
                }
                
                // Sistema de m√∫ltiples fotos adicionales
                this.initPhotoUpload();
            },

            initPhotoUpload() {
                const fotosInput = document.getElementById('fotosInput');
                const uploadArea = document.getElementById('uploadArea');
                let fotosSeleccionadas = [];
                
                if (!fotosInput || !uploadArea) return;
                
                // Evento para seleccionar archivos
                fotosInput.addEventListener('change', (e) => {
                    this.handleFiles(e.target.files, fotosSeleccionadas);
                });
                
                // Drag and Drop
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });
                
                uploadArea.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                });
                
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    this.handleFiles(files, fotosSeleccionadas);
                });
                
                // Hacer fotosSeleccionadas accesible globalmente
                window.fotosSeleccionadas = fotosSeleccionadas;
            },

            handleFiles(files, fotosSeleccionadas) {
                const validFiles = Array.from(files).filter(file => {
                    // Validar tipo de archivo (imagen o video)
                    const isImage = file.type.startsWith('image/');
                    const isVideo = file.type.startsWith('video/');
                    const validVideoTypes = ['video/mp4', 'video/avi', 'video/quicktime', 'video/x-msvideo'];
                    
                    if (!isImage && !isVideo) {
                        alert(`El archivo ${file.name} no es una imagen o video v√°lido.`);
                        return false;
                    }
                    
                    if (isVideo && !validVideoTypes.includes(file.type)) {
                        alert(`El formato de video ${file.name} no es compatible. Use MP4, AVI o MOV.`);
                        return false;
                    }
                    
                    // Validar tama√±o (200MB para videos, 20MB para im√°genes)
                    const maxSize = isVideo ? 200 * 1024 * 1024 : 20 * 1024 * 1024;
                    if (file.size > maxSize) {
                        const maxSizeMB = isVideo ? 200 : 20;
                        alert(`El archivo ${file.name} excede el tama√±o m√°ximo de ${maxSizeMB}MB.`);
                        return false;
                    }
                    
                    // Validar cantidad m√°xima
                    if (fotosSeleccionadas.length >= 10) {
                        alert('Puedes seleccionar m√°ximo 10 archivos adicionales.');
                        return false;
                    }
                    
                    return true;
                });
                
                // Agregar archivos v√°lidos
                fotosSeleccionadas.push(...validFiles);
                this.showFotosPreview(fotosSeleccionadas);
            },

            showFotosPreview(fotosSeleccionadas) {
                const previewDiv = document.getElementById('fotos-preview');
                const gridDiv = document.getElementById('fotos-grid');
                
                if (fotosSeleccionadas.length === 0) {
                    previewDiv.classList.add('hidden');
                    return;
                }
                
                previewDiv.classList.remove('hidden');
                gridDiv.innerHTML = '';
                
                fotosSeleccionadas.forEach((file, index) => {
                    const isVideo = file.type.startsWith('video/');
                    const col = document.createElement('div');
                    col.className = 'col-span-1';
                    
                    if (isVideo) {
                        // Preview de video
                        const videoURL = URL.createObjectURL(file);
                        col.innerHTML = 
                            '<div class="foto-preview-item">' +
                                '<button type="button" class="foto-preview-remove" onclick="PropertyModalManager.removeFotoPreview(' + index + ')">' +
                                    '<i data-lucide="x" class="w-3 h-3"></i>' +
                                '</button>' +
                                '<div style="position: relative; height: 128px; background: #000; display: flex; align-items: center; justify-content: center; border-radius: 8px 8px 0 0;">' +
                                    '<video src="' + videoURL + '" style="max-width: 100%; max-height: 128px;" controls></video>' +
                                '</div>' +
                                '<div class="foto-preview-info">' +
                                    '<small class="text-gray-600"><i data-lucide="video" class="w-3 h-3 inline mr-1"></i>' + file.name + '</small>' +
                                    '<small class="text-gray-500 block">' + (file.size / 1024 / 1024).toFixed(2) + ' MB</small>' +
                                '</div>' +
                            '</div>';
                        gridDiv.appendChild(col);
                        lucide.createIcons();
                    } else {
                        // Preview de imagen
                        const reader = new FileReader();
                        
                        reader.onload = (e) => {
                            col.innerHTML = 
                                '<div class="foto-preview-item">' +
                                    '<button type="button" class="foto-preview-remove" onclick="PropertyModalManager.removeFotoPreview(' + index + ')">' +
                                        '<i data-lucide="x" class="w-3 h-3"></i>' +
                                    '</button>' +
                                    '<img src="' + e.target.result + '" alt="Preview ' + (index + 1) + '" class="w-full h-32 object-cover rounded">' +
                                    '<div class="foto-preview-info">' +
                                        '<small class="text-gray-600"><i data-lucide="image" class="w-3 h-3 inline mr-1"></i>' + file.name + '</small>' +
                                        '<small class="text-gray-500 block">' + (file.size / 1024 / 1024).toFixed(2) + ' MB</small>' +
                                    '</div>' +
                                '</div>';
                            gridDiv.appendChild(col);
                            // Recrear iconos de Lucide
                            lucide.createIcons();
                        };
                        
                        reader.readAsDataURL(file);
                    }
                });
            },

            removeFotoPreview(index) {
                if (window.fotosSeleccionadas) {
                    window.fotosSeleccionadas.splice(index, 1);
                    this.showFotosPreview(window.fotosSeleccionadas);
                }
            },

            validateImageFile(input, fieldName) {
                const file = input.files[0];
                if (file) {
                    if (!file.type.startsWith('image/')) {
                        alert(`Por favor selecciona solo archivos de imagen para la ${fieldName}.`);
                        input.value = '';
                        return false;
                    }
                    
                    if (file.size > 20 * 1024 * 1024) { // 20MB
                        alert(`La ${fieldName} debe ser menor a 20MB.`);
                        input.value = '';
                        return false;
                    }
                }
                return true;
            },

            async handleFormSubmit() {
                // Validar campos antes de enviar
                if (!this.validatePropertyForm()) {
                    return;
                }
                
                // üî• MOSTRAR INDICADOR DE PROGRESO
                this.showLoadingIndicator();
                
                const formData = new FormData(this.form);
                
                // Agregar las fotos adicionales al FormData
                if (window.fotosSeleccionadas) {
                    window.fotosSeleccionadas.forEach((file) => {
                        formData.append('fotos_adicionales', file);
                    });
                }
                
                try {
                    const response = await fetch(this.form.action, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    });
                    
                    console.log('Respuesta del servidor:', response.status, response.statusText);
                    console.log('Content-Type:', response.headers.get('content-type'));
                    
                    if (response.ok) {
                        // Verificar si la respuesta es JSON
                        const contentType = response.headers.get('content-type');
                        if (contentType && contentType.includes('application/json')) {
                            const result = await response.json();
                            console.log('Resultado JSON:', result);
                            
                            if (result.success) {
                                mostrarMensaje('¬°Propiedad creada exitosamente!', 'success');
                                
                                // Agregar actividad
                                const titulo = formData.get('titulo') || 'Nueva propiedad';
                                ActivitiesManager.addActivity(
                                    'property', 
                                    'Propiedad creada', 
                                    `"${titulo}" agregada al cat√°logo`, 
                                    'home', 
                                    'green'
                                );
                                
                                setTimeout(() => {
                                    this.closeModal();
                                    // Recargar la p√°gina para actualizar las estad√≠sticas
                                    window.location.reload();
                                }, 2000);
                            } else {
                                // Mostrar errores espec√≠ficos del formulario
                                if (result.errors) {
                                    let errorMessage = result.message || 'Por favor corrige los siguientes errores:';
                                    for (const [field, errors] of Object.entries(result.errors)) {
                                        errorMessage += `\n- ${field}: ${errors.join(', ')}`;
                                    }
                                    mostrarMensaje(errorMessage, 'danger');
                                } else {
                                    mostrarMensaje(result.message || 'Error al crear la propiedad', 'danger');
                                }
                            }
                        } else {
                            // Si no es JSON, mostrar el contenido de la respuesta para debug
                            const text = await response.text();
                            console.error('Respuesta no es JSON:', text.substring(0, 200));
                            mostrarMensaje('Error del servidor: La respuesta no es v√°lida. Por favor intenta de nuevo.', 'danger');
                        }
                    } else {
                        // Manejar errores HTTP
                        const text = await response.text();
                        console.error('Error HTTP:', response.status, text.substring(0, 200));
                        mostrarMensaje(`Error del servidor (${response.status}). Por favor intenta de nuevo.`, 'danger');
                    }
                } catch (error) {
                    console.error('Error en la petici√≥n:', error);
                    if (error.name === 'SyntaxError' && error.message.includes('JSON')) {
                        mostrarMensaje('Error: El servidor devolvi√≥ una respuesta no v√°lida. Por favor verifica que el servidor est√© funcionando correctamente.', 'danger');
                    } else {
                        mostrarMensaje('Error de conexi√≥n. Por favor verifica tu conexi√≥n a internet e intenta de nuevo.', 'danger');
                    }
                } finally {
                    // üî• OCULTAR INDICADOR DE PROGRESO
                    this.hideLoadingIndicator();
                }
            },

            // üî• INDICADOR DE PROGRESO PARA ARCHIVOS GRANDES
            showLoadingIndicator() {
                // Deshabilitar bot√≥n de env√≠o
                const submitBtn = this.form.querySelector('button[type="submit"]');
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = `
                        <div class="flex items-center justify-center">
                            <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                            Subiendo archivos...
                        </div>
                    `;
                }

                // Mostrar mensaje de progreso
                this.showProgressMessage('Subiendo archivos, por favor espera...', 'info');
            },

            hideLoadingIndicator() {
                // Rehabilitar bot√≥n de env√≠o
                const submitBtn = this.form.querySelector('button[type="submit"]');
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = `
                        <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                        Crear Propiedad
                    `;
                }

                // Ocultar mensaje de progreso
                this.hideProgressMessage();
            },

            showProgressMessage(message, type = 'info') {
                const messagesContainer = document.getElementById('modal-messages');
                if (messagesContainer) {
                    messagesContainer.innerHTML = `
                        <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                            <div class="flex items-center">
                                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"></div>
                                <span>${message}</span>
                            </div>
                        </div>
                    `;
                    messagesContainer.classList.remove('hidden');
                }
            },

            hideProgressMessage() {
                const messagesContainer = document.getElementById('modal-messages');
                if (messagesContainer) {
                    messagesContainer.classList.add('hidden');
                }
            },

            // ========================================
            // VALIDACIONES DEL FORMULARIO DE PROPIEDAD
            // ========================================
            
            validatePropertyForm() {
                console.log('=== VALIDANDO FORMULARIO DE PROPIEDAD ===');
                let isValid = true;
                
                // Limpiar errores previos
                this.clearPropertyValidationErrors();
                
                // Validar cada campo
                const campos = [
                    { id: 'id_titulo', type: 'titulo', required: true },
                    { id: 'id_descripcion', type: 'descripcion', required: true },
                    { id: 'id_precio', type: 'precio', required: true },
                    { id: 'id_tipo', type: 'select', required: true },
                    { id: 'id_operacion', type: 'select', required: true },
                    { id: 'id_estado', type: 'select', required: true },
                    { id: 'id_ubicacion', type: 'ubicacion', required: true },
                    { id: 'id_ciudad', type: 'ciudad', required: true },
                    { id: 'id_lugares_cercanos', type: 'lugares_cercanos', required: true },
                    { id: 'id_metros_cuadrados', type: 'metros', required: true },
                    { id: 'id_habitaciones', type: 'habitaciones', required: true },
                    { id: 'id_banos', type: 'banos', required: true },
                    { id: 'id_ambientes', type: 'ambientes', required: true },
                    { id: 'id_balcon', type: 'balcon', required: false },
                    { id: 'id_imagen_principal', type: 'imagen', required: true },
                    { id: 'id_imagen_secundaria', type: 'imagen', required: false },
                    { id: 'id_latitud', type: 'latitud', required: false },
                    { id: 'id_longitud', type: 'longitud', required: false }
                ];
                
                campos.forEach(campo => {
                    const input = document.getElementById(campo.id);
                    if (input) {
                        if (!this.validatePropertySingleField(input, campo.type, campo.required)) {
                            isValid = false;
                        }
                    }
                });
                
                console.log('Formulario v√°lido:', isValid);
                return isValid;
            },

            validatePropertySingleField(input, fieldType, required = true) {
                const value = input.value.trim();
                const fieldName = input.name || input.id;
                
                console.log(`Validando ${fieldName}:`, value, 'Tipo:', fieldType);
                
                // Verificar si es requerido y est√° vac√≠o
                if (required && !value) {
                    this.showPropertyFieldError(input, `${this.getFieldLabel(fieldName)} es obligatorio.`);
                    return false;
                }
                
                // Si no es requerido y est√° vac√≠o, es v√°lido
                if (!required && !value) {
                    this.showPropertyFieldSuccess(input);
                    return true;
                }
                
                // Validaciones espec√≠ficas por tipo
                switch (fieldType) {
                    case 'titulo':
                        if (value.length < 5) {
                            this.showPropertyFieldError(input, 'El t√≠tulo debe tener al menos 5 caracteres.');
                            return false;
                        } else if (value.length > 100) {
                            this.showPropertyFieldError(input, 'El t√≠tulo no puede tener m√°s de 100 caracteres.');
                            return false;
                        }
                        break;
                        
                    case 'descripcion':
                        if (value.length < 10) {
                            this.showPropertyFieldError(input, 'La descripci√≥n debe tener al menos 10 caracteres.');
                            return false;
                        } else if (value.length > 1000) {
                            this.showPropertyFieldError(input, 'La descripci√≥n no puede tener m√°s de 1000 caracteres.');
                            return false;
                        }
                        break;
                        
                    case 'precio':
                        const precio = parseFloat(value);
                        if (isNaN(precio) || precio <= 0) {
                            this.showPropertyFieldError(input, 'El precio debe ser mayor a 0.');
                            return false;
                        } else if (precio > 999999999) {
                            this.showPropertyFieldError(input, 'El precio no puede ser mayor a 999,999,999.');
                            return false;
                        }
                        break;
                        
                    case 'ubicacion':
                        if (value.length < 5) {
                            this.showPropertyFieldError(input, 'La ubicaci√≥n debe tener al menos 5 caracteres.');
                            return false;
                        } else if (value.length > 200) {
                            this.showPropertyFieldError(input, 'La ubicaci√≥n no puede tener m√°s de 200 caracteres.');
                            return false;
                        }
                        break;
                        
                    case 'ciudad':
                        if (value.length < 2) {
                            this.showPropertyFieldError(input, 'La ciudad debe tener al menos 2 caracteres.');
                            return false;
                        } else if (value.length > 100) {
                            this.showPropertyFieldError(input, 'La ciudad no puede tener m√°s de 100 caracteres.');
                            return false;
                        }
                        break;
                        
                    case 'lugares_cercanos':
                        if (value.length < 10) {
                            this.showPropertyFieldError(input, 'Los lugares cercanos deben tener al menos 10 caracteres.');
                            return false;
                        } else if (value.length > 500) {
                            this.showPropertyFieldError(input, 'Los lugares cercanos no pueden tener m√°s de 500 caracteres.');
                            return false;
                        }
                        break;
                        
                    case 'metros':
                        const metros = parseInt(value);
                        if (isNaN(metros) || metros <= 0) {
                            this.showPropertyFieldError(input, 'Los metros cuadrados deben ser mayor a 0.');
                            return false;
                        } else if (metros > 10000) {
                            this.showPropertyFieldError(input, 'Los metros cuadrados no pueden ser mayor a 10,000.');
                            return false;
                        }
                        break;
                        
                    case 'habitaciones':
                        const habitaciones = parseInt(value);
                        if (isNaN(habitaciones) || habitaciones < 0) {
                            this.showPropertyFieldError(input, 'Las habitaciones no pueden ser negativas.');
                            return false;
                        } else if (habitaciones > 20) {
                            this.showPropertyFieldError(input, 'Las habitaciones no pueden ser mayor a 20.');
                            return false;
                        }
                        break;
                        
                    case 'banos':
                        const banos = parseInt(value);
                        if (isNaN(banos) || banos < 0) {
                            this.showPropertyFieldError(input, 'Los ba√±os no pueden ser negativos.');
                            return false;
                        } else if (banos > 10) {
                            this.showPropertyFieldError(input, 'Los ba√±os no pueden ser mayor a 10.');
                            return false;
                        }
                        break;
                        
                    case 'ambientes':
                        const ambientes = parseInt(value);
                        if (isNaN(ambientes) || ambientes < 0) {
                            this.showPropertyFieldError(input, 'Los ambientes no pueden ser negativos.');
                            return false;
                        } else if (ambientes > 30) {
                            this.showPropertyFieldError(input, 'Los ambientes no pueden ser mayor a 30.');
                            return false;
                        }
                        break;
                        
                    case 'balcon':
                        // El campo balc√≥n es opcional, no requiere validaci√≥n especial
                        break;
                        
                    case 'imagen':
                        if (input.files && input.files.length > 0) {
                            const file = input.files[0];
                            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                            
                            if (!allowedTypes.includes(file.type)) {
                                this.showPropertyFieldError(input, 'Solo se permiten archivos de imagen (JPEG, PNG, GIF, WebP).');
                                return false;
                            }
                            
                            if (file.size > 20 * 1024 * 1024) {
                                this.showPropertyFieldError(input, 'La imagen debe ser menor a 20MB.');
                                return false;
                            }
                        }
                        break;
                        
                    case 'latitud':
                        const latitud = parseFloat(value);
                        if (isNaN(latitud) || latitud < -90 || latitud > 90) {
                            this.showPropertyFieldError(input, 'La latitud debe estar entre -90 y 90 grados.');
                            return false;
                        }
                        break;
                        
                    case 'longitud':
                        const longitud = parseFloat(value);
                        if (isNaN(longitud) || longitud < -180 || longitud > 180) {
                            this.showPropertyFieldError(input, 'La longitud debe estar entre -180 y 180 grados.');
                            return false;
                        }
                        break;
                }
                
                this.showPropertyFieldSuccess(input);
                return true;
            },

            clearPropertyValidationErrors() {
                // Limpiar errores de todos los campos
                const errorElements = this.form.querySelectorAll('.field-error');
                errorElements.forEach(element => element.remove());
                
                // Limpiar estilos de error
                const inputs = this.form.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    input.classList.remove('border-red-500', 'bg-red-50');
                    input.classList.add('border-gray-300');
                });
            },

            showPropertyFieldError(input, message) {
                // Remover mensaje de error previo
                const existingError = input.parentNode.querySelector('.field-error');
                if (existingError) {
                    existingError.remove();
                }
                
                // Aplicar estilos de error
                input.classList.remove('border-gray-300', 'bg-white');
                input.classList.add('border-red-500', 'bg-red-50');
                
                // Crear mensaje de error
                const errorDiv = document.createElement('div');
                errorDiv.className = 'field-error text-red-600 text-sm mt-1';
                errorDiv.textContent = message;
                
                // Insertar despu√©s del input
                input.parentNode.insertBefore(errorDiv, input.nextSibling);
            },

            showPropertyFieldSuccess(input) {
                // Remover mensaje de error
                const existingError = input.parentNode.querySelector('.field-error');
                if (existingError) {
                    existingError.remove();
                }
                
                // Aplicar estilos de √©xito
                input.classList.remove('border-red-500', 'bg-red-50');
                input.classList.add('border-green-500', 'bg-green-50');
                
                // Remover estilos de √©xito despu√©s de 2 segundos
                setTimeout(() => {
                    input.classList.remove('border-green-500', 'bg-green-50');
                    input.classList.add('border-gray-300', 'bg-white');
                }, 2000);
            },

            getFieldLabel(fieldName) {
                const labels = {
                    'titulo': 'T√≠tulo',
                    'descripcion': 'Descripci√≥n',
                    'precio': 'Precio',
                    'tipo': 'Tipo',
                    'operacion': 'Operaci√≥n',
                    'estado': 'Estado',
                    'ubicacion': 'Ubicaci√≥n',
                    'metros_cuadrados': 'Metros cuadrados',
                    'habitaciones': 'Habitaciones',
                    'banos': 'Ba√±os',
                    'imagen_principal': 'Imagen principal',
                    'imagen_secundaria': 'Imagen secundaria',
                    'latitud': 'Latitud',
                    'longitud': 'Longitud'
                };
                return labels[fieldName] || fieldName;
            },

            initPropertyRealTimeValidation() {
                console.log('Inicializando validaci√≥n en tiempo real para formulario de propiedad');
                
                // Campos de texto y n√∫mero
                const textFields = [
                    { id: 'id_titulo', type: 'titulo', required: true },
                    { id: 'id_descripcion', type: 'descripcion', required: true },
                    { id: 'id_precio', type: 'precio', required: true },
                    { id: 'id_ubicacion', type: 'ubicacion', required: true },
                    { id: 'id_ciudad', type: 'ciudad', required: true },
                    { id: 'id_lugares_cercanos', type: 'lugares_cercanos', required: true },
                    { id: 'id_metros_cuadrados', type: 'metros', required: true },
                    { id: 'id_habitaciones', type: 'habitaciones', required: true },
                    { id: 'id_banos', type: 'banos', required: true },
                    { id: 'id_latitud', type: 'latitud', required: false },
                    { id: 'id_longitud', type: 'longitud', required: false }
                ];
                
                textFields.forEach(field => {
                    const input = document.getElementById(field.id);
                    if (input) {
                        input.addEventListener('blur', () => {
                            this.validatePropertySingleField(input, field.type, field.required);
                        });
                        
                        input.addEventListener('input', () => {
                            if (input.classList.contains('border-red-500')) {
                                this.clearPropertyFieldError(input);
                            }
                        });
                    }
                });
                
                // Campos de archivo
                const fileFields = [
                    { id: 'id_imagen_principal', type: 'imagen', required: true },
                    { id: 'id_imagen_secundaria', type: 'imagen', required: false }
                ];
                
                fileFields.forEach(field => {
                    const input = document.getElementById(field.id);
                    if (input) {
                        input.addEventListener('change', () => {
                            this.validatePropertySingleField(input, field.type, field.required);
                        });
                    }
                });
                
                // Campos select
                const selectFields = [
                    { id: 'id_tipo', type: 'select', required: true },
                    { id: 'id_operacion', type: 'select', required: true },
                    { id: 'id_estado', type: 'select', required: true }
                ];
                
                selectFields.forEach(field => {
                    const input = document.getElementById(field.id);
                    if (input) {
                        input.addEventListener('change', () => {
                            this.validatePropertySingleField(input, field.type, field.required);
                        });
                    }
                });
            },

            clearPropertyFieldError(input) {
                const existingError = input.parentNode.querySelector('.field-error');
                if (existingError) {
                    existingError.remove();
                }
                input.classList.remove('border-red-500', 'bg-red-50');
                input.classList.add('border-gray-300', 'bg-white');
            }
        };

        // ========================================
        // M√ìDULO: ANIMACIONES Y CONTADORES
        // ========================================
        const AnimationManager = {
            init() {
                this.animateCounters();
                this.updateDate();
            },

            animateCounters() {
                const counters = document.querySelectorAll('[id^="total"]');
                
                counters.forEach(counter => {
                    // Usar data-count si est√° disponible, sino usar textContent
                    const target = parseInt(counter.getAttribute('data-count') || counter.textContent) || 0;
                    if (target > 0) {
                        counter.textContent = '0';
                        Utils.animateCounter(counter, target);
                    }
                });
            },

            updateDate() {
                const currentDate = new Date();
                
                // Diferentes formatos seg√∫n el tama√±o de pantalla
                const optionsFull = { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    weekday: 'long'
                };
                const optionsMedium = { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric'
                };
                const optionsShort = { 
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                };
                const optionsMinimal = { 
                    day: 'numeric',
                    month: 'short'
                };
                
                // Obtener todos los elementos
                const currentDateFullElement = document.getElementById('currentDateFull');
                const currentDateMediumElement = document.getElementById('currentDateMedium');
                const currentDateShortElement = document.getElementById('currentDateShort');
                const currentDateMinimalElement = document.getElementById('currentDateMinimal');
                
                console.log('Actualizando fecha...', { 
                    currentDateFullElement, 
                    currentDateMediumElement, 
                    currentDateShortElement, 
                    currentDateMinimalElement 
                });
                
                // Funci√≥n para formatear fecha directamente
                const formatDate = (date, options) => {
                    try {
                        return date.toLocaleDateString('es-ES', options);
                    } catch (error) {
                        console.error('Error formateando fecha:', error);
                        return date.toLocaleDateString();
                    }
                };
                
                // Actualizar fecha completa (XL+)
                if (currentDateFullElement) {
                    const formattedDate = formatDate(currentDate, optionsFull);
                    currentDateFullElement.textContent = formattedDate;
                    console.log('Fecha completa actualizada:', formattedDate);
                } else {
                    console.log('Elemento currentDateFull no encontrado');
                }
                
                // Actualizar fecha media (LG)
                if (currentDateMediumElement) {
                    const formattedDate = formatDate(currentDate, optionsMedium);
                    currentDateMediumElement.textContent = formattedDate;
                    console.log('Fecha media actualizada:', formattedDate);
                } else {
                    console.log('Elemento currentDateMedium no encontrado');
                }
                
                // Actualizar fecha corta (MD)
                if (currentDateShortElement) {
                    const formattedDate = formatDate(currentDate, optionsShort);
                    currentDateShortElement.textContent = formattedDate;
                    console.log('Fecha corta actualizada:', formattedDate);
                } else {
                    console.log('Elemento currentDateShort no encontrado');
                }
                
                // Actualizar fecha m√≠nima (SM y menor)
                if (currentDateMinimalElement) {
                    const formattedDate = formatDate(currentDate, optionsMinimal);
                    currentDateMinimalElement.textContent = formattedDate;
                    console.log('Fecha m√≠nima actualizada:', formattedDate);
                } else {
                    console.log('Elemento currentDateMinimal no encontrado');
                }
            }
        };

        // ========================================
        // FUNCIONES GLOBALES PARA GESTI√ìN DE PROPIEDADES
        // ========================================
        let propiedadAEliminar = null;

        // ========================================
        // FUNCIONES GLOBALES PARA GESTI√ìN DE USUARIOS
        // ========================================

        // ========================================
        // FUNCIONES GLOBALES PARA CAMBIO DE CONTRASE√ëA
        // ========================================
        let smsTimer = null;
        let smsCodeSent = false;
        let smsVerified = false;

        // Funci√≥n para alternar visibilidad de contrase√±a
        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            const button = input.nextElementSibling;
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.setAttribute('data-lucide', 'eye-off');
            } else {
                input.type = 'password';
                icon.setAttribute('data-lucide', 'eye');
            }
            lucide.createIcons();
        }

        // Funci√≥n para mostrar mensajes de cambio de contrase√±a
        function mostrarMensajePassword(mensaje, tipo) {
            const messagesContainer = document.getElementById('password-messages');
            const bgColor = tipo === 'success' ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800';
            const iconColor = tipo === 'success' ? 'text-green-600' : 'text-red-600';
            const icon = tipo === 'success' ? 'check-circle' : 'alert-circle';
            
            messagesContainer.innerHTML = 
                '<div class="border rounded-lg p-4 ' + bgColor + ' flex items-start">' +
                    '<i data-lucide="' + icon + '" class="w-5 h-5 ' + iconColor + ' mr-3 mt-0.5"></i>' +
                    '<div class="flex-1">' +
                        '<p class="text-sm font-medium">' + mensaje + '</p>' +
                    '</div>' +
                    '<button type="button" onclick="this.parentElement.parentElement.remove()" class="ml-3 text-gray-400 hover:text-gray-600">' +
                        '<i data-lucide="x" class="w-4 h-4"></i>' +
                    '</button>' +
                '</div>';
            messagesContainer.classList.remove('hidden');
            lucide.createIcons();
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (messagesContainer.innerHTML) {
                    messagesContainer.innerHTML = '';
                    messagesContainer.classList.add('hidden');
                }
            }, 5000);
        }

        // Funci√≥n para iniciar timer de SMS
        function iniciarTimerSMS() {
            let tiempo = 300; // 5 minutos en segundos
            const timerElement = document.getElementById('sms-timer');
            
            smsTimer = setInterval(() => {
                const minutos = Math.floor(tiempo / 60);
                const segundos = tiempo % 60;
                timerElement.textContent = `${minutos}:${segundos.toString().padStart(2, '0')}`;
                
                if (tiempo <= 0) {
                    clearInterval(smsTimer);
                    timerElement.textContent = '0:00';
                    mostrarMensajePassword('El c√≥digo SMS ha expirado. Solicita uno nuevo.', 'danger');
                    smsCodeSent = false;
                    smsVerified = false;
                    document.getElementById('sms-verification-section').classList.add('hidden');
                }
                tiempo--;
            }, 1000);
        }

        // Funci√≥n para enviar c√≥digo SMS
        async function enviarCodigoSMS() {
            try {
                const response = await fetch('/login/enviar-codigo-sms/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'X-Requested-With': 'XMLHttpRequest',
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensajePassword('C√≥digo SMS enviado exitosamente.', 'success');
                    smsCodeSent = true;
                    document.getElementById('sms-verification-section').classList.remove('hidden');
                    iniciarTimerSMS();
                } else {
                    mostrarMensajePassword(result.message || 'Error al enviar el c√≥digo SMS.', 'danger');
                }
            } catch (error) {
                console.error('Error:', error);
                mostrarMensajePassword('Error al enviar el c√≥digo SMS.', 'danger');
            }
        }

        // Funci√≥n para verificar c√≥digo SMS
        async function verificarCodigoSMS() {
            const codigo = document.getElementById('codigo_sms').value;
            
            if (!codigo || codigo.length !== 6) {
                mostrarMensajePassword('Por favor ingresa un c√≥digo de 6 d√≠gitos.', 'danger');
                return;
            }
            
            try {
                const response = await fetch('/login/verificar-codigo-sms/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'X-Requested-With': 'XMLHttpRequest',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ codigo: codigo })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensajePassword('C√≥digo verificado exitosamente. Ahora puedes cambiar tu contrase√±a.', 'success');
                    smsVerified = true;
                    document.getElementById('btn-cambiar-password').disabled = false;
                    clearInterval(smsTimer);
                    document.getElementById('sms-timer').textContent = 'Verificado';
                } else {
                    mostrarMensajePassword(result.message || 'C√≥digo incorrecto.', 'danger');
                }
            } catch (error) {
                console.error('Error:', error);
                mostrarMensajePassword('Error al verificar el c√≥digo.', 'danger');
            }
        }

        // Funci√≥n para confirmar eliminaci√≥n
        function confirmarEliminar(propiedadId, titulo) {
            propiedadAEliminar = propiedadId;
            document.getElementById('propiedad-titulo-eliminar').textContent = titulo;
            
            const modal = document.getElementById('modal-eliminar-propiedad');
            modal.classList.remove('hidden');
            
            // Recrear iconos
            lucide.createIcons();
        }

        // Funci√≥n para eliminar propiedad
        async function eliminarPropiedad(propiedadId) {
            try {
                const response = await fetch(`/login/eliminar-propiedad-ajax/${propiedadId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Obtener el t√≠tulo de la propiedad antes de eliminarla
                    const row = document.querySelector(`tr[data-propiedad-id="${propiedadId}"]`);
                    const titulo = row ? row.querySelector('td:first-child').textContent.trim() : 'Propiedad';
                    
                    // Remover fila de la tabla
                    if (row) {
                        row.remove();
                    }
                    
                    // Agregar actividad
                    ActivitiesManager.addActivity(
                        'property', 
                        'Propiedad eliminada', 
                        `"${titulo}" removida del cat√°logo`, 
                        'trash-2', 
                        'red'
                    );
                    
                    // Mostrar mensaje de √©xito
                    mostrarMensaje(data.message, 'success');
                    
                    // Cerrar modal
                    const modal = document.getElementById('modal-eliminar-propiedad');
                    modal.classList.add('hidden');
                    
                    // Actualizar contador
                    actualizarContadorPropiedades();
                } else {
                    mostrarMensaje(data.message, 'danger');
                }
            } catch (error) {
                console.error('Error:', error);
                mostrarMensaje('Error al eliminar la propiedad', 'danger');
            }
        }

        // Funci√≥n para eliminar usuario
        async function eliminarUsuario(usuarioId) {
            console.log('Intentando eliminar usuario con ID:', usuarioId);
            try {
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                console.log('CSRF Token:', csrfToken);
                
                const response = await fetch(`/login/eliminar-usuario-admin/${usuarioId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrfToken,
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                
                console.log('Respuesta del servidor:', response.status);
                
                const data = await response.json();
                
                if (data.success) {
                    // Agregar actividad
                    ActivitiesManager.addActivity(
                        'user', 
                        'Usuario eliminado', 
                        'Usuario administrativo removido del sistema', 
                        'user-minus', 
                        'red'
                    );
                    
                    // Mostrar mensaje de √©xito
                    mostrarMensaje(data.message, 'success');
                    
                    // Cerrar modal
                    const modal = document.getElementById('modal-eliminar-usuario');
                    modal.classList.add('hidden');
                    
                    // Recargar la lista de usuarios
                    if (UsuarioModalManager && UsuarioModalManager.cargarUsuarios) {
                        UsuarioModalManager.cargarUsuarios();
                    }
                } else {
                    mostrarMensaje(data.message, 'danger');
                }
            } catch (error) {
                console.error('Error:', error);
                mostrarMensaje('Error al eliminar el usuario', 'danger');
            }
        }

        // Funci√≥n para mostrar mensajes
        function mostrarMensaje(mensaje, tipo) {
            const alertDiv = document.createElement('div');
            const bgColor = tipo === 'success' ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800';
            const iconColor = tipo === 'success' ? 'text-green-600' : 'text-red-600';
            const icon = tipo === 'success' ? 'check-circle' : 'alert-circle';
            
            alertDiv.className = `border rounded-lg p-4 ${bgColor} flex items-start mb-4`;
            alertDiv.innerHTML = `
                <i data-lucide="${icon}" class="w-5 h-5 ${iconColor} mr-3 mt-0.5"></i>
                <div class="flex-1">
                    <p class="text-sm font-medium">${mensaje}</p>
                </div>
                <button type="button" onclick="this.parentElement.remove()" class="ml-3 text-gray-400 hover:text-gray-600">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            `;
            
            const container = document.querySelector('.flex-1.overflow-y-auto');
            container.insertBefore(alertDiv, container.firstChild);
            
            // Recrear iconos
            lucide.createIcons();
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // Funci√≥n para actualizar contador de propiedades
        function actualizarContadorPropiedades() {
            const filasVisibles = document.querySelectorAll('#propertiesTableBody tr:not([style*="display: none"])').length;
            const contador = document.getElementById('propiedades-count');
            if (contador) {
                contador.textContent = filasVisibles;
            }
        }

        // Funci√≥n para actualizar contador de usuarios
        function actualizarContadorUsuarios() {
            const contador = document.getElementById('totalUsers');
            if (contador) {
                // Forzar recarga del contador desde el servidor
                fetch('/login/contar-usuarios-admin/', {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const nuevoTotal = data.staff_users_count;
                        contador.setAttribute('data-count', nuevoTotal);
                        contador.textContent = nuevoTotal;
                    }
                })
                .catch(error => {
                    console.error('Error actualizando contador de usuarios:', error);
                });
            }
        }

        // Funci√≥n para generar cards m√≥viles
        function generateMobileCards() {
            const table = document.getElementById('propertiesTable');
            const tbody = table.getElementsByTagName('tbody')[0];
            const rows = tbody.getElementsByTagName('tr');
            const cardsContainer = document.getElementById('propertiesCardsMobile');
            
            if (!cardsContainer) return;
            
            cardsContainer.innerHTML = '';
            
            for (let row of rows) {
                if (row.style.display === 'none') continue;
                
                const propiedadId = row.getAttribute('data-propiedad-id');
                if (!propiedadId) continue;
                
                // Extraer datos de la fila
                const imagenCell = row.querySelector('td:nth-child(1)');
                const tituloCell = row.querySelector('td:nth-child(2)');
                const tipoCell = row.querySelector('td:nth-child(3)');
                const precioCell = row.querySelector('td:nth-child(4)');
                const estadoCell = row.querySelector('td:nth-child(5)');
                const ubicacionCell = row.querySelector('td:nth-child(6)');
                const fechaCell = row.querySelector('td:nth-child(7)');
                const accionesCell = row.querySelector('td:nth-child(8)');
                
                // Extraer informaci√≥n
                const imagen = imagenCell.querySelector('img');
                const titulo = tituloCell.querySelector('.text-sm.font-medium').textContent;
                const metros = tituloCell.querySelector('.text-sm.text-gray-500').textContent;
                const precio = precioCell.textContent;
                const estado = estadoCell.querySelector('span').textContent;
                const estadoClass = estadoCell.querySelector('span').classList.contains('bg-green-100') ? 'disponible' : 
                                  estadoCell.querySelector('span').classList.contains('bg-red-100') ? 'vendida' : 'reservada';
                const ubicacion = ubicacionCell.textContent;
                const fecha = fechaCell.textContent;
                
                // Extraer enlaces de acciones
                const verLink = accionesCell.querySelector('a[href*="detalle"]');
                const editarLink = accionesCell.querySelector('a[href*="editar"]');
                const eliminarBtn = accionesCell.querySelector('button[onclick*="confirmarEliminar"]');
                
                // Crear card
                const card = document.createElement('div');
                card.className = 'propiedad-card';
                card.setAttribute('data-propiedad-id', propiedadId);
                
                card.innerHTML = `
                    <div class="propiedad-card-header">
                        ${imagen ? 
                            `<img src="${imagen.src}" alt="${titulo}" class="propiedad-card-imagen">` :
                            `<div class="propiedad-card-imagen-placeholder">
                                <i data-lucide="home" class="w-6 h-6 text-gray-400"></i>
                            </div>`
                        }
                        <div class="propiedad-card-info">
                            <div class="propiedad-card-titulo">${titulo}</div>
                            <div class="propiedad-card-metros">${metros}</div>
                            <div class="propiedad-card-precio">${precio}</div>
                        </div>
                    </div>
                    <div class="propiedad-card-body">
                        <div class="propiedad-card-details">
                            <div class="propiedad-card-detail">
                                <div class="propiedad-card-detail-label">Tipo</div>
                                <div class="propiedad-card-detail-value">${tipoCell.textContent}</div>
                            </div>
                            <div class="propiedad-card-detail">
                                <div class="propiedad-card-detail-label">Estado</div>
                                <div class="propiedad-card-detail-value">
                                    <span class="propiedad-card-estado ${estadoClass}">${estado}</span>
                                </div>
                            </div>
                            <div class="propiedad-card-detail">
                                <div class="propiedad-card-detail-label">Ubicaci√≥n</div>
                                <div class="propiedad-card-detail-value">${ubicacion}</div>
                            </div>
                            <div class="propiedad-card-detail">
                                <div class="propiedad-card-detail-label">Fecha</div>
                                <div class="propiedad-card-detail-value">${fecha}</div>
                            </div>
                        </div>
                        <div class="propiedad-card-actions">
                            ${verLink ? `<a href="${verLink.href}" class="btn-ver">
                                <i data-lucide="eye" class="w-4 h-4"></i>
                                Ver
                            </a>` : ''}
                            ${editarLink ? `<a href="${editarLink.href}" class="btn-editar">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                                Editar
                            </a>` : ''}
                            ${eliminarBtn ? `<button type="button" class="btn-eliminar" onclick="${eliminarBtn.getAttribute('onclick')}">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                                Eliminar
                            </button>` : ''}
                        </div>
                    </div>
                `;
                
                cardsContainer.appendChild(card);
            }
            
            // Recrear iconos de Lucide
            lucide.createIcons();
        }
        
        // Funci√≥n para alternar entre tabla y cards seg√∫n el tama√±o de pantalla
        function toggleTableCards() {
            const table = document.getElementById('propertiesTable');
            const cardsContainer = document.getElementById('propertiesCardsMobile');
            
            if (!table || !cardsContainer) return;
            
            if (window.innerWidth <= 768) {
                // M√≥vil: mostrar cards, ocultar tabla
                table.style.display = 'none';
                cardsContainer.style.display = 'block';
                generateMobileCards();
            } else {
                // Desktop/Tablet: mostrar tabla, ocultar cards
                table.style.display = 'table';
                cardsContainer.style.display = 'none';
            }
        }
        
        // Funci√≥n para b√∫squeda (actualizada para funcionar con cards y tabla)
        function initSearch() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keyup', function() {
                    const searchTerm = this.value.toLowerCase();
                    const table = document.getElementById('propertiesTable');
                    const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
                    
                    for (let row of rows) {
                        const title = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                        const location = row.querySelector('td:nth-child(6)').textContent.toLowerCase();
                        
                        if (title.includes(searchTerm) || location.includes(searchTerm)) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    }
                    
                    // Actualizar cards m√≥viles si est√°n visibles
                    if (window.innerWidth <= 768) {
                        generateMobileCards();
                    }
                    
                    // Actualizar contador
                    actualizarContadorPropiedades();
                });
            }
        }

        // ========================================
        // INICIALIZACI√ìN PRINCIPAL
        // ========================================
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Inicializar iconos de Lucide
                lucide.createIcons();
                
                // Inicializar todos los m√≥dulos
                SidebarManager.init();
                ChartManager.init();
                AnimationManager.init();
                ActivitiesManager.init();
                PropertyModalManager.init();
                
                // Actualizar contador de usuarios cada 30 segundos
                setInterval(() => {
                    actualizarContadorUsuarios();
                }, 30000);
                UsuarioModalManager.init();
                PropertyManager.init();
                ConfigManager.init();
                
                // Inicializar funciones responsivas
                initSearch();
                toggleTableCards();
                
                // Escuchar cambios de tama√±o de ventana
                window.addEventListener('resize', toggleTableCards);
                
                // Asegurar que la fecha se actualice despu√©s de la inicializaci√≥n
                setTimeout(() => {
                    AnimationManager.updateDate();
                }, 100);
                
                // Actualizar la fecha cada minuto
                setInterval(() => {
                    AnimationManager.updateDate();
                }, 60000);
                
                // Fallback: actualizar fecha inmediatamente
                AnimationManager.updateDate();
                
                // Agregar actividades de ejemplo si no hay ninguna
                setTimeout(() => {
                    const activities = ActivitiesManager.getActivities();
                    if (activities.length === 0) {
                        ActivitiesManager.addActivity('system', 'Dashboard iniciado', 'Sistema de actividades activado', 'zap', 'green');
                        ActivitiesManager.addActivity('info', 'Bienvenido al dashboard', 'Todas las funciones est√°n disponibles', 'home', 'blue');
                    }
                }, 1000);
                
                // Cargar estad√≠sticas de rese√±as desde el backend
                setTimeout(() => {
                    cargarEstadisticasResenas();
                }, 500);
                
                // Inicializar funcionalidades de gesti√≥n
                initSearch();
                
                // Event listeners para modal de eliminaci√≥n de propiedades
                document.getElementById('cancelar-eliminar').addEventListener('click', function() {
                    document.getElementById('modal-eliminar-propiedad').classList.add('hidden');
                });
                
                document.getElementById('confirmar-eliminar').addEventListener('click', function() {
                    if (propiedadAEliminar) {
                        eliminarPropiedad(propiedadAEliminar);
                    }
                });
                
                // Event listeners para modal de eliminaci√≥n de usuarios
                document.getElementById('cancelar-eliminar-usuario').addEventListener('click', function() {
                    document.getElementById('modal-eliminar-usuario').classList.add('hidden');
                });
                
                document.getElementById('confirmar-eliminar-usuario').addEventListener('click', function() {
                    console.log('Bot√≥n de confirmar eliminaci√≥n clickeado');
                    console.log('Usuario a eliminar:', window.usuarioAEliminar);
                    if (window.usuarioAEliminar) {
                        eliminarUsuario(window.usuarioAEliminar);
                    } else {
                        console.error('No hay usuario seleccionado para eliminar');
                    }
                });
                
                // Event listeners para gesti√≥n de CVs
                const btnGestionarCvs = document.getElementById('btn-gestionar-cvs');
                const btnVolverInicioCvs = document.getElementById('btn-volver-inicio-cvs');
                
                if (btnGestionarCvs) {
                    btnGestionarCvs.addEventListener('click', function() {
                        showSection('cvs-content');
                        updateSidebarState('cvs');
                        lucide.createIcons();
                    });
                }
                
                if (btnVolverInicioCvs) {
                    btnVolverInicioCvs.addEventListener('click', function() {
                        showSection('dashboard-content');
                        updateSidebarState('dashboard');
                        lucide.createIcons();
                    });
                }
                
                // Event listener para bot√≥n refrescar CVs
                const btnRefrescarCvs = document.getElementById('btn-refrescar-cvs');
                if (btnRefrescarCvs) {
                    btnRefrescarCvs.addEventListener('click', function() {
                        // Recargar la p√°gina para actualizar los CVs
                        location.reload();
                    });
                }
                
                // Funci√≥n para eliminar CV con modal personalizado
                window.eliminarCV = function(cvId, nombreCompleto) {
                    console.log('eliminarCV llamada con:', cvId, nombreCompleto);
                    
                    // Verificar que los par√°metros sean v√°lidos
                    if (!cvId || !nombreCompleto) {
                        console.error('Par√°metros inv√°lidos:', cvId, nombreCompleto);
                        mostrarMensajeError('Error: Par√°metros inv√°lidos para eliminar CV');
                        return;
                    }
                    
                    // Crear modal de confirmaci√≥n personalizado
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 backdrop-blur-sm';
                    modal.innerHTML = `
                        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all duration-300 scale-95">
                            <div class="p-6">
                                <div class="flex items-center mb-6">
                                    <div class="flex-shrink-0">
                                        <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
                                            <i data-lucide="trash-2" class="w-6 h-6 text-red-600"></i>
                                        </div>
                                    </div>
                                    <div class="ml-4">
                                        <h3 class="text-xl font-bold text-gray-900">Eliminar Curr√≠culum</h3>
                                        <p class="text-sm text-gray-500">Esta acci√≥n es permanente</p>
                                    </div>
                                </div>
                                
                                <div class="mb-6">
                                    <div class="bg-gray-50 rounded-xl p-4 mb-4">
                                        <div class="flex items-center mb-2">
                                            <i data-lucide="user" class="w-4 h-4 text-gray-500 mr-2"></i>
                                            <span class="text-sm font-medium text-gray-700">Candidato:</span>
                                        </div>
                                        <p class="text-lg font-semibold text-gray-900 ml-6">${nombreCompleto}</p>
                                    </div>
                                    
                                    <div class="bg-red-50 border-l-4 border-red-400 rounded-lg p-4">
                                        <div class="flex items-start">
                                            <i data-lucide="alert-triangle" class="w-5 h-5 text-red-500 mr-3 mt-0.5 flex-shrink-0"></i>
                                            <div>
                                                <h4 class="text-sm font-semibold text-red-800 mb-1">Advertencia Importante</h4>
                                                <p class="text-sm text-red-700">
                                                    Esta acci√≥n eliminar√° permanentemente:
                                                </p>
                                                <ul class="text-sm text-red-700 mt-2 ml-4 space-y-1">
                                                    <li>‚Ä¢ El archivo PDF del curr√≠culum</li>
                                                    <li>‚Ä¢ Todos los datos del candidato</li>
                                                    <li>‚Ä¢ El historial de contacto</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex space-x-3">
                                    <button id="cancelar-eliminar-cv" class="flex-1 bg-gray-100 text-gray-700 px-4 py-3 rounded-lg hover:bg-gray-200 transition-all duration-200 font-medium flex items-center justify-center">
                                        <i data-lucide="x" class="w-4 h-4 mr-2"></i>
                                        Cancelar
                                    </button>
                                    <button id="confirmar-eliminar-cv" class="flex-1 bg-red-600 text-white px-4 py-3 rounded-lg hover:bg-red-700 transition-all duration-200 font-medium flex items-center justify-center shadow-lg hover:shadow-xl">
                                        <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i>
                                        Eliminar Permanentemente
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    lucide.createIcons();
                    console.log('Modal creado y agregado al DOM');
                    
                    // Animar entrada del modal
                    setTimeout(() => {
                        const modalContent = modal.querySelector('.bg-white');
                        modalContent.classList.remove('scale-95');
                        modalContent.classList.add('scale-100');
                    }, 10);
                    
                    // Event listeners para los botones - con delay para asegurar que los elementos est√©n disponibles
                    setTimeout(() => {
                        const btnCancelar = document.getElementById('cancelar-eliminar-cv');
                        const btnConfirmar = document.getElementById('confirmar-eliminar-cv');
                        
                        if (btnCancelar) {
                            btnCancelar.addEventListener('click', () => {
                                console.log('Usuario cancel√≥ eliminaci√≥n de CV');
                                // Animar salida del modal
                                const modalContent = modal.querySelector('.bg-white');
                                modalContent.classList.add('scale-95', 'opacity-0');
                                setTimeout(() => {
                                    if (document.body.contains(modal)) {
                                        document.body.removeChild(modal);
                                    }
                                }, 300);
                            });
                        }
                        
                        if (btnConfirmar) {
                            btnConfirmar.addEventListener('click', () => {
                                console.log('Usuario confirm√≥ eliminaci√≥n de CV');
                                
                                // Cerrar modal inmediatamente
                                const modalContent = modal.querySelector('.bg-white');
                                modalContent.classList.add('scale-95', 'opacity-0');
                                setTimeout(() => {
                                    if (document.body.contains(modal)) {
                                        document.body.removeChild(modal);
                                    }
                                }, 300);
                                
                                // Ejecutar eliminaci√≥n
                                eliminarCVDirecto(cvId, nombreCompleto);
                            });
                        }
                    }, 50);
                };
                
                // Funci√≥n para eliminar CV directamente
                function eliminarCVDirecto(cvId, nombreCompleto) {
                    console.log('Eliminando CV directamente:', cvId);
                    
                    fetch(`/delete-cv/${cvId}/`, {
                        method: 'DELETE',
                        headers: {
                            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                            'Content-Type': 'application/json',
                        },
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Respuesta del servidor:', data);
                        if (data.success) {
                            // Mostrar mensaje de √©xito personalizado
                            mostrarMensajeExito('‚úÖ CV eliminado exitosamente.', nombreCompleto);
                            
                            // Agregar actividad
                            ActivitiesManager.addActivity(
                                'cv', 
                                'CV eliminado', 
                                `"${nombreCompleto}" removido del sistema`, 
                                'trash-2', 
                                'red'
                            );
                            
                            // Recargar p√°gina despu√©s de un breve delay
                            setTimeout(() => {
                                location.reload();
                            }, 2000);
                        } else {
                            mostrarMensajeError('Error: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        mostrarMensajeError('Error al eliminar el CV. Por favor intenta nuevamente.');
                    });
                }
                
                // Funci√≥n para mostrar mensaje de √©xito
                function mostrarMensajeExito(mensaje, nombreCompleto) {
                    const toast = document.createElement('div');
                    toast.className = 'fixed top-4 right-4 z-50 transform transition-all duration-500 translate-x-full';
                    toast.innerHTML = `
                        <div class="bg-white border-l-4 border-green-500 rounded-xl shadow-2xl max-w-sm w-full overflow-hidden">
                            <div class="p-4">
                                <div class="flex items-start">
                                    <div class="flex-shrink-0">
                                        <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                                            <i data-lucide="check-circle" class="w-6 h-6 text-green-600"></i>
                                        </div>
                                    </div>
                                    <div class="ml-3 flex-1">
                                        <div class="flex items-center justify-between">
                                            <h3 class="text-sm font-semibold text-gray-900">¬°CV Eliminado!</h3>
                                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 transition-colors">
                                                <i data-lucide="x" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                        <div class="mt-1">
                                            <p class="text-sm text-gray-600">
                                                El curr√≠culum de <span class="font-medium text-gray-900">${nombreCompleto}</span> ha sido eliminado permanentemente.
                                            </p>
                                        </div>
                                        <div class="mt-3 flex items-center">
                                            <div class="flex items-center text-xs text-green-600 bg-green-50 px-2 py-1 rounded-full">
                                                <i data-lucide="shield-check" class="w-3 h-3 mr-1"></i>
                                                <span>Archivo eliminado del servidor</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-green-50 px-4 py-2 border-t border-green-100">
                                <div class="flex items-center text-xs text-green-700">
                                    <i data-lucide="clock" class="w-3 h-3 mr-1"></i>
                                    <span>Eliminado hace unos segundos</span>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(toast);
                    lucide.createIcons();
                    
                    // Animar entrada con efecto de rebote
                    setTimeout(() => {
                        toast.classList.remove('translate-x-full');
                        toast.classList.add('animate-bounce');
                        setTimeout(() => {
                            toast.classList.remove('animate-bounce');
                        }, 600);
                    }, 100);
                    
                    // Auto-remover despu√©s de 5 segundos con animaci√≥n de salida
                    setTimeout(() => {
                        toast.classList.add('translate-x-full', 'opacity-0');
                        setTimeout(() => {
                            if (document.body.contains(toast)) {
                                document.body.removeChild(toast);
                            }
                        }, 500);
                    }, 5000);
                }
                
                // Funci√≥n para mostrar mensaje de error
                function mostrarMensajeError(mensaje) {
                    const toast = document.createElement('div');
                    toast.className = 'fixed top-4 right-4 z-50 transform transition-all duration-500 translate-x-full';
                    toast.innerHTML = `
                        <div class="bg-white border-l-4 border-red-500 rounded-xl shadow-2xl max-w-sm w-full overflow-hidden">
                            <div class="p-4">
                                <div class="flex items-start">
                                    <div class="flex-shrink-0">
                                        <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center">
                                            <i data-lucide="alert-circle" class="w-6 h-6 text-red-600"></i>
                                        </div>
                                    </div>
                                    <div class="ml-3 flex-1">
                                        <div class="flex items-center justify-between">
                                            <h3 class="text-sm font-semibold text-gray-900">Error al Eliminar</h3>
                                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 transition-colors">
                                                <i data-lucide="x" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                        <div class="mt-1">
                                            <p class="text-sm text-gray-600">${mensaje}</p>
                                        </div>
                                        <div class="mt-3 flex items-center">
                                            <div class="flex items-center text-xs text-red-600 bg-red-50 px-2 py-1 rounded-full">
                                                <i data-lucide="alert-triangle" class="w-3 h-3 mr-1"></i>
                                                <span>No se pudo completar la acci√≥n</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-red-50 px-4 py-2 border-t border-red-100">
                                <div class="flex items-center text-xs text-red-700">
                                    <i data-lucide="refresh-cw" class="w-3 h-3 mr-1"></i>
                                    <span>Intenta nuevamente en unos segundos</span>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(toast);
                    lucide.createIcons();
                    
                    // Animar entrada con efecto de rebote
                    setTimeout(() => {
                        toast.classList.remove('translate-x-full');
                        toast.classList.add('animate-bounce');
                        setTimeout(() => {
                            toast.classList.remove('animate-bounce');
                        }, 600);
                    }, 100);
                    
                    // Auto-remover despu√©s de 6 segundos con animaci√≥n de salida
                    setTimeout(() => {
                        toast.classList.add('translate-x-full', 'opacity-0');
                        setTimeout(() => {
                            if (document.body.contains(toast)) {
                                document.body.removeChild(toast);
                            }
                        }, 500);
                    }, 6000);
                }
                
                // Event listeners para gesti√≥n de rese√±as
                const btnGestionarResenas = document.getElementById('btn-gestionar-resenas');
                const btnRefrescarResenas = document.getElementById('btn-refrescar-resenas');
                
                if (btnGestionarResenas) {
                    btnGestionarResenas.addEventListener('click', function() {
                        showSection('gestion-resenas-content');
                        updateSidebarState('resenas');
                        window.cargarResenas();
                    });
                }
                
                
                if (btnRefrescarResenas) {
                    btnRefrescarResenas.addEventListener('click', function() {
                        window.cargarResenas(currentPage);
                    });
                }
                
                // Event listeners para filtros de rese√±as
                const filtroEstado = document.getElementById('filtro-estado');
                const filtroPropiedad = document.getElementById('filtro-propiedad');
                const filtroCalificacion = document.getElementById('filtro-calificacion');
                
                if (filtroEstado) {
                    filtroEstado.addEventListener('change', function() {
                        aplicarFiltrosResenas();
                    });
                }
                
                if (filtroPropiedad) {
                    filtroPropiedad.addEventListener('change', function() {
                        aplicarFiltrosResenas();
                    });
                }
                
                if (filtroCalificacion) {
                    filtroCalificacion.addEventListener('change', function() {
                        aplicarFiltrosResenas();
                    });
                }
                
                // Event listener para bot√≥n limpiar filtros
                const btnLimpiarFiltros = document.getElementById('btn-limpiar-filtros');
                if (btnLimpiarFiltros) {
                    btnLimpiarFiltros.addEventListener('click', function() {
                        // Resetear todos los filtros a sus valores por defecto
                        if (filtroEstado) filtroEstado.value = 'todos';
                        if (filtroPropiedad) filtroPropiedad.value = 'todas';
                        if (filtroCalificacion) filtroCalificacion.value = 'todas';
                        
                        // Recargar rese√±as sin filtros
                        window.cargarResenas(1);
                    });
                }
                
                // Event listeners para botones "Volver al Inicio"
                const btnVolverInicioConfig = document.getElementById('btn-volver-inicio-config');
                const btnVolverInicioResenas = document.getElementById('btn-volver-inicio-resenas');
                const btnVolverInicioGestion = document.getElementById('btn-volver-inicio-gestion');
                
                if (btnVolverInicioConfig) {
                    btnVolverInicioConfig.addEventListener('click', function() {
                        showSection('dashboard-content');
                        updateSidebarState('dashboard');
                    });
                }
                
                if (btnVolverInicioResenas) {
                    btnVolverInicioResenas.addEventListener('click', function() {
                        showSection('dashboard-content');
                        updateSidebarState('dashboard');
                    });
                }
                
                if (btnVolverInicioGestion) {
                    btnVolverInicioGestion.addEventListener('click', function() {
                        showSection('dashboard-content');
                        updateSidebarState('dashboard');
                    });
                }
                
                // Event listener para bot√≥n de configurar 2FA
                const btnConfigurar2FA = document.getElementById('btn-configurar-2fa');
                if (btnConfigurar2FA) {
                    btnConfigurar2FA.addEventListener('click', function() {
                        // Redirigir a la p√°gina de configuraci√≥n 2FA
                        window.location.href = '/login/setup-2fa';
                    });
                }
                
                // Event listener para bot√≥n de informaci√≥n 2FA
                const btnInfo2FA = document.getElementById('btn-info-2fa');
                if (btnInfo2FA) {
                    btnInfo2FA.addEventListener('click', function() {
                        // Mostrar modal de informaci√≥n 2FA
                        showModal2FA();
                    });
                }
                
                // Event listener para bot√≥n de desactivar 2FA
                const btnDesactivar2FA = document.getElementById('btn-desactivar-2fa');
                if (btnDesactivar2FA) {
                    btnDesactivar2FA.addEventListener('click', function() {
                        // Confirmar desactivaci√≥n
                        if (confirm('¬øEst√°s seguro de que quieres desactivar la autenticaci√≥n de dos factores? Esto reducir√° la seguridad de tu cuenta.')) {
                            // Redirigir a la p√°gina de desactivaci√≥n 2FA
                            window.location.href = '/login/disable-2fa';
                        }
                    });
                }
                
                // Event listener para bot√≥n de ver c√≥digos de respaldo
                const btnVerCodigosRespaldo = document.getElementById('btn-ver-codigos-respaldo');
                if (btnVerCodigosRespaldo) {
                    btnVerCodigosRespaldo.addEventListener('click', function() {
                        // Mostrar c√≥digos de respaldo (esto requerir√≠a una implementaci√≥n adicional)
                        alert('Los c√≥digos de respaldo te permiten acceder a tu cuenta si pierdes tu dispositivo m√≥vil. Gu√°rdalos en un lugar seguro. Esta funcionalidad se implementar√° pr√≥ximamente.');
                    });
                }
                
                // Asignar iconos din√°micamente a las amenidades
                document.querySelectorAll('[data-icon]').forEach(function(element) {
                    const iconClass = element.getAttribute('data-icon');
                    element.classList.add(iconClass);
                });
                
                console.log('Dashboard inicializado correctamente');
            } catch (error) {
                console.error('Error al inicializar el dashboard:', error);
            }
        });

        // ========================================
        // M√ìDULO: GESTI√ìN DE RESE√ëAS
        // ========================================
        
        // Variable para la p√°gina actual
        let currentPage = 1;

        // Funci√≥n para ver una propiedad espec√≠fica
        window.verPropiedad = function(propiedadId) {
            console.log('Ver propiedad:', propiedadId);
            // Aqu√≠ puedes implementar la l√≥gica para mostrar la propiedad
            // Por ejemplo, abrir un modal o navegar a la p√°gina de la propiedad
            alert(`Ver propiedad con ID: ${propiedadId}`);
        };

        // Funci√≥n para aplicar filtros de rese√±as
        function aplicarFiltrosResenas() {
            const filtroEstado = document.getElementById('filtro-estado')?.value || 'todos';
            const filtroPropiedad = document.getElementById('filtro-propiedad')?.value || 'todas';
            const filtroCalificacion = document.getElementById('filtro-calificacion')?.value || 'todas';
            
            // Recargar rese√±as con los filtros aplicados
            window.cargarResenas(1, {
                estado: filtroEstado,
                propiedad: filtroPropiedad,
                calificacion: filtroCalificacion
            });
        }

        // Funci√≥n para eliminar rese√±a
        async function eliminarResena(resenaId) {
            // Crear modal de confirmaci√≥n personalizado
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl max-w-md w-full mx-4 transform transition-all duration-300 scale-100">
                    <!-- Header del modal -->
                    <div class="bg-gradient-to-r from-red-500 to-red-600 px-6 py-4 rounded-t-xl">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center mr-3">
                                <i data-lucide="trash-2" class="w-6 h-6 text-white"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-white">Eliminar Rese√±a</h3>
                                <p class="text-red-100 text-sm">Acci√≥n irreversible</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Contenido del modal -->
                    <div class="px-6 py-6">
                        <div class="flex items-start space-x-4">
                            <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center flex-shrink-0">
                                <i data-lucide="alert-triangle" class="w-6 h-6 text-red-600"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="text-lg font-semibold text-gray-900 mb-2">¬øEst√°s seguro?</h4>
                                <p class="text-gray-600 mb-4">Esta rese√±a ser√° eliminada permanentemente del sistema. Esta acci√≥n no se puede deshacer.</p>
                                <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                                    <div class="flex items-center">
                                        <i data-lucide="info" class="w-4 h-4 text-red-600 mr-2"></i>
                                        <span class="text-sm text-red-700 font-medium">Se actualizar√°n autom√°ticamente todos los contadores</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Botones del modal -->
                    <div class="px-6 py-4 bg-gray-50 rounded-b-xl flex justify-end space-x-3">
                        <button id="cancelar-eliminar" class="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors font-medium">
                            Cancelar
                        </button>
                        <button id="confirmar-eliminar" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium flex items-center">
                            <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i>
                            Eliminar Rese√±a
                        </button>
                    </div>
                </div>
            `;
            
            // Agregar el modal al DOM
            document.body.appendChild(modal);
            
            // Inicializar iconos de Lucide
            lucide.createIcons();
            
            // Crear una promesa para manejar la respuesta
            return new Promise((resolve) => {
                const cancelarBtn = modal.querySelector('#cancelar-eliminar');
                const confirmarBtn = modal.querySelector('#confirmar-eliminar');
                
                const limpiarModal = () => {
                    modal.remove();
                };
                
                cancelarBtn.addEventListener('click', () => {
                    limpiarModal();
                    resolve(false);
                });
                
                confirmarBtn.addEventListener('click', async () => {
                    limpiarModal();
                    resolve(true);
                });
                
                // Cerrar al hacer clic fuera del modal
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        limpiarModal();
                        resolve(false);
                    }
                });
                
                // Cerrar con tecla Escape
                const handleEscape = (e) => {
                    if (e.key === 'Escape') {
                        limpiarModal();
                        resolve(false);
                        document.removeEventListener('keydown', handleEscape);
                    }
                };
                document.addEventListener('keydown', handleEscape);
            }).then(async (confirmado) => {
                if (!confirmado) {
                    return;
                }

            try {
                const response = await fetch(`{% url "login:eliminar_resena" %}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    },
                    body: JSON.stringify({
                        resena_id: resenaId
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // Eliminar el elemento visual de la lista inmediatamente
                    const resenaElement = document.querySelector(`[data-resena-id="${resenaId}"]`);
                    if (resenaElement) {
                        // Agregar animaci√≥n de desvanecimiento antes de eliminar
                        resenaElement.style.transition = 'all 0.3s ease';
                        resenaElement.style.opacity = '0';
                        resenaElement.style.transform = 'translateX(-100%)';
                        
                        setTimeout(() => {
                            resenaElement.remove();
                        }, 300);
                    }
                    
                    // Agregar actividad
                    ActivitiesManager.addActivity(
                        'review', 
                        'Rese√±a eliminada', 
                        'Rese√±a eliminada permanentemente del sistema', 
                        'trash-2', 
                        'red'
                    );
                    
                    // Actualizar estad√≠sticas inmediatamente
                    cargarEstadisticasResenas();
                    
                    // Mostrar notificaci√≥n
                    mostrarNotificacion('success', 'Rese√±a eliminada exitosamente', 'La rese√±a ha sido eliminada permanentemente.');
                    
                    // Limpiar completamente la interfaz y recargar
                    setTimeout(() => {
                        // Limpiar cualquier elemento residual
                        const resenasList = document.getElementById('resenas-list');
                        if (resenasList) {
                            // Limpiar completamente la lista
                            resenasList.innerHTML = '';
                        }
                        
                        // Limpiar cualquier estado residual de filtros
                        const filtroEstado = document.getElementById('filtro-estado');
                        const filtroPropiedad = document.getElementById('filtro-propiedad');
                        const filtroCalificacion = document.getElementById('filtro-calificacion');
                        
                        if (filtroEstado && filtroEstado.value !== 'todos') {
                            filtroEstado.value = 'todos';
                        }
                        if (filtroPropiedad && filtroPropiedad.value !== 'todas') {
                            filtroPropiedad.value = 'todas';
                        }
                        if (filtroCalificacion && filtroCalificacion.value !== 'todas') {
                            filtroCalificacion.value = 'todas';
                        }
                        
                        // Recargar la lista de rese√±as
                        window.cargarResenas(currentPage);
                    }, 500);
                } else {
                    mostrarNotificacion('error', 'Error al eliminar rese√±a', data.message || 'No se pudo eliminar la rese√±a.');
                }
            } catch (error) {
                console.error('Error al eliminar rese√±a:', error);
                mostrarNotificacion('error', 'Error al eliminar rese√±a', 'Ocurri√≥ un error inesperado.');
            }
            });
        }
        
        // Hacer las funciones globales para que puedan ser llamadas desde onclick
        window.eliminarResena = eliminarResena;
        window.cargarResenas = async function(page = 1, filtros = {}) {
            try {
                currentPage = page;
                
                // Construir par√°metros de la URL
                const params = new URLSearchParams();
                params.append('page', page);
                
                if (filtros.estado && filtros.estado !== 'todos') {
                    params.append('estado', filtros.estado);
                }
                if (filtros.propiedad && filtros.propiedad !== 'todas') {
                    params.append('propiedad', filtros.propiedad);
                }
                if (filtros.calificacion && filtros.calificacion !== 'todas') {
                    params.append('calificacion', filtros.calificacion);
                }
                
                const response = await fetch(`{% url "login:gestionar_resenas" %}?${params.toString()}`);
                const data = await response.json();
                
                if (data.success) {
                    const resenasList = document.getElementById('resenas-list');
                    const resenasCount = document.getElementById('resenas-count');
                    
                    resenasList.innerHTML = '';
                    resenasCount.textContent = data.pagination.total_resenas;
                    
                    // Actualizar contadores con datos reales del backend
                    if (data.estadisticas) {
                        // Actualizar el total en el dashboard
                        actualizarTotalResenas(data.estadisticas.total);
                        
                        // Actualizar los contadores individuales en la vista de rese√±as (desktop/tablet)
                        const esperaElement = document.getElementById('resenasEspera');
                        const aceptadasElement = document.getElementById('resenasAceptadas');
                        const rechazadasElement = document.getElementById('resenasRechazadas');
                        
                        if (esperaElement) esperaElement.textContent = data.estadisticas.en_espera || 0;
                        if (aceptadasElement) aceptadasElement.textContent = data.estadisticas.aceptadas || 0;
                        if (rechazadasElement) rechazadasElement.textContent = data.estadisticas.rechazadas || 0;
                        
                        // Actualizar los contadores m√≥viles
                        const esperaElementMobile = document.getElementById('resenasEsperaMobile');
                        const aceptadasElementMobile = document.getElementById('resenasAceptadasMobile');
                        const rechazadasElementMobile = document.getElementById('resenasRechazadasMobile');
                        
                        if (esperaElementMobile) esperaElementMobile.textContent = data.estadisticas.en_espera || 0;
                        if (aceptadasElementMobile) aceptadasElementMobile.textContent = data.estadisticas.aceptadas || 0;
                        if (rechazadasElementMobile) rechazadasElementMobile.textContent = data.estadisticas.rechazadas || 0;
                    }
                    
                    if (data.resenas.length === 0) {
                        resenasList.innerHTML = `
                            <div class="text-center py-6 sm:py-8 text-gray-500">
                                <i data-lucide="star" class="w-8 h-8 sm:w-12 sm:h-12 mx-auto mb-3 sm:mb-4 text-gray-300"></i>
                                <p class="text-sm sm:text-base">No hay rese√±as para moderar</p>
                            </div>
                        `;
                    } else {
                        data.resenas.forEach(resena => {
                        const resenaElement = document.createElement('div');
                        resenaElement.className = 'bg-white rounded-lg border border-gray-200 p-4 sm:p-6 mb-3 sm:mb-4';
                        resenaElement.setAttribute('data-resena-id', resena.id);
                            
                            // Generar estrellas con Lucide icons
                            let estrellas = '';
                            for (let i = 1; i <= 5; i++) {
                                if (i <= resena.calificacion) {
                                    estrellas += '<i data-lucide="star" class="w-4 h-4 text-yellow-400 fill-current"></i>';
                                } else {
                                    estrellas += '<i data-lucide="star" class="w-4 h-4 text-gray-300"></i>';
                                }
                            }
                            
                            // Determinar color del estado
                            let estadoColor = '';
                            let estadoTexto = '';
                            switch(resena.estado) {
                                case 'Pendiente de Aprobaci√≥n':
                                    estadoColor = 'bg-yellow-100 text-yellow-800';
                                    estadoTexto = 'Pendiente';
                                    break;
                                case 'Aprobada':
                                    estadoColor = 'bg-green-100 text-green-800';
                                    estadoTexto = 'Aprobada';
                                    break;
                                case 'Rechazada':
                                    estadoColor = 'bg-red-100 text-red-800';
                                    estadoTexto = 'Rechazada';
                                    break;
                            }
                            
                            resenaElement.innerHTML = `
                                <div class="bg-gradient-to-r from-white to-gray-50 rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-all duration-300">
                                    <!-- Header de la rese√±a -->
                                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 px-4 sm:px-6 py-3 sm:py-4 rounded-t-xl border-b border-gray-200">
                                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                                            <div class="flex items-center space-x-3 sm:space-x-4 mb-2 sm:mb-0">
                                                <!-- Avatar del usuario -->
                                                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center text-white font-bold text-sm sm:text-lg flex-shrink-0">
                                                    ${resena.nombre_usuario.charAt(0).toUpperCase()}
                                                </div>
                                                <div class="min-w-0 flex-1">
                                                    <h4 class="font-bold text-gray-900 text-base sm:text-lg truncate">${resena.nombre_usuario}</h4>
                                                    <p class="text-xs sm:text-sm text-gray-600 flex items-center truncate">
                                                        <i data-lucide="mail" class="w-3 h-3 mr-1 flex-shrink-0"></i>
                                                        <span class="truncate">${resena.email_usuario}</span>
                                                    </p>
                                                </div>
                                            </div>
                                            <span class="px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm font-medium ${estadoColor} shadow-sm self-start sm:self-auto">
                                                ${estadoTexto}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <!-- Contenido principal -->
                                    <div class="p-4 sm:p-6">
                                        <!-- Calificaci√≥n destacada -->
                                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-3 sm:mb-4">
                                            <div class="flex items-center space-x-2 sm:space-x-3 mb-2 sm:mb-0">
                                                <div class="flex items-center space-x-1">
                                                    ${estrellas}
                                                </div>
                                                <span class="text-base sm:text-lg font-bold text-gray-900">${resena.calificacion}/5</span>
                                            </div>
                                            <div class="text-xs sm:text-sm text-gray-500 flex items-center">
                                                <i data-lucide="calendar" class="w-3 h-3 sm:w-4 sm:h-4 mr-1"></i>
                                                ${resena.fecha_creacion}
                                            </div>
                                        </div>
                                        
                                        <!-- Propiedad -->
                                        <div class="mb-3 sm:mb-4">
                                            <h6 class="text-xs sm:text-sm font-semibold text-gray-700 mb-1 sm:mb-2 flex items-center">
                                                <i data-lucide="home" class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 text-blue-600"></i>
                                                Propiedad
                                            </h6>
                                            <div class="p-2 sm:p-3 bg-gray-50 rounded-lg border border-gray-200">
                                                <span class="text-blue-600 font-semibold cursor-pointer hover:text-blue-800 transition-colors text-sm sm:text-base truncate block" onclick="verPropiedad(${resena.propiedad_id})">
                                                    ${resena.propiedad_titulo}
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <!-- T√≠tulo de la rese√±a -->
                                        ${resena.titulo ? `
                                        <div class="mb-3 sm:mb-4">
                                            <h6 class="text-xs sm:text-sm font-semibold text-gray-700 mb-1 sm:mb-2 flex items-center">
                                                <i data-lucide="message-square" class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 text-green-600"></i>
                                                T√≠tulo de la Rese√±a
                                            </h6>
                                            <div class="bg-white rounded-lg p-3 sm:p-4 border border-gray-200 shadow-sm">
                                                <h5 class="font-bold text-gray-900 text-base sm:text-lg">"${resena.titulo}"</h5>
                                            </div>
                                        </div>
                                        ` : ''}
                                        
                                        <!-- Comentario -->
                                        <div class="mb-3 sm:mb-4">
                                            <h6 class="text-xs sm:text-sm font-semibold text-gray-700 mb-1 sm:mb-2 flex items-center">
                                                <i data-lucide="file-text" class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 text-purple-600"></i>
                                                Descripci√≥n
                                            </h6>
                                            <div class="bg-white rounded-lg p-3 sm:p-4 border border-gray-200 shadow-sm">
                                                <p class="text-gray-700 leading-relaxed italic text-sm sm:text-base">"${resena.comentario}"</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                    <!-- Botones de acci√≥n -->
                    ${resena.estado === 'Pendiente de Aprobaci√≥n' ? `
                    <div class="bg-gray-50 px-4 sm:px-6 py-3 sm:py-4 rounded-b-xl border-t border-gray-200">
                        <div class="flex flex-col sm:flex-row gap-2 sm:gap-3">
                            <button onclick="aprobarResena(${resena.id})" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg hover:from-green-600 hover:to-green-700 transition-all duration-200 text-xs sm:text-sm font-medium flex items-center justify-center shadow-sm hover:shadow-md">
                                <i data-lucide="check" class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"></i>
                                Aprobar Rese√±a
                            </button>
                            <button onclick="rechazarResena(${resena.id})" class="flex-1 bg-gradient-to-r from-red-500 to-red-600 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 text-xs sm:text-sm font-medium flex items-center justify-center shadow-sm hover:shadow-md">
                                <i data-lucide="x" class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"></i>
                                Rechazar Rese√±a
                            </button>
                        </div>
                    </div>
                    ` : (resena.estado === 'Aprobada' || resena.estado === 'Rechazada') ? `
                    <div class="bg-gray-50 px-4 sm:px-6 py-3 sm:py-4 rounded-b-xl border-t border-gray-200">
                        <div class="flex justify-end">
                            <button onclick="eliminarResena(${resena.id})" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm font-medium flex items-center shadow-sm hover:shadow-md">
                                <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i>
                                Eliminar Rese√±a
                            </button>
                        </div>
                    </div>
                    ` : ''}
                                </div>
                            `;
                            resenasList.appendChild(resenaElement);
                        });
                    }
                    
                    // Agregar controles de paginaci√≥n
                    if (data.pagination.total_pages > 1) {
                        const paginationHTML = crearControlesPaginacion(data.pagination);
                        resenasList.appendChild(paginationHTML);
                    }
                    
                    // Reinicializar iconos
                    lucide.createIcons();
                } else {
                    console.error('Error al cargar rese√±as:', data.message);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Funci√≥n para crear controles de paginaci√≥n
        function crearControlesPaginacion(pagination) {
            const paginationDiv = document.createElement('div');
            paginationDiv.className = 'pagination-container';
            paginationDiv.style.cssText = `
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 10px;
                margin-top: 30px;
                padding: 20px;
                background: #f8f9fa;
                border-radius: 10px;
                border: 1px solid #e9ecef;
            `;
            
            let paginationHTML = `
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="color: #6c757d; font-size: 14px;">
                        P√°gina ${pagination.current_page} de ${pagination.total_pages} 
                        (${pagination.total_resenas} rese√±as)
                    </span>
                    
                    <div style="display: flex; gap: 5px;">
            `;
            
            // Bot√≥n anterior
            if (pagination.has_previous) {
                paginationHTML += `
                    <button onclick="cargarResenas(${pagination.previous_page})" style="
                        background: #007bff;
                        color: white;
                        border: none;
                        padding: 8px 12px;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 14px;
                        transition: all 0.2s ease;
                    " onmouseover="this.style.background='#0056b3'" 
                       onmouseout="this.style.background='#007bff'">
                        <i class="fas fa-chevron-left"></i> Anterior
                    </button>
                `;
            } else {
                paginationHTML += `
                    <button disabled style="
                        background: #e9ecef;
                        color: #6c757d;
                        border: none;
                        padding: 8px 12px;
                        border-radius: 6px;
                        font-size: 14px;
                        cursor: not-allowed;
                    ">
                        <i class="fas fa-chevron-left"></i> Anterior
                    </button>
                `;
            }
            
            // N√∫meros de p√°gina
            const startPage = Math.max(1, pagination.current_page - 2);
            const endPage = Math.min(pagination.total_pages, pagination.current_page + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                if (i === pagination.current_page) {
                    paginationHTML += `
                        <button style="
                            background: #28a745;
                            color: white;
                            border: none;
                            padding: 8px 12px;
                            border-radius: 6px;
                            font-size: 14px;
                            font-weight: bold;
                        ">${i}</button>
                    `;
                } else {
                    paginationHTML += `
                        <button onclick="cargarResenas(${i})" style="
                            background: white;
                            color: #007bff;
                            border: 1px solid #007bff;
                            padding: 8px 12px;
                            border-radius: 6px;
                            cursor: pointer;
                            font-size: 14px;
                            transition: all 0.2s ease;
                        " onmouseover="this.style.background='#007bff'; this.style.color='white'" 
                           onmouseout="this.style.background='white'; this.style.color='#007bff'">
                            ${i}
                        </button>
                    `;
                }
            }
            
            // Bot√≥n siguiente
            if (pagination.has_next) {
                paginationHTML += `
                    <button onclick="cargarResenas(${pagination.next_page})" style="
                        background: #007bff;
                        color: white;
                        border: none;
                        padding: 8px 12px;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 14px;
                        transition: all 0.2s ease;
                    " onmouseover="this.style.background='#0056b3'" 
                       onmouseout="this.style.background='#007bff'">
                        Siguiente <i class="fas fa-chevron-right"></i>
                    </button>
                `;
            } else {
                paginationHTML += `
                    <button disabled style="
                        background: #e9ecef;
                        color: #6c757d;
                        border: none;
                        padding: 8px 12px;
                        border-radius: 6px;
                        font-size: 14px;
                        cursor: not-allowed;
                    ">
                        Siguiente <i class="fas fa-chevron-right"></i>
                    </button>
                `;
            }
            
            paginationHTML += `
                    </div>
                </div>
            `;
            
            paginationDiv.innerHTML = paginationHTML;
            return paginationDiv;
        }

        // Funci√≥n para aprobar rese√±a (muestra modal de confirmaci√≥n)
        window.aprobarResena = function(resenaId) {
            mostrarConfirmacionAprobacion(resenaId);
        }
        
        // Funci√≥n de depuraci√≥n para encontrar elementos residuales (ejecutar en consola si hay problemas)
        window.debugElementosResiduales = function() {
            console.log('üîç Buscando elementos residuales...');
            const elementos = Array.from(document.body.children);
            elementos.forEach((el, index) => {
                if (el.style && el.style.position === 'fixed') {
                    console.log(`Elemento ${index}:`, {
                        id: el.id || 'sin id',
                        classes: el.className || 'sin clases',
                        position: el.style.position,
                        zIndex: el.style.zIndex,
                        background: el.style.background || el.style.backgroundColor,
                        elemento: el
                    });
                }
            });
        }
        
        // Funci√≥n para limpiar TODOS los modales de forma agresiva (ejecutar en consola si hay problemas)
        window.limpiarTodosLosModales = function() {
            console.log('üßπ Limpiando TODOS los modales...');
            limpiarTodoModalAprobacion();
            limpiarTodoModalRechazo();
            limpiarModales();
            console.log('‚úÖ Limpieza completa realizada');
        }

        // Variable para almacenar el listener del teclado
        let escapeListenerAprobacion = null;

        // Funci√≥n auxiliar para limpiar todo lo relacionado al modal de aprobaci√≥n
        function limpiarTodoModalAprobacion() {
            // Limpiar listeners
            if (escapeListenerAprobacion) {
                document.removeEventListener('keydown', escapeListenerAprobacion);
                escapeListenerAprobacion = null;
            }
            
            // Buscar y eliminar todos los modales de aprobaci√≥n
            const modales = document.querySelectorAll('#modal-confirmacion-aprobacion, [id*="modal-confirmacion-aprobacion"], .modal-content-aprobacion');
            modales.forEach(elemento => {
                if (elemento && elemento.parentNode) {
                    elemento.parentNode.removeChild(elemento);
                }
            });
            
            // Buscar elementos hu√©rfanos con estilos espec√≠ficos del modal
            const todosLosElementos = Array.from(document.body.children);
            for (let i = todosLosElementos.length - 1; i >= 0; i--) {
                const elemento = todosLosElementos[i];
                if (elemento.style && elemento.style.position === 'fixed') {
                    // Verificar si es un modal overlay (fondo oscuro)
                    const esOverlay = elemento.style.background && 
                                     (elemento.style.background.includes('rgba(0, 0, 0') || 
                                      elemento.style.backgroundColor && elemento.style.backgroundColor.includes('rgba(0, 0, 0'));
                    
                    const esModalAprobacion = elemento.id === 'modal-confirmacion-aprobacion' || 
                                             elemento.style.zIndex === '10001';
                    
                    if (esModalAprobacion || esOverlay) {
                        // Asegurar que no sea un elemento importante del sistema
                        const esImportante = elemento.id === 'sidebar' || 
                                            elemento.id === 'navbar' || 
                                            elemento.classList.contains('main-header') ||
                                            elemento.classList.contains('sidebar');
                        
                        if (!esImportante) {
                            elemento.remove();
                        }
                    }
                }
            }
        }

        // Funci√≥n para mostrar confirmaci√≥n de aprobaci√≥n hermoso
        function mostrarConfirmacionAprobacion(resenaId) {
            // Limpiar cualquier modal previo completamente
            limpiarTodoModalAprobacion();
            
            // Crear el modal de confirmaci√≥n
            const confirmModal = document.createElement('div');
            confirmModal.id = 'modal-confirmacion-aprobacion';
            confirmModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10001;
                animation: fadeIn 0.3s ease;
            `;
            
            confirmModal.innerHTML = `
                <div class="modal-content-aprobacion" style="
                    background: white;
                    border-radius: 20px;
                    padding: 40px;
                    text-align: center;
                    max-width: 500px;
                    width: 90%;
                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
                    animation: slideIn 0.4s ease;
                    position: relative;
                ">
                    <div style="
                        width: 80px;
                        height: 80px;
                        background: linear-gradient(135deg, #4CAF50, #2e7d32);
                        border-radius: 50%;
                        margin: 0 auto 20px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        animation: pulse 0.6s ease;
                    ">
                        <i class="fas fa-check-circle" style="color: white; font-size: 40px;"></i>
                    </div>
                    
                    <h3 style="
                        color: #2c3e50;
                        margin-bottom: 15px;
                        font-size: 24px;
                        font-weight: 600;
                    ">¬øAprobar Rese√±a?</h3>
                    
                    <p style="
                        color: #7f8c8d;
                        font-size: 16px;
                        line-height: 1.5;
                        margin-bottom: 25px;
                    ">¬øEst√°s seguro de que quieres aprobar esta rese√±a? Se publicar√° en tu sitio web.</p>
                    
                    <div style="
                        background: #d4edda;
                        border: 1px solid #c3e6cb;
                        border-radius: 10px;
                        padding: 15px;
                        margin-bottom: 25px;
                        border-left: 4px solid #28a745;
                    ">
                        <p style="
                            color: #155724;
                            font-size: 14px;
                            margin: 0;
                            font-style: italic;
                        ">‚úì La rese√±a ser√° visible p√∫blicamente para todos los visitantes</p>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button onclick="cerrarConfirmacionAprobacion()" style="
                            background: #6c757d;
                            color: white;
                            border: none;
                            padding: 12px 30px;
                            border-radius: 25px;
                            font-size: 16px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(108, 117, 125, 0.4)'" 
                           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(108, 117, 125, 0.3)'">
                            <i class="fas fa-times" style="margin-right: 8px;"></i>
                            Cancelar
                        </button>
                        
                        <button onclick="confirmarAprobacionResena(${resenaId})" style="
                            background: linear-gradient(135deg, #4CAF50, #2e7d32);
                            color: white;
                            border: none;
                            padding: 12px 30px;
                            border-radius: 25px;
                            font-size: 16px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(76, 175, 80, 0.4)'" 
                           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(76, 175, 80, 0.3)'">
                            <i class="fas fa-check" style="margin-right: 8px;"></i>
                            Aprobar
                        </button>
                    </div>
                </div>
            `;
            
            // Los estilos CSS para las animaciones ya existen en el modal de rechazo
            
            document.body.appendChild(confirmModal);
            
            // Cerrar modal al hacer clic fuera de √©l
            confirmModal.addEventListener('click', function(e) {
                if (e.target === confirmModal) {
                    cerrarConfirmacionAprobacion();
                }
            });
            
            // Cerrar modal con tecla Escape - guardar referencia del listener
            escapeListenerAprobacion = function(e) {
                if (e.key === 'Escape') {
                    cerrarConfirmacionAprobacion();
                }
            };
            document.addEventListener('keydown', escapeListenerAprobacion);
        }

        // Funci√≥n para cerrar el modal de confirmaci√≥n de aprobaci√≥n
        function cerrarConfirmacionAprobacion() {
            limpiarTodoModalAprobacion();
        }

        // Funci√≥n para confirmar la aprobaci√≥n
        async function confirmarAprobacionResena(resenaId) {
            // Limpieza inmediata y completa
            limpiarTodoModalAprobacion();
            
            // Limpieza secundaria por si acaso
            setTimeout(() => {
                limpiarTodoModalAprobacion();
            }, 50);
            
            try {
                const response = await fetch(`/login/aprobar-resena/${resenaId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Limpieza adicional antes de mostrar resultado
                    limpiarTodoModalAprobacion();
                    limpiarModales();
                    
                    // Agregar actividad
                    ActivitiesManager.addActivity(
                        'review', 
                        'Rese√±a aprobada', 
                        'Nueva rese√±a aprobada y publicada', 
                        'check-circle', 
                        'green'
                    );
                    
                    // Recargar estad√≠sticas desde el backend
                    cargarEstadisticasResenas();
                    
                    mostrarNotificacion('success', 'Rese√±a aprobada exitosamente', 'La rese√±a ha sido aprobada y ahora es visible p√∫blicamente.');
                    window.cargarResenas(currentPage); // Recargar la lista manteniendo la p√°gina actual
                    
                    // Limpieza final despu√©s de todo
                    setTimeout(() => {
                        limpiarTodoModalAprobacion();
                        limpiarModales();
                    }, 200);
                } else {
                    limpiarTodoModalAprobacion();
                    limpiarModales();
                    mostrarNotificacion('error', 'Error al aprobar la rese√±a', data.message);
                }
            } catch (error) {
                console.error('Error:', error);
                limpiarTodoModalAprobacion();
                limpiarModales();
                mostrarNotificacion('error', 'Error al aprobar la rese√±a', 'Por favor intenta de nuevo.');
            }
        }

        // Funci√≥n para rechazar rese√±a
        window.rechazarResena = async function(resenaId) {
            mostrarConfirmacionRechazo(resenaId);
        }

        // Variable para almacenar el listener del teclado de rechazo
        let escapeListenerRechazo = null;

        // Funci√≥n auxiliar para limpiar todo lo relacionado al modal de rechazo
        function limpiarTodoModalRechazo() {
            // Limpiar listeners
            if (escapeListenerRechazo) {
                document.removeEventListener('keydown', escapeListenerRechazo);
                escapeListenerRechazo = null;
            }
            
            // Buscar y eliminar todos los modales de rechazo
            const modales = document.querySelectorAll('#modal-confirmacion-rechazo, [id*="modal-confirmacion-rechazo"], .modal-content-rechazo');
            modales.forEach(elemento => {
                if (elemento && elemento.parentNode) {
                    elemento.parentNode.removeChild(elemento);
                }
            });
            
            // Buscar elementos hu√©rfanos con estilos espec√≠ficos del modal
            const todosLosElementos = Array.from(document.body.children);
            for (let i = todosLosElementos.length - 1; i >= 0; i--) {
                const elemento = todosLosElementos[i];
                if (elemento.style && elemento.style.position === 'fixed') {
                    // Verificar si es un modal overlay (fondo oscuro)
                    const esOverlay = elemento.style.background && 
                                     (elemento.style.background.includes('rgba(0, 0, 0') || 
                                      elemento.style.backgroundColor && elemento.style.backgroundColor.includes('rgba(0, 0, 0'));
                    
                    const esModalRechazo = elemento.id === 'modal-confirmacion-rechazo' || 
                                          elemento.style.zIndex === '10001';
                    
                    if (esModalRechazo || esOverlay) {
                        // Asegurar que no sea un elemento importante del sistema
                        const esImportante = elemento.id === 'sidebar' || 
                                            elemento.id === 'navbar' || 
                                            elemento.classList.contains('main-header') ||
                                            elemento.classList.contains('sidebar');
                        
                        if (!esImportante) {
                            elemento.remove();
                        }
                    }
                }
            }
        }

        // ========================================
        // SISTEMA DE NOTIFICACIONES HERMOSAS
        // ========================================
        
        // Funci√≥n para mostrar notificaciones hermosas
        function mostrarNotificacion(tipo, titulo, mensaje, duracion = 4000) {
            // Crear el contenedor de notificaciones si no existe
            let container = document.getElementById('notificaciones-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'notificaciones-container';
                container.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 10000;
                    display: flex;
                    flex-direction: column;
                    gap: 10px;
                `;
                document.body.appendChild(container);
            }
            
            // Definir colores y iconos seg√∫n el tipo
            const configs = {
                success: {
                    color: '#4CAF50',
                    icon: 'fas fa-check-circle',
                    bgColor: 'linear-gradient(135deg, #4CAF50, #45a049)',
                    borderColor: '#4CAF50'
                },
                error: {
                    color: '#f44336',
                    icon: 'fas fa-exclamation-circle',
                    bgColor: 'linear-gradient(135deg, #f44336, #d32f2f)',
                    borderColor: '#f44336'
                },
                warning: {
                    color: '#ff9800',
                    icon: 'fas fa-exclamation-triangle',
                    bgColor: 'linear-gradient(135deg, #ff9800, #f57c00)',
                    borderColor: '#ff9800'
                },
                info: {
                    color: '#2196F3',
                    icon: 'fas fa-info-circle',
                    bgColor: 'linear-gradient(135deg, #2196F3, #1976D2)',
                    borderColor: '#2196F3'
                }
            };
            
            const config = configs[tipo] || configs.info;
            
            // Crear la notificaci√≥n
            const notificacion = document.createElement('div');
            notificacion.style.cssText = `
                background: white;
                border-radius: 12px;
                padding: 20px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
                border-left: 4px solid ${config.borderColor};
                max-width: 400px;
                min-width: 300px;
                position: relative;
                animation: slideInRight 0.4s ease;
                cursor: pointer;
                transition: all 0.3s ease;
            `;
            
            notificacion.innerHTML = `
                <div style="display: flex; align-items: flex-start; gap: 15px;">
                    <div style="
                        width: 40px;
                        height: 40px;
                        background: ${config.bgColor};
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        flex-shrink: 0;
                        animation: pulse 0.6s ease;
                    ">
                        <i class="${config.icon}" style="color: white; font-size: 18px;"></i>
                    </div>
                    
                    <div style="flex: 1;">
                        <h4 style="
                            margin: 0 0 8px 0;
                            color: #2c3e50;
                            font-size: 16px;
                            font-weight: 600;
                        ">${titulo}</h4>
                        
                        <p style="
                            margin: 0;
                            color: #7f8c8d;
                            font-size: 14px;
                            line-height: 1.4;
                        ">${mensaje}</p>
                    </div>
                    
                    <button onclick="cerrarNotificacion(this)" style="
                        background: none;
                        border: none;
                        color: #bdc3c7;
                        font-size: 18px;
                        cursor: pointer;
                        padding: 0;
                        width: 24px;
                        height: 24px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 50%;
                        transition: all 0.2s ease;
                    " onmouseover="this.style.background='#ecf0f1'; this.style.color='#e74c3c'" 
                       onmouseout="this.style.background='none'; this.style.color='#bdc3c7'">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div style="
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    height: 3px;
                    background: ${config.bgColor};
                    border-radius: 0 0 12px 12px;
                    animation: progressBar ${duracion}ms linear;
                "></div>
            `;
            
            // Agregar estilos CSS si no existen
            if (!document.getElementById('notificaciones-styles')) {
                const styles = document.createElement('style');
                styles.id = 'notificaciones-styles';
                styles.textContent = `
                    @keyframes slideInRight {
                        from {
                            opacity: 0;
                            transform: translateX(100%);
                        }
                        to {
                            opacity: 1;
                            transform: translateX(0);
                        }
                    }
                    
                    @keyframes slideOutRight {
                        from {
                            opacity: 1;
                            transform: translateX(0);
                        }
                        to {
                            opacity: 0;
                            transform: translateX(100%);
                        }
                    }
                    
                    @keyframes pulse {
                        0% { transform: scale(1); }
                        50% { transform: scale(1.1); }
                        100% { transform: scale(1); }
                    }
                    
                    @keyframes progressBar {
                        from { width: 100%; }
                        to { width: 0%; }
                    }
                `;
                document.head.appendChild(styles);
            }
            
            // Agregar efecto hover
            notificacion.addEventListener('mouseenter', () => {
                notificacion.style.transform = 'translateX(-5px)';
                notificacion.style.boxShadow = '0 15px 40px rgba(0, 0, 0, 0.25)';
            });
            
            notificacion.addEventListener('mouseleave', () => {
                notificacion.style.transform = 'translateX(0)';
                notificacion.style.boxShadow = '0 10px 30px rgba(0, 0, 0, 0.2)';
            });
            
            // Agregar a la p√°gina
            container.appendChild(notificacion);
            
            // Auto-eliminar despu√©s del tiempo especificado
            setTimeout(() => {
                if (notificacion.parentNode) {
                    cerrarNotificacion(notificacion.querySelector('button'));
                }
            }, duracion);
        }
        
        // Funci√≥n para cerrar notificaciones
        function cerrarNotificacion(button) {
            const notificacion = button.closest('div');
            notificacion.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => {
                if (notificacion.parentNode) {
                    notificacion.remove();
                }
            }, 300);
        }

        // Funci√≥n para mostrar confirmaci√≥n de rechazo hermoso
        function mostrarConfirmacionRechazo(resenaId) {
            // Limpiar cualquier modal previo completamente
            limpiarTodoModalRechazo();
            
            // Crear el modal de confirmaci√≥n
            const confirmModal = document.createElement('div');
            confirmModal.id = 'modal-confirmacion-rechazo';
            confirmModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10001;
                animation: fadeIn 0.3s ease;
            `;
            
            confirmModal.innerHTML = `
                <div class="modal-content-rechazo" style="
                    background: white;
                    border-radius: 20px;
                    padding: 40px;
                    text-align: center;
                    max-width: 500px;
                    width: 90%;
                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
                    animation: slideIn 0.4s ease;
                    position: relative;
                ">
                    <div style="
                        width: 80px;
                        height: 80px;
                        background: linear-gradient(135deg, #f44336, #d32f2f);
                        border-radius: 50%;
                        margin: 0 auto 20px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        animation: pulse 0.6s ease;
                    ">
                        <i class="fas fa-exclamation-triangle" style="color: white; font-size: 32px;"></i>
                    </div>
                    
                    <h3 style="
                        color: #2c3e50;
                        margin-bottom: 15px;
                        font-size: 24px;
                        font-weight: 600;
                    ">¬øRechazar Rese√±a?</h3>
                    
                    <p style="
                        color: #7f8c8d;
                        font-size: 16px;
                        line-height: 1.5;
                        margin-bottom: 25px;
                    ">¬øEst√°s seguro de que quieres rechazar esta rese√±a? Esta acci√≥n no se puede deshacer.</p>
                    
                    <div style="
                        background: #fff3cd;
                        border: 1px solid #ffeaa7;
                        border-radius: 10px;
                        padding: 15px;
                        margin-bottom: 25px;
                        border-left: 4px solid #f39c12;
                    ">
                        <p style="
                            color: #856404;
                            font-size: 14px;
                            margin: 0;
                            font-style: italic;
                        ">‚ö†Ô∏è La rese√±a ser√° rechazada y no se mostrar√° p√∫blicamente</p>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button onclick="cerrarConfirmacionRechazo()" style="
                            background: #6c757d;
                            color: white;
                            border: none;
                            padding: 12px 30px;
                            border-radius: 25px;
                            font-size: 16px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(108, 117, 125, 0.4)'" 
                           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(108, 117, 125, 0.3)'">
                            <i class="fas fa-times" style="margin-right: 8px;"></i>
                            Cancelar
                        </button>
                        
                        <button onclick="confirmarRechazoResena(${resenaId})" style="
                            background: linear-gradient(135deg, #f44336, #d32f2f);
                            color: white;
                            border: none;
                            padding: 12px 30px;
                            border-radius: 25px;
                            font-size: 16px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(244, 67, 54, 0.4)'" 
                           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(244, 67, 54, 0.3)'">
                            <i class="fas fa-ban" style="margin-right: 8px;"></i>
                            Rechazar
                        </button>
                    </div>
                </div>
            `;
            
            // Agregar estilos CSS para las animaciones si no existen
            if (!document.getElementById('confirm-modal-styles')) {
                const styles = document.createElement('style');
                styles.id = 'confirm-modal-styles';
                styles.textContent = `
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    
                    @keyframes slideIn {
                        from { 
                            opacity: 0;
                            transform: translateY(-50px) scale(0.9);
                        }
                        to { 
                            opacity: 1;
                            transform: translateY(0) scale(1);
                        }
                    }
                    
                    @keyframes pulse {
                        0%, 20%, 50%, 80%, 100% {
                            transform: scale(1);
                        }
                        40% {
                            transform: scale(1.1);
                        }
                        60% {
                            transform: scale(1.05);
                        }
                    }
                    
                    @keyframes fadeOut {
                        from { opacity: 1; }
                        to { opacity: 0; }
                    }
                `;
                document.head.appendChild(styles);
            }
            
            document.body.appendChild(confirmModal);
            
            // Cerrar modal al hacer clic fuera de √©l
            confirmModal.addEventListener('click', function(e) {
                if (e.target === confirmModal) {
                    cerrarConfirmacionRechazo();
                }
            });
            
            // Cerrar modal con tecla Escape - guardar referencia del listener
            escapeListenerRechazo = function(e) {
                if (e.key === 'Escape') {
                    cerrarConfirmacionRechazo();
                }
            };
            document.addEventListener('keydown', escapeListenerRechazo);
        }

        // Funci√≥n para cerrar el modal de confirmaci√≥n de rechazo
        function cerrarConfirmacionRechazo() {
            limpiarTodoModalRechazo();
        }

        // Funci√≥n para eliminar rese√±a de la lista actual
        function eliminarResenaDeLista(resenaId) {
            const resenasList = document.getElementById('resenas-list');
            const resenaElement = resenasList.querySelector(`[data-resena-id="${resenaId}"]`);
            
            if (resenaElement) {
                // Animaci√≥n de desvanecimiento
                resenaElement.style.transition = 'all 0.3s ease';
                resenaElement.style.opacity = '0';
                resenaElement.style.transform = 'translateX(-100%)';
                
                setTimeout(() => {
                    if (resenaElement.parentNode) {
                        resenaElement.remove();
                        
                        // Actualizar contador
                        const resenasCount = document.getElementById('resenas-count');
                        if (resenasCount) {
                            const currentCount = parseInt(resenasCount.textContent) || 0;
                            resenasCount.textContent = Math.max(0, currentCount - 1);
                        }
                        
                        // Verificar si la p√°gina qued√≥ vac√≠a
                        const resenasRestantes = resenasList.querySelectorAll('[data-resena-id]');
                        if (resenasRestantes.length === 0) {
                            // Si no hay m√°s rese√±as en la p√°gina actual, recargar
                            window.cargarResenas(currentPage);
                        }
                    }
                }, 300);
            }
        }

        // Funci√≥n para limpiar todos los modales
        function limpiarModales() {
            const modales = [
                'modal-confirmacion-rechazo',
                'modal-confirmacion-aprobacion',
                'modal-exito-resena'
            ];
            
            modales.forEach(id => {
                const modal = document.getElementById(id);
                if (modal && modal.parentNode) {
                    modal.remove();
                }
            });
            
            // Limpiar cualquier elemento con position fixed y z-index alto (posibles modales residuales)
            const todosLosElementos = Array.from(document.body.children);
            todosLosElementos.forEach(elemento => {
                if (elemento.style && 
                    elemento.style.position === 'fixed' && 
                    (elemento.style.zIndex === '10001' || elemento.style.zIndex === '10000')) {
                    // Verificar que no sea un elemento importante
                    const esElementoImportante = elemento.classList.contains('notification-container') || 
                                                  elemento.id === 'navbar' ||
                                                  elemento.id === 'sidebar' ||
                                                  elemento.classList.contains('header');
                    if (!esElementoImportante) {
                        elemento.remove();
                    }
                }
            });
        }

        // Funci√≥n para confirmar el rechazo
        async function confirmarRechazoResena(resenaId) {
            // Limpieza inmediata y completa
            limpiarTodoModalRechazo();
            
            // Limpieza secundaria por si acaso
            setTimeout(() => {
                limpiarTodoModalRechazo();
            }, 50);
            
            try {
                const response = await fetch(`/login/rechazar-resena/${resenaId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Limpieza adicional antes de mostrar resultado
                    limpiarTodoModalRechazo();
                    limpiarModales();
                    
                    // Agregar actividad
                    ActivitiesManager.addActivity(
                        'review', 
                        'Rese√±a rechazada', 
                        'Rese√±a rechazada y eliminada del sistema', 
                        'x-circle', 
                        'red'
                    );
                    
                    // Recargar estad√≠sticas desde el backend
                    cargarEstadisticasResenas();
                    
                    mostrarNotificacion('success', 'Rese√±a rechazada exitosamente', 'La rese√±a ha sido rechazada y eliminada de la lista.');
                    // Eliminar la rese√±a de la lista actual sin recargar
                    eliminarResenaDeLista(resenaId);
                    
                    // Limpieza final despu√©s de todo
                    setTimeout(() => {
                        limpiarTodoModalRechazo();
                        limpiarModales();
                    }, 200);
                } else {
                    limpiarTodoModalRechazo();
                    limpiarModales();
                    mostrarNotificacion('error', 'Error al rechazar la rese√±a', data.message);
                }
            } catch (error) {
                console.error('Error:', error);
                limpiarTodoModalRechazo();
                limpiarModales();
                mostrarNotificacion('error', 'Error al rechazar la rese√±a', 'Por favor intenta de nuevo.');
            }
        }
    </script>
    
    <!-- Optimized Dashboard JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            'use strict';
            
            // Get configuration and utilities
            const CONFIG = window.DashboardConfig;
            const utils = window.DashboardUtils;
            
            // DOM elements
            const elements = {
                sidebar: document.getElementById('sidebar'),
                sidebarToggle: document.getElementById('sidebar-toggle'),
                sidebarCollapse: document.getElementById('sidebar-collapse'),
                sidebarOverlay: document.getElementById('sidebar-overlay'),
                mainContent: document.getElementById('main-content'),
                navButtons: document.querySelectorAll('[data-section]'),
                touchElements: document.querySelectorAll('button, .nav-button, .widget-card'),
                chartBars: document.querySelectorAll('.bar-chart')
            };
            
            // Sidebar state management
            const sidebarState = {
                isCollapsed: () => elements.sidebar ? elements.sidebar.classList.contains('collapsed') : false,
                isOpen: () => elements.sidebar ? elements.sidebar.classList.contains('open') : false,
                
                open: () => {
                    if (elements.sidebar) {
                        elements.sidebar.classList.add('open');
                    }
                    if (elements.sidebarOverlay) {
                        elements.sidebarOverlay.classList.add('active');
                    }
                    document.body.style.overflow = 'hidden';
                },
                
                close: () => {
                    if (elements.sidebar) {
                        elements.sidebar.classList.remove('open');
                    }
                    if (elements.sidebarOverlay) {
                        elements.sidebarOverlay.classList.remove('active');
                    }
                    document.body.style.overflow = '';
                },
                
                collapse: () => {
                    if (elements.sidebar) {
                        elements.sidebar.classList.add('collapsed');
                    }
                    if (elements.mainContent) {
                        elements.mainContent.classList.add('sidebar-collapsed');
                    }
                    const icon = elements.sidebarCollapse?.querySelector('i');
                    if (icon) icon.className = 'fas fa-chevron-right text-gray-600 text-lg';
                    localStorage.setItem(CONFIG.storage.key, 'true');
                    utils.setCSSVariable('--sidebar-width', `${CONFIG.sidebar.collapsed}px`);
                    utils.setCSSVariable('--main-margin', `${CONFIG.sidebar.collapsed}px`);
                },
                
                expand: () => {
                    if (elements.sidebar) {
                        elements.sidebar.classList.remove('collapsed');
                    }
                    if (elements.mainContent) {
                        elements.mainContent.classList.remove('sidebar-collapsed');
                    }
                    const icon = elements.sidebarCollapse?.querySelector('i');
                    if (icon) icon.className = 'fas fa-chevron-left text-gray-600 text-lg';
                    localStorage.setItem(CONFIG.storage.key, 'false');
                    utils.setCSSVariable('--sidebar-width', `${CONFIG.sidebar.width}px`);
                    utils.setCSSVariable('--main-margin', `${CONFIG.sidebar.width}px`);
                },
                
                toggle: () => {
                    if (sidebarState.isCollapsed()) {
                        sidebarState.expand();
                    } else {
                        sidebarState.collapse();
                    }
                }
            };
            
            // Initialize sidebar state - only for large screens
            function initializeSidebar() {
                if (utils.isLargeScreen()) {
                    const isCollapsed = localStorage.getItem(CONFIG.storage.key) === 'true';
                    if (isCollapsed) {
                        sidebarState.collapse();
                    }
                }
                // For medium and mobile screens, let CSS handle everything
            }
            
            // Handle responsive behavior - simplified
            function handleResize() {
                if (utils.isMobileScreen()) {
                    sidebarState.close();
                    elements.sidebarCollapse?.classList.add('hidden');
                    elements.sidebarCollapse?.classList.remove('flex');
                } else if (utils.isLargeScreen()) {
                    sidebarState.close();
                    if (elements.sidebarCollapse) {
                        elements.sidebarCollapse.style.display = 'flex';
                        elements.sidebarCollapse.classList.remove('hidden');
                        elements.sidebarCollapse.classList.add('flex');
                    }
                    
                    const isCollapsed = localStorage.getItem(CONFIG.storage.key) === 'true';
                    if (isCollapsed) {
                        sidebarState.collapse();
                    } else {
                        sidebarState.expand();
                    }
                }
                // For medium screens, let CSS handle everything automatically
            }
            
            // Event listeners
            function setupEventListeners() {
                // Sidebar controls
                elements.sidebarToggle?.addEventListener('click', () => {
                    if (utils.isMobileScreen()) {
                        if (sidebarState.isOpen()) {
                            sidebarState.close();
                        } else {
                            sidebarState.open();
                        }
                    }
                });
                
                elements.sidebarCollapse?.addEventListener('click', () => {
                    if (utils.isLargeScreen()) {
                        sidebarState.toggle();
                    }
                });
                
                elements.sidebarOverlay?.addEventListener('click', sidebarState.close);
                
                // Resize handling with debouncing
                let resizeTimeout;
                window.addEventListener('resize', () => {
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(handleResize, 100);
                });
                
                // Touch interactions
                elements.touchElements.forEach(element => {
                    element.addEventListener('touchstart', function() {
                        this.style.transform = 'scale(0.98)';
                    });
                    
                    element.addEventListener('touchend', function() {
                        this.style.transform = 'scale(1)';
                    });
                });
                
                // Prevent iOS double-tap zoom
                let lastTouchEnd = 0;
                document.addEventListener('touchend', function(event) {
                    const now = Date.now();
                    if (now - lastTouchEnd <= 300) {
                        event.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);
            }
            
            // Initialize everything
            function init() {
                // Initialize external libraries
                if (window.lucide) {
                    lucide.createIcons();
                }
                
                // Initialize dashboard components
                initializeSidebar();
                setupEventListeners();
            }
            
            // Start initialization
            init();
        });
    </script>
    
    <!-- CSRF Token -->
    {% csrf_token %}
    
    <!-- Script de fallback para la fecha -->
    <script>
        // Script inmediato para mostrar la fecha
        (function() {
            const currentDate = new Date();
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            };
            const optionsShort = { 
                day: 'numeric',
                month: 'short'
            };
            
            // Funci√≥n para actualizar fecha
            function updateDateElements() {
                const elements = [
                    { id: 'currentDateFull', options: options },
                    { id: 'currentDateMedium', options: options },
                    { id: 'currentDateShort', options: options },
                    { id: 'currentDateMinimal', options: optionsShort }
                ];
                
                elements.forEach(({ id, options: opts }) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = currentDate.toLocaleDateString('es-ES', opts);
                        console.log(`Fecha actualizada en ${id}:`, element.textContent);
                    } else {
                        console.log(`Elemento ${id} no encontrado`);
                    }
                });
            }
            
            // Ejecutar inmediatamente
            updateDateElements();
            
            // Ejecutar cuando el DOM est√© listo
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', updateDateElements);
            }
            
            // Ejecutar con delay
            setTimeout(updateDateElements, 100);
            setTimeout(updateDateElements, 500);
            setTimeout(updateDateElements, 1000);
        })();
        
        // ===== FUNCIONES DEL MODAL 2FA =====
        function showModal2FA() {
            const modal = document.getElementById('modal-2fa-info');
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden'; // Prevenir scroll del body
            }
        }
        
        function closeModal2FA() {
            const modal = document.getElementById('modal-2fa-info');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = ''; // Restaurar scroll del body
            }
        }
        
        // Cerrar modal al hacer clic fuera del contenido
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('modal-2fa-info');
            if (modal && event.target === modal) {
                closeModal2FA();
            }
        });
        
        // Cerrar modal con tecla Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal2FA();
            }
        });
    </script>
    
    <!-- Modal de Informaci√≥n 2FA -->
    <div id="modal-2fa-info" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <button class="modal-close" onclick="closeModal2FA()">
                    <i class="fas fa-times"></i>
                </button>
                <h2 class="modal-title">
                    <i class="fas fa-shield-alt"></i>
                    Autenticaci√≥n de Dos Factores (2FA)
                </h2>
            </div>
            <div class="modal-body">
                <p class="modal-text">
                    La autenticaci√≥n de dos factores (2FA) es una medida de seguridad que requiere dos formas de verificaci√≥n para acceder a tu cuenta. Esto hace que sea mucho m√°s dif√≠cil para los atacantes acceder a tu informaci√≥n personal, incluso si conocen tu contrase√±a.
                </p>
                
                <div class="modal-features">
                    <h4>
                        <i class="fas fa-check-circle"></i>
                        Beneficios de 2FA
                    </h4>
                    <ul>
                        <li>Protecci√≥n adicional contra accesos no autorizados</li>
                        <li>Seguridad mejorada para tu informaci√≥n personal</li>
                        <li>Protecci√≥n incluso si tu contrase√±a es comprometida</li>
                        <li>Cumplimiento con est√°ndares de seguridad modernos</li>
                        <li>Paz mental al saber que tu cuenta est√° protegida</li>
                    </ul>
                </div>
                
            </div>
            <div class="modal-footer">
                <button class="modal-btn" onclick="closeModal2FA()">
                    <i class="fas fa-check"></i>
                    Entendido
                </button>
            </div>
        </div>
    </div>
</body>
</html>
</html>