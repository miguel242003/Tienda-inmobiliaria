{% extends 'core/base.html' %}
{% load static %}

{% block title %}Contacto - Tienda Inmobiliaria{% endblock %}

{% block content %}
<!-- Contact Section -->
<section class="contact-unified-section position-relative">
    <div class="container-fluid position-relative" style="max-width: 1280px; z-index: 2; padding: 0 15px;">
        <!-- Hero Title -->
        <div class="row justify-content-center text-center py-3">
            <div class="col-lg-4">
                <div class="hero-text-container">
                    <h1 class="hero-title mb-2">Contáctanos</h1>
                    <div class="yellow-underline"></div>
                </div>
            </div>
        </div>
        
        <!-- Contact Content -->
        <div class="row g-2 pb-3">
            <!-- Contact Information -->
            <div class="col-lg-4 order-2 order-lg-2">
                <div class="contact-info-card">
                    <h3 class="info-title mb-2">Información de Contacto</h3>
                    <div class="yellow-underline-info"></div>
                    
                    <div class="info-item mt-4">
                        <div class="info-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="info-content">
                            <h4 class="info-label">DIRECCIÓN</h4>
                            <p class="info-text">Calle Principal 123<br>Ciudad, Estado 12345</p>
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-phone"></i>
                        </div>
                        <div class="info-content">
                            <h4 class="info-label">TELÉFONO</h4>
                            <p class="info-text">+1 234 567 890<br>+1 234 567 891</p>
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="info-content">
                            <h4 class="info-label">EMAIL</h4>
                            <p class="info-text">info@inmobiliaria.com<br>ventas@inmobiliaria.com</p>
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="info-content">
                            <h4 class="info-label">HORARIOS</h4>
                            <p class="info-text">Lunes - Viernes: 9:00 - 18:00<br>Sábado: 9:00 - 14:00<br>Domingo: Cerrado</p>
                        </div>
                    </div>
                    
                    <hr class="info-divider">
                    
                    <h4 class="info-label mb-3">SÍGUENOS</h4>
                    <div class="social-links">
                        <a href="#" class="social-link" aria-label="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="LinkedIn">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Contact Form -->
            <div class="col-lg-8 order-1 order-lg-1">
                <div class="contact-form-card">
                    <h3 class="form-title mb-2">Envíanos un Mensaje</h3>
                    <div class="yellow-underline-form"></div>
                    
                    <!-- Messages outside the form card -->
                    {% if messages %}
                        <div class="messages">
                            {% for message in messages %}
                                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                    
                    <form method="post" id="contactForm" class="mt-4">
                        {% csrf_token %}
                        <div class="row g-2">
                            <div class="col-md-6">
                                <label for="{{ form.nombre.id_for_label }}" class="form-label">
                                    {{ form.nombre.label }} <span class="required">*</span>
                                </label>
                                {{ form.nombre }}
                                {% if form.nombre.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.nombre.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <label for="{{ form.email.id_for_label }}" class="form-label">
                                    {{ form.email.label }} <span class="required">*</span>
                                </label>
                                {{ form.email }}
                                {% if form.email.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.email.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="row g-2 mt-2">
                            <div class="col-md-6">
                                <label for="{{ form.telefono.id_for_label }}" class="form-label">{{ form.telefono.label }}</label>
                                {{ form.telefono }}
                                {% if form.telefono.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.telefono.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <label for="{{ form.asunto.id_for_label }}" class="form-label">
                                    {{ form.asunto.label }} <span class="required">*</span>
                                </label>
                                {{ form.asunto }}
                                {% if form.asunto.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.asunto.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        
                        <div class="mt-3">
                            <label for="{{ form.mensaje.id_for_label }}" class="form-label">
                                {{ form.mensaje.label }} <span class="required">*</span>
                            </label>
                            {{ form.mensaje }}
                            {% if form.mensaje.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.mensaje.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="mt-4">
                            <button type="submit" 
                                    class="btn-cta w-100"
                                    aria-label="Enviar mensaje de contacto">
                                <i class="fas fa-paper-plane me-2"></i>
                                Enviar Mensaje
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Map Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <h3 class="location-title mb-2">Nuestra Ubicación</h3>
                <div class="yellow-underline"></div>
                <div class="bg-white rounded shadow-sm p-4">
                    <div id="map" style="height: 400px; width: 100%; border-radius: 8px;"></div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- FAQ Section -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="text-center mb-5">
                    <h3 class="faq-title mb-2">Preguntas Frecuentes</h3>
                    <div class="yellow-underline"></div>
                </div>
                
                <div class="accordion" id="faqAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faq1">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse1">
                                ¿Cómo puedo agendar una visita a una propiedad?
                            </button>
                        </h2>
                        <div id="collapse1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                Puedes contactarnos por teléfono, email o completando el formulario de contacto. Nuestro equipo te ayudará a coordinar una visita en el horario que mejor te convenga.
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faq2">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2">
                                ¿Qué documentos necesito para comprar una propiedad?
                            </button>
                        </h2>
                        <div id="collapse2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                Los documentos básicos incluyen identificación oficial, comprobante de ingresos, historial crediticio y en algunos casos, un pre-aprobación de crédito hipotecario.
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faq3">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse3">
                                ¿Ofrecen financiamiento hipotecario?
                            </button>
                        </h2>
                        <div id="collapse3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                Sí, trabajamos con varias instituciones financieras para ofrecerte las mejores opciones de financiamiento. Nuestros asesores te ayudarán a encontrar la opción más conveniente.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<!-- Leaflet JavaScript -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
:root {
    --brand-600: #1D4ED8;
    --brand-700: #1E40AF;
    --brand-800: #1E3A8A;
    --text-900: #0F172A;
    --text-700: #334155;
    --muted: #9CA3AF;
    --card: #FFFFFF;
    --card-alt: #F9FAFB;
    --border: #E5E7EB;
}

/* Unified Contact Section */
.contact-unified-section {
    background-image: url('{% static 'images/Fondodecontacto.jpg' %}');
    background-size: 120%;
    background-position: right center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    min-height: 100vh;
    padding: 1rem 0;
}

.hero-text-container {
    background: rgba(255, 255, 255, 0.15);
    padding: 1rem 2rem;
    border-radius: 16px;
    backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
}

.hero-title {
    font: 700 36px/1.1 Oswald, sans-serif;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    text-align: center;
    color: #2C3240;
    margin: 0 0 8px;
    text-shadow: none;
}

.hero-subtitle {
    text-align: center;
    color: #2C3240;
    margin: 0 0 36px;
    font-size: 1.1rem;
    font-weight: 400;
    text-shadow: none;
}

.yellow-underline {
    width: 40%;
    height: 4px;
    background-color: #FFD700;
    margin: 0.5rem auto;
    border-radius: 2px;
}

.yellow-underline-left {
    width: 35%;
    height: 4px;
    background-color: #FFD700;
    margin: 0.5rem 0;
    border-radius: 2px;
}

/* Ajustar ancho en pantallas grandes */
@media (min-width: 992px) {
    .yellow-underline-left {
        width: 50%;
    }
}

.yellow-underline-form {
    width: 30%;
    height: 4px;
    background-color: #FFD700;
    margin: 0.5rem 0;
    border-radius: 2px;
}

/* Ajustar ancho en pantallas grandes para que coincida con el texto */
@media (min-width: 992px) {
    .yellow-underline-form {
        width: 35%;
    }
}

.yellow-underline-info {
    width: 30%;
    height: 4px;
    background-color: #FFD700;
    margin: 0.5rem 0;
    border-radius: 2px;
}

/* Ajustar ancho en pantallas grandes para que coincida con el texto */
@media (min-width: 992px) {
    .yellow-underline-info {
        width: 35%;
    }
}

.location-title {
    font: 700 36px/1.1 Oswald, sans-serif;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    text-align: center;
    color: #2C3240;
    margin: 0 0 8px;
}

.faq-title {
    font: 700 36px/1.1 Oswald, sans-serif;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    text-align: center;
    color: #2C3240;
    margin: 0 0 8px;
}

/* Contact Cards */
.contact-info-card {
    background: var(--card-alt);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 16px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    height: 100%;
}

.contact-form-card {
    background: var(--card);
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

/* Info Items */
.info-item {
    display: flex;
    align-items: flex-start;
    margin-bottom: 12px;
}

.info-icon {
    width: 36px;
    height: 36px;
    background: var(--brand-600);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 14px;
    margin-right: 12px;
    flex-shrink: 0;
}

.info-content {
    flex: 1;
}

.info-label {
    font-weight: 600;
    font-size: 0.875rem;
    color: var(--text-700);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
}

.info-text {
    color: var(--text-900);
    line-height: 1.5;
    margin: 0;
}

.info-divider {
    border-color: var(--border);
    margin: 24px 0;
}

/* Social Links */
.social-links {
    display: flex;
    gap: 12px;
}

.social-link {
    width: 44px;
    height: 44px;
    border: 1px solid var(--border);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-700);
    text-decoration: none;
    transition: all 0.2s ease;
}

.social-link:hover {
    background: var(--brand-600);
    color: white;
    border-color: var(--brand-600);
    transform: scale(1.03);
}

/* Form Styles */
.form-title {
    color: var(--text-900);
    font-weight: 700;
    font-size: 1.5rem;
}

.info-title {
    color: var(--text-900);
    font-weight: 700;
    font-size: 1.5rem;
}

.form-label {
    font-weight: 600;
    color: var(--text-900);
    margin-bottom: 8px;
}

.required {
    color: #DC2626;
}

.form-control, .form-select {
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px 16px;
    font-size: 1rem;
    transition: all 0.2s ease;
}

/* Estilo específico para el select de asunto */
.form-select#id_asunto {
    /* Mantener el mismo estilo que otros selects */
    appearance: none;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 12px center;
    background-repeat: no-repeat;
    background-size: 16px;
    padding-right: 40px;
}

/* Estilo para las opciones del select */
.form-select#id_asunto option {
    padding: 8px 12px;
    font-size: 1rem;
    line-height: 1.4;
    background-color: white;
    color: var(--text-900);
}

/* Controlar la altura del dropdown del select */
.form-select#id_asunto {
    /* Mantener el comportamiento normal del select */
    height: auto;
    min-height: 48px;
    /* Intentar limitar la altura del dropdown usando CSS personalizado */
    background-size: 16px;
    background-position: right 12px center;
}

/* Estilo para las opciones del select - intentar limitar altura */
.form-select#id_asunto option {
    /* Establecer altura fija para cada opción */
    height: 48px;
    line-height: 48px;
    padding: 0 12px;
    font-size: 1rem;
    background-color: white;
    color: var(--text-900);
    display: block;
}

/* Nota: La limitación de altura del dropdown nativo del navegador es limitada.
   Los navegadores modernos no permiten controlar completamente la altura del dropdown
   usando solo CSS. Para un control total, se necesitaría un dropdown personalizado. */

/* Estilo adicional para mejorar la apariencia en diferentes navegadores */
.form-select#id_asunto::-webkit-scrollbar {
    width: 8px;
}

.form-select#id_asunto::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.form-select#id_asunto::-webkit-scrollbar-thumb {
    background: var(--brand-600);
    border-radius: 4px;
}

.form-select#id_asunto::-webkit-scrollbar-thumb:hover {
    background: var(--brand-700);
}

/* Estilos para el dropdown personalizado */
.custom-select-container {
    position: relative;
    width: 100%;
}

.custom-select-button {
    width: 100%;
    text-align: left;
    cursor: pointer;
    position: relative;
    z-index: 1;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 12px center;
    background-repeat: no-repeat;
    background-size: 16px;
    padding-right: 40px;
}

.custom-select-button:hover {
    border-color: var(--brand-600);
}

.custom-select-button:focus {
    border-color: var(--brand-600);
    box-shadow: 0 0 0 3px rgba(29, 78, 216, 0.1);
    outline: none;
}

.custom-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background-color: white;
    border: 1px solid var(--border);
    border-top: none;
    border-radius: 0 0 12px 12px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    max-height: 144px; /* 3 opciones * 48px */
    overflow-y: auto;
    z-index: 1000;
}

.custom-option {
    padding: 12px 16px;
    cursor: pointer;
    border-bottom: 1px solid #f3f4f6;
    transition: background-color 0.2s ease;
    font-size: 1rem;
    line-height: 1.4;
}

.custom-option:last-child {
    border-bottom: none;
}

.custom-option:hover {
    background-color: #f8fafc;
}

.custom-option.selected {
    background-color: var(--brand-600);
    color: white;
}

/* Scrollbar personalizado para el dropdown */
.custom-dropdown::-webkit-scrollbar {
    width: 8px;
}

.custom-dropdown::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.custom-dropdown::-webkit-scrollbar-thumb {
    background: var(--brand-600);
    border-radius: 4px;
}

.custom-dropdown::-webkit-scrollbar-thumb:hover {
    background: var(--brand-700);
}

/* Estilo para el dropdown cuando está abierto */
.form-select#id_asunto:focus {
    border-color: var(--brand-600);
    box-shadow: 0 0 0 3px rgba(29, 78, 216, 0.1);
    outline: none;
    position: relative;
    z-index: 1000;
}

/* Estilo para las opciones cuando están en hover */
.form-select#id_asunto option:hover {
    background-color: var(--brand-600);
    color: white;
}

/* Estilo para la opción seleccionada */
.form-select#id_asunto option:checked {
    background-color: var(--brand-600);
    color: white;
}

.form-control:focus, .form-select:focus {
    border-color: var(--brand-600);
    box-shadow: 0 0 0 3px rgba(29, 78, 216, 0.1);
    outline: none;
}

.form-control:focus-visible, .form-select:focus-visible {
    outline: 2px solid var(--brand-600);
    outline-offset: 2px;
}

.form-control::placeholder {
    color: var(--muted);
}

/* CTA Button */
.btn-cta {
    background: linear-gradient(135deg, var(--brand-600), var(--brand-700));
    border: none;
    border-radius: 12px;
    padding: 16px 24px;
    font-weight: 600;
    font-size: 1.1rem;
    color: white;
    transition: all 0.2s ease;
    box-shadow: 0 4px 6px -1px rgba(29, 78, 216, 0.3);
}

.btn-cta:hover {
    background: linear-gradient(135deg, var(--brand-700), var(--brand-800));
    transform: translateY(-1px);
    box-shadow: 0 8px 15px -3px rgba(29, 78, 216, 0.4);
}

.btn-cta:focus {
    outline: 2px solid var(--brand-600);
    outline-offset: 2px;
}

/* Validation */
.invalid-feedback {
    display: none;
    color: #DC2626;
    font-size: 0.875rem;
    margin-top: 4px;
}

.form-control.is-invalid, .form-select.is-invalid {
    border-color: #DC2626;
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
}

.form-control.is-valid,
.form-select.is-valid {
    border-color: #059669;
    box-shadow: 0 0 0 0.2rem rgba(5, 150, 105, 0.25);
}

.form-control.is-invalid + .invalid-feedback,
.form-select.is-invalid + .invalid-feedback,
.field-error-message {
    display: block;
    color: #DC2626;
    font-size: 0.875rem;
    margin-top: 0.25rem;
    font-weight: 500;
}

/* Mensaje de error del formulario */
.form-error-message {
    margin-bottom: 1rem;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(220, 53, 69, 0.2);
    border: none;
    font-weight: 500;
    padding: 16px 20px;
    font-size: 15px;
    position: relative;
    overflow: hidden;
    background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
    color: #721c24;
    border-left: 5px solid #dc3545;
}

.form-error-message::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
}

/* Animaciones para validación */
.form-control, .form-select {
    transition: all 0.3s ease;
}

.form-control.is-invalid, .form-select.is-invalid {
    animation: shake 0.5s ease-in-out;
}

.form-control.is-valid, .form-select.is-valid {
    animation: successPulse 0.3s ease-in-out;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}

@keyframes successPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); }
}

/* Contador de caracteres para mensaje */
.character-counter {
    font-size: 0.75rem;
    color: var(--muted);
    text-align: right;
    margin-top: 0.25rem;
}

.character-counter.warning {
    color: #D97706;
}

.character-counter.danger {
    color: #DC2626;
}

/* Mensajes de confirmación */
.messages {
    position: relative;
    z-index: 1000;
    margin: 20px auto 40px auto;
    max-width: 1200px;
    width: 90%;
    padding: 0 20px;
}

.messages .alert {
    margin-bottom: 10px;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    animation: slideDown 0.3s ease-out;
    border: none;
    font-weight: 500;
    padding: 16px 20px;
    font-size: 15px;
    position: relative;
    overflow: hidden;
}

.messages .alert::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
}

.messages .alert-success {
    background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
    color: #155724;
    border-left: 5px solid #28a745;
    box-shadow: 0 6px 20px rgba(40, 167, 69, 0.2);
}

.messages .alert-error {
    background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
    color: #721c24;
    border-left: 5px solid #dc3545;
    box-shadow: 0 6px 20px rgba(220, 53, 69, 0.2);
}

.messages .alert-warning {
    background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    color: #856404;
    border-left: 5px solid #ffc107;
    box-shadow: 0 6px 20px rgba(255, 193, 7, 0.2);
}

.messages .alert-info {
    background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
    color: #0c5460;
    border-left: 5px solid #17a2b8;
    box-shadow: 0 6px 20px rgba(23, 162, 184, 0.2);
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Responsive */
@media (max-width: 1200px) {
    .contact-unified-section {
        background-size: 150%;
        padding: 0.5rem 0;
    }
    
    .hero-title {
        font-size: 2.8rem;
    }
    
    .hero-subtitle {
        font-size: 1rem;
    }
}

@media (max-width: 992px) {
    .contact-unified-section {
        background-size: 180%;
        min-height: 80vh;
    }
    
    .hero-title {
        font-size: 2.5rem;
    }
    
    .contact-info-card,
    .contact-form-card {
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .info-icon {
        width: 32px;
        height: 32px;
        font-size: 12px;
        margin-right: 10px;
    }
    
    .social-link {
        width: 40px;
        height: 40px;
    }
}

@media (max-width: 768px) {
    .contact-unified-section {
        background-size: 200%;
        background-position: center center;
        min-height: 70vh;
        padding: 0.5rem 0;
    }
    
    .hero-text-container {
        padding: 0.8rem 1.5rem;
        border-radius: 12px;
    }
    
    .hero-title {
        font-size: 2.2rem;
        margin-bottom: 0.5rem;
    }
    
    .hero-subtitle {
        font-size: 0.95rem;
        margin-bottom: 1rem;
    }
    
    .yellow-underline {
        width: 50%;
        height: 3px;
        margin: 0.3rem auto;
    }
    
    .contact-info-card,
    .contact-form-card {
        padding: 16px;
        margin-bottom: 15px;
        border-radius: 12px;
    }
    
    .info-item {
        margin-bottom: 10px;
    }
    
    .info-icon {
        width: 30px;
        height: 30px;
        font-size: 11px;
        margin-right: 8px;
    }
    
    .info-label {
        font-size: 0.8rem;
    }
    
    .info-text {
        font-size: 0.9rem;
    }
    
    .form-title,
    .info-title {
        font-size: 1.3rem;
    }
    
    .form-label {
        font-size: 0.9rem;
    }
    
    .form-control, .form-select {
        padding: 10px 12px;
        font-size: 0.9rem;
        border-radius: 8px;
    }
    
    .btn-cta {
        width: 100%;
        padding: 14px 20px;
        font-size: 1rem;
    }
    
    .social-link {
        width: 36px;
        height: 36px;
        font-size: 0.9rem;
    }
    
    .social-links {
        gap: 8px;
    }
    
    .location-title,
    .faq-title {
        font-size: 2.2rem;
    }
}

@media (max-width: 576px) {
    .contact-unified-section {
        background-size: 250%;
        min-height: 60vh;
    }
    
    .hero-text-container {
        padding: 0.6rem 1rem;
        border-radius: 10px;
    }
    
    .hero-title {
        font-size: 1.8rem;
        line-height: 1.2;
    }
    
    .hero-subtitle {
        font-size: 0.9rem;
    }
    
    .yellow-underline {
        width: 40%;
        height: 2px;
    }
    
    .contact-info-card,
    .contact-form-card {
        padding: 12px;
        margin-bottom: 12px;
        border-radius: 10px;
    }
    
    .info-item {
        margin-bottom: 8px;
    }
    
    .info-icon {
        width: 28px;
        height: 28px;
        font-size: 10px;
        margin-right: 6px;
    }
    
    .info-label {
        font-size: 0.75rem;
    }
    
    .info-text {
        font-size: 0.85rem;
        line-height: 1.4;
    }
    
    .form-title,
    .info-title {
        font-size: 1.2rem;
    }
    
    .form-label {
        font-size: 0.85rem;
        margin-bottom: 6px;
    }
    
    .form-control, .form-select {
        padding: 8px 10px;
        font-size: 0.85rem;
        border-radius: 6px;
    }
    
    .btn-cta {
        padding: 12px 16px;
        font-size: 0.9rem;
    }
    
    .social-link {
        width: 32px;
        height: 32px;
        font-size: 0.8rem;
    }
    
    .location-title,
    .faq-title {
        font-size: 1.8rem;
    }
    
    .accordion-button {
        font-size: 0.9rem;
        padding: 12px 16px;
    }
    
    .accordion-body {
        font-size: 0.85rem;
        padding: 12px 16px;
    }
}

@media (max-width: 480px) {
    .contact-unified-section {
        background-size: 300%;
        min-height: 50vh;
    }
    
    .hero-text-container {
        padding: 0.5rem 0.8rem;
        border-radius: 8px;
    }
    
    .hero-title {
        font-size: 1.6rem;
    }
    
    .hero-subtitle {
        font-size: 0.85rem;
    }
    
    .contact-info-card,
    .contact-form-card {
        padding: 10px;
        margin-bottom: 10px;
    }
    
    .info-icon {
        width: 26px;
        height: 26px;
        font-size: 9px;
    }
    
    .form-control, .form-select {
        padding: 6px 8px;
        font-size: 0.8rem;
    }
    
    .btn-cta {
        padding: 10px 14px;
        font-size: 0.85rem;
    }
    
    .location-title,
    .faq-title {
        font-size: 1.6rem;
    }
}

/* Touch-friendly improvements */
@media (hover: none) and (pointer: coarse) {
    .form-control, .form-select {
        min-height: 44px;
        font-size: 16px; /* Prevents zoom on iOS */
    }
    
    .btn-cta {
        min-height: 48px;
        font-size: 16px;
    }
    
    .social-link {
        min-width: 44px;
        min-height: 44px;
    }
    
    .info-icon {
        min-width: 36px;
        min-height: 36px;
    }
}

/* Landscape orientation for mobile */
@media (max-width: 768px) and (orientation: landscape) {
    .contact-unified-section {
        min-height: 100vh;
        background-size: 150%;
    }
    
    .hero-title {
        font-size: 1.8rem;
    }
    
    .hero-subtitle {
        font-size: 0.9rem;
    }
}

/* High DPI displays */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .hero-title {
        text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.6);
    }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
    .contact-unified-section {
        background-attachment: scroll;
    }
    
    .social-link,
    .btn-cta,
    .form-control,
    .form-select {
        transition: none;
    }
    
    .social-link:hover,
    .btn-cta:hover {
        transform: none;
    }
}
</style>

<script>
// Efecto Parallax desactivado - imagen fija
function initParallax() {
    // Parallax desactivado para mantener la imagen fija
    return;
}

// Validación del formulario
function validateForm() {
    const form = document.getElementById('contactForm');
    const inputs = form.querySelectorAll('input, select, textarea');
    let isValid = true;
    
    inputs.forEach(input => {
        validateField(input);
        if (input.classList.contains('is-invalid')) {
            isValid = false;
        }
    });
    
    return isValid;
}

// Función para validar campos individuales
function validateField(field) {
    const value = field.value.trim();
    const fieldName = field.name;
    
    // Limpiar validaciones previas
    field.classList.remove('is-invalid', 'is-valid');
    
    // Remover mensajes de error existentes
    const existingError = field.parentNode.querySelector('.field-error-message');
    if (existingError) {
        existingError.remove();
    }
    
    // Validar solo si hay valor o si es requerido
    if (value || field.required) {
        let isValid = true;
        let errorMessage = '';
        
        // Validación de nombre
        if (fieldName === 'nombre') {
            if (!value) {
                isValid = false;
                errorMessage = 'El nombre es obligatorio.';
            } else if (value.length < 2) {
                isValid = false;
                errorMessage = 'El nombre debe tener al menos 2 caracteres.';
            } else if (value.length > 200) {
                isValid = false;
                errorMessage = 'El nombre no puede exceder los 200 caracteres.';
            } else if (!/^[a-zA-ZáéíóúÁÉÍÓÚñÑüÜ\s\-\'\.]+$/.test(value)) {
                isValid = false;
                errorMessage = 'El nombre solo puede contener letras, espacios, guiones, apostrofes y puntos.';
            }
        }
        
        // Validación de email
        else if (fieldName === 'email') {
            if (!value) {
                isValid = false;
                errorMessage = 'El correo electrónico es obligatorio.';
            } else if (value.length > 254) {
                isValid = false;
                errorMessage = 'El correo electrónico no puede exceder los 254 caracteres.';
            } else if (!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(value)) {
                isValid = false;
                errorMessage = 'Por favor ingresa un correo electrónico válido.';
            }
        }
        
        // Validación de teléfono
        else if (fieldName === 'telefono' && value) {
            const cleanPhone = value.replace(/[^\d+]/g, '');
            if (cleanPhone.length < 8) {
                isValid = false;
                errorMessage = 'El teléfono debe tener al menos 8 dígitos.';
            } else if (cleanPhone.length > 15) {
                isValid = false;
                errorMessage = 'El teléfono no puede exceder los 15 dígitos.';
            } else if (!/^\+?[0-9]+$/.test(cleanPhone)) {
                isValid = false;
                errorMessage = 'El teléfono solo puede contener números y opcionalmente un + al inicio.';
            }
        }
        
        // Validación de asunto
        else if (fieldName === 'asunto') {
            if (!value) {
                isValid = false;
                errorMessage = 'Debes seleccionar un asunto.';
            }
        }
        
        // Validación de mensaje
        else if (fieldName === 'mensaje') {
            if (!value) {
                isValid = false;
                errorMessage = 'El mensaje es obligatorio.';
            } else if (value.length < 10) {
                isValid = false;
                errorMessage = 'El mensaje debe tener al menos 10 caracteres.';
            } else if (value.length > 2000) {
                isValid = false;
                errorMessage = 'El mensaje no puede exceder los 2000 caracteres.';
            } else if (!value.trim()) {
                isValid = false;
                errorMessage = 'El mensaje no puede estar vacío.';
            }
        }
        
        
        // Aplicar validación
        if (isValid) {
            field.classList.add('is-valid');
        } else {
            field.classList.add('is-invalid');
            showFieldError(field, errorMessage);
        }
    }
}

// Función para mostrar mensajes de error
function showFieldError(field, message) {
    const errorDiv = document.createElement('div');
    errorDiv.className = 'field-error-message invalid-feedback d-block';
    errorDiv.textContent = message;
    field.parentNode.appendChild(errorDiv);
}

// Validación en tiempo real
function setupRealTimeValidation() {
    const form = document.getElementById('contactForm');
    const inputs = form.querySelectorAll('input, select, textarea');
    
    inputs.forEach(input => {
        // Validación en tiempo real mientras el usuario escribe
        input.addEventListener('input', function() {
            validateField(this);
        });
        
        // Validación al perder el foco
        input.addEventListener('blur', function() {
            validateField(this);
        });
    });
}

// Manejo del envío del formulario
document.getElementById('contactForm').addEventListener('submit', function(e) {
    // Validar todos los campos antes de enviar
    const isValid = validateForm();
    
    if (!isValid) {
        e.preventDefault();
        showFormError('Por favor corrige los errores antes de enviar el formulario.');
        return;
    }
    
    const submitBtn = this.querySelector('.btn-cta');
    const originalText = submitBtn.innerHTML;
    
    // Mostrar estado de carga
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Enviando...';
    submitBtn.disabled = true;
    
    // Re-enable button after 10 seconds in case of error
    setTimeout(() => {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }, 10000);
});

// Función para mostrar error general del formulario
function showFormError(message) {
    // Remover mensaje de error existente
    const existingError = document.querySelector('.form-error-message');
    if (existingError) {
        existingError.remove();
    }
    
    // Crear nuevo mensaje de error
    const errorDiv = document.createElement('div');
    errorDiv.className = 'form-error-message alert alert-danger alert-dismissible fade show';
    errorDiv.innerHTML = `
        <i class="fas fa-exclamation-triangle me-2"></i>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    `;
    
    // Insertar al inicio del formulario
    const form = document.getElementById('contactForm');
    form.insertBefore(errorDiv, form.firstChild);
    
    // Scroll al error
    errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

// Contador de caracteres para mensaje
function setupCharacterCounter() {
    const mensajeInput = document.getElementById('id_mensaje');
    if (mensajeInput) {
        const maxLength = 2000;
        
        // Crear contador
        const counter = document.createElement('div');
        counter.className = 'character-counter';
        counter.textContent = `0 / ${maxLength} caracteres`;
        mensajeInput.parentNode.appendChild(counter);
        
        // Actualizar contador
        function updateCounter() {
            const length = mensajeInput.value.length;
            counter.textContent = `${length} / ${maxLength} caracteres`;
            
            // Cambiar color según la longitud
            counter.classList.remove('warning', 'danger');
            if (length > maxLength * 0.9) {
                counter.classList.add('warning');
            }
            if (length > maxLength) {
                counter.classList.add('danger');
            }
        }
        
        // Event listeners
        mensajeInput.addEventListener('input', updateCounter);
        mensajeInput.addEventListener('paste', function() {
            setTimeout(updateCounter, 10);
        });
        
        // Validación en tiempo real
        mensajeInput.addEventListener('input', function() {
            if (this.value.length > maxLength) {
                this.value = this.value.substring(0, maxLength);
                updateCounter();
            }
        });
    }
}

// Preseleccionar asunto desde URL
function preselectAsunto() {
    const urlParams = new URLSearchParams(window.location.search);
    const asunto = urlParams.get('asunto');
    
    if (asunto) {
        // Buscar el select original (oculto) o el dropdown personalizado
        const asuntoSelect = document.getElementById('id_asunto');
        if (asuntoSelect) {
            asuntoSelect.value = asunto;
            
            // Si hay un dropdown personalizado, actualizarlo también
            const customButton = document.querySelector('.custom-select-button');
            if (customButton) {
                const selectedOption = asuntoSelect.options[asuntoSelect.selectedIndex];
                if (selectedOption) {
                    customButton.textContent = selectedOption.text;
                }
            }
        }
    }
}

// Función para ajustar el ancho de las líneas amarillas al texto
function ajustarLineasAmarillas() {
    // Función auxiliar para medir el ancho del texto
    function medirAnchoTexto(elemento, texto) {
        const canvas = document.createElement('canvas');
        const contexto = canvas.getContext('2d');
        
        // Obtener los estilos del elemento
        const estilos = window.getComputedStyle(elemento);
        contexto.font = `${estilos.fontWeight} ${estilos.fontSize} ${estilos.fontFamily}`;
        
        return contexto.measureText(texto).width;
    }
    
    // Ajustar línea amarilla del formulario
    const tituloFormulario = document.querySelector('.form-title');
    const lineaFormulario = document.querySelector('.yellow-underline-form');
    
    if (tituloFormulario && lineaFormulario) {
        const anchoTexto = medirAnchoTexto(tituloFormulario, tituloFormulario.textContent);
        const anchoContenedor = tituloFormulario.offsetWidth;
        const porcentaje = (anchoTexto / anchoContenedor) * 100;
        
        // Limitar el porcentaje entre 20% y 60%
        const porcentajeFinal = Math.max(20, Math.min(60, porcentaje));
        lineaFormulario.style.width = porcentajeFinal + '%';
    }
    
    // Ajustar línea amarilla de información de contacto
    const tituloInfo = document.querySelector('.info-title');
    const lineaInfo = document.querySelector('.yellow-underline-info');
    
    if (tituloInfo && lineaInfo) {
        const anchoTexto = medirAnchoTexto(tituloInfo, tituloInfo.textContent);
        const anchoContenedor = tituloInfo.offsetWidth;
        const porcentaje = (anchoTexto / anchoContenedor) * 100;
        
        // Limitar el porcentaje entre 20% y 60%
        const porcentajeFinal = Math.max(20, Math.min(60, porcentaje));
        lineaInfo.style.width = porcentajeFinal + '%';
    }
}

// Función para crear un dropdown personalizado para el asunto
function setupAsuntoSelect() {
    const asuntoSelect = document.getElementById('id_asunto');
    if (!asuntoSelect) return;
    
    // Crear contenedor para el dropdown personalizado
    const customSelectContainer = document.createElement('div');
    customSelectContainer.className = 'custom-select-container';
    customSelectContainer.style.position = 'relative';
    customSelectContainer.style.width = '100%';
    
    // Crear el botón que simula el select
    const customSelectButton = document.createElement('button');
    customSelectButton.type = 'button';
    customSelectButton.className = 'form-select custom-select-button';
    customSelectButton.style.textAlign = 'left';
    customSelectButton.style.cursor = 'pointer';
    customSelectButton.style.position = 'relative';
    customSelectButton.style.zIndex = '1';
    
    // Crear el dropdown personalizado
    const customDropdown = document.createElement('div');
    customDropdown.className = 'custom-dropdown';
    customDropdown.style.display = 'none';
    customDropdown.style.position = 'absolute';
    customDropdown.style.top = '100%';
    customDropdown.style.left = '0';
    customDropdown.style.right = '0';
    customDropdown.style.backgroundColor = 'white';
    customDropdown.style.border = '1px solid var(--border)';
    customDropdown.style.borderTop = 'none';
    customDropdown.style.borderRadius = '0 0 12px 12px';
    customDropdown.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1)';
    customDropdown.style.maxHeight = '144px'; // 3 opciones * 48px
    customDropdown.style.overflowY = 'auto';
    customDropdown.style.zIndex = '1000';
    
    // Obtener las opciones del select original
    const options = Array.from(asuntoSelect.options);
    let selectedValue = asuntoSelect.value;
    let selectedText = asuntoSelect.options[asuntoSelect.selectedIndex]?.text || 'Selecciona un asunto';
    
    // Verificar si hay un parámetro de asunto en la URL
    const urlParams = new URLSearchParams(window.location.search);
    const urlAsunto = urlParams.get('asunto');
    if (urlAsunto && !selectedValue) {
        // Si hay un asunto en la URL pero no está seleccionado, seleccionarlo
        asuntoSelect.value = urlAsunto;
        selectedValue = urlAsunto;
        const urlOption = asuntoSelect.options[asuntoSelect.selectedIndex];
        selectedText = urlOption ? urlOption.text : 'Selecciona un asunto';
    }
    
    // Actualizar el texto del botón
    customSelectButton.textContent = selectedText;
    
    // Crear opciones para el dropdown personalizado
    options.forEach(option => {
        if (option.value === '') return; // Saltar la opción vacía
        
        const customOption = document.createElement('div');
        customOption.className = 'custom-option';
        customOption.textContent = option.text;
        customOption.style.padding = '12px 16px';
        customOption.style.cursor = 'pointer';
        customOption.style.borderBottom = '1px solid #f3f4f6';
        customOption.style.transition = 'background-color 0.2s ease';
        
        // Marcar la opción seleccionada
        if (option.value === selectedValue) {
            customOption.style.backgroundColor = 'var(--brand-600)';
            customOption.style.color = 'white';
        }
        
        // Eventos para las opciones
        customOption.addEventListener('mouseenter', function() {
            if (option.value !== selectedValue) {
                this.style.backgroundColor = '#f8fafc';
            }
        });
        
        customOption.addEventListener('mouseleave', function() {
            if (option.value !== selectedValue) {
                this.style.backgroundColor = 'white';
            }
        });
        
        customOption.addEventListener('click', function() {
            // Actualizar el select original
            asuntoSelect.value = option.value;
            
            // Actualizar el botón
            customSelectButton.textContent = option.text;
            selectedValue = option.value;
            selectedText = option.text;
            
            // Actualizar estilos de las opciones
            customDropdown.querySelectorAll('.custom-option').forEach(opt => {
                opt.style.backgroundColor = 'white';
                opt.style.color = 'var(--text-900)';
            });
            this.style.backgroundColor = 'var(--brand-600)';
            this.style.color = 'white';
            
            // Cerrar el dropdown
            customDropdown.style.display = 'none';
            customSelectButton.setAttribute('aria-expanded', 'false');
            
            // Disparar evento de cambio
            asuntoSelect.dispatchEvent(new Event('change'));
            validateField(asuntoSelect);
        });
        
        customDropdown.appendChild(customOption);
    });
    
    // Eventos para el botón
    customSelectButton.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const isOpen = customDropdown.style.display !== 'none';
        customDropdown.style.display = isOpen ? 'none' : 'block';
        customSelectButton.setAttribute('aria-expanded', !isOpen);
    });
    
    // Cerrar dropdown al hacer clic fuera
    document.addEventListener('click', function(e) {
        if (!customSelectContainer.contains(e.target)) {
            customDropdown.style.display = 'none';
            customSelectButton.setAttribute('aria-expanded', 'false');
        }
    });
    
    // Reemplazar el select original
    asuntoSelect.style.display = 'none';
    customSelectContainer.appendChild(customSelectButton);
    customSelectContainer.appendChild(customDropdown);
    asuntoSelect.parentNode.insertBefore(customSelectContainer, asuntoSelect);
    
    // Mantener la funcionalidad del select original
    asuntoSelect.addEventListener('change', function() {
        const selectedOption = this.options[this.selectedIndex];
        customSelectButton.textContent = selectedOption.text;
        
        // Actualizar estilos de las opciones
        customDropdown.querySelectorAll('.custom-option').forEach((opt, index) => {
            if (this.selectedIndex === index + 1) { // +1 porque saltamos la opción vacía
                opt.style.backgroundColor = 'var(--brand-600)';
                opt.style.color = 'white';
            } else {
                opt.style.backgroundColor = 'white';
                opt.style.color = 'var(--text-900)';
            }
        });
    });
}

// Inicialización
document.addEventListener('DOMContentLoaded', function() {
    initParallax();
    setupRealTimeValidation();
    setupCharacterCounter();
    preselectAsunto();
    ajustarLineasAmarillas();
    setupAsuntoSelect();
    
    // Auto-dismiss alerts after 5 seconds
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(alert => {
        setTimeout(() => {
            if (alert && alert.parentNode) {
                alert.style.opacity = '0';
                alert.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (alert && alert.parentNode) {
                        alert.remove();
                    }
                }, 300);
            }
        }, 5000);
    });
    
    // Scroll to form when message appears
    if (alerts.length > 0) {
        const formSection = document.querySelector('.contact-unified-section');
        if (formSection) {
            formSection.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    }
    
    // Inicializar mapa con Leaflet
    initMap();
});

// Función para inicializar el mapa
function initMap() {
    // Coordenadas de la ubicación
    const lat = -38.95407893212158;
    const lng = -68.06969165248405;
    
    // Crear el mapa
    const map = L.map('map').setView([lat, lng], 15);
    
    // Agregar capa de tiles (OpenStreetMap)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 19
    }).addTo(map);
    
    // Agregar marcador personalizado
    const customIcon = L.divIcon({
        className: 'custom-marker',
        html: '<div style="background-color: #FFD700; width: 30px; height: 30px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 10px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;"><i class="fas fa-map-marker-alt" style="color: #2C3240; font-size: 16px;"></i></div>',
        iconSize: [30, 30],
        iconAnchor: [15, 15],
        popupAnchor: [0, -15]
    });
    
    // Agregar marcador al mapa
    const marker = L.marker([lat, lng], { icon: customIcon }).addTo(map);
    
    // Agregar popup al marcador
    marker.bindPopup(`
        <div style="text-align: center; padding: 10px;">
            <h4 style="margin: 0 0 8px 0; color: #2C3240; font-weight: bold;">Inmobiliaria</h4>
            <p style="margin: 0; color: #666; font-size: 14px;">Tu socio de confianza en bienes raíces</p>
            <hr style="margin: 8px 0;">
            <p style="margin: 0; color: #333; font-size: 13px;">
                <i class="fas fa-map-marker-alt" style="color: #FFD700; margin-right: 5px;"></i>
                Ubicación: ${lat.toFixed(6)}, ${lng.toFixed(6)}
            </p>
        </div>
    `).openPopup();
    
    // Ajustar el mapa cuando se redimensione la ventana
    setTimeout(() => {
        map.invalidateSize();
    }, 100);
}

// Ajustar líneas amarillas cuando se redimensione la ventana
window.addEventListener('resize', function() {
    // Debounce para evitar demasiadas llamadas
    clearTimeout(window.resizeTimeout);
    window.resizeTimeout = setTimeout(ajustarLineasAmarillas, 100);
});
</script>
{% endblock %}
